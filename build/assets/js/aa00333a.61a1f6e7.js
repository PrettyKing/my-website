"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9499],{2362:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var i=t(8168),o=(t(6540),t(5680));const r={title:"\u57cb\u70b9\u573a\u666f\u9898\uff1a\u5982\u4f55\u8bbe\u8ba1\u4e00\u4e2a\u901a\u8fc7\u7ec4\u4ef6\u66dd\u5149\u7684sdk\uff08\u8ba1\u7b97\u8def\u7531\u8df3\u8f6c\u5c42\u7ea7\u3001\u505c\u7559\u65f6\u95f4\u7b49\uff09",date:new Date("2021-07-16T00:00:00.000Z"),tags:["question"],categories:["\u95ee\u9898\u79ef\u7d2f"]},s=void 0,a={unversionedId:"question/\u7ec4\u4ef6\u66dd\u5149SDK",id:"question/\u7ec4\u4ef6\u66dd\u5149SDK",isDocsHomePage:!1,title:"\u57cb\u70b9\u573a\u666f\u9898\uff1a\u5982\u4f55\u8bbe\u8ba1\u4e00\u4e2a\u901a\u8fc7\u7ec4\u4ef6\u66dd\u5149\u7684sdk\uff08\u8ba1\u7b97\u8def\u7531\u8df3\u8f6c\u5c42\u7ea7\u3001\u505c\u7559\u65f6\u95f4\u7b49\uff09",description:"`js",source:"@site/docs\\question\\\u7ec4\u4ef6\u66dd\u5149SDK.md",sourceDirName:"question",slug:"/question/\u7ec4\u4ef6\u66dd\u5149SDK",permalink:"/docs/question/\u7ec4\u4ef6\u66dd\u5149SDK",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/question\\\u7ec4\u4ef6\u66dd\u5149SDK.md",version:"current",frontMatter:{title:"\u57cb\u70b9\u573a\u666f\u9898\uff1a\u5982\u4f55\u8bbe\u8ba1\u4e00\u4e2a\u901a\u8fc7\u7ec4\u4ef6\u66dd\u5149\u7684sdk\uff08\u8ba1\u7b97\u8def\u7531\u8df3\u8f6c\u5c42\u7ea7\u3001\u505c\u7559\u65f6\u95f4\u7b49\uff09",date:"2021-07-16T00:00:00.000Z",tags:["question"],categories:["\u95ee\u9898\u79ef\u7d2f"]},sidebar:"defaultSidebar",previous:{title:"\u6d4f\u89c8\u5668\u91cc\u70b9\u51fb\u590d\u5236\u5230\u526a\u8d34\u677f\u7684\u65b9\u6cd5",permalink:"/docs/question/\u6d4f\u89c8\u5668\u91cc\u70b9\u51fb\u590d\u5236\u5230\u526a\u8d34\u677f"},next:{title:"\u7f51\u7ad9\u7684seo\u5904\u7406",permalink:"/docs/question/\u7f51\u7ad9\u7684seo\u5904\u7406"}},l=[],d={toc:l},c="wrapper";function u(e){let{components:n,...t}=e;return(0,o.yg)(c,(0,i.A)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'/*\n * @description \u9875\u9762\u57cb\u70b9\u7edf\u8ba1\uff08\u505c\u7559\u65f6\u95f4\uff09\n *\n * \u5f53\u6d4f\u89c8\u5668\u8fdb\u5165\u9875\u9762\u65f6\uff0c\u89e6\u53d1onload\n * \u5f53\u5173\u95ed\u6d4f\u89c8\u5668\u65f6\uff0c\u6267\u884c\u987a\u5e8f onbeforeunload--\x3e visibilitychange --\x3e onunload\n * \u6bcf\u4e00\u6b21\u8fdb\u5165\u9875\u9762 entry_time  \u8bb0\u5f53\u524d\u65f6\u95f4\u6233\uff0c\u521d\u59cb\u5316\u65f6\u8bb0\u4e00\u6b21\u5f53\u524d\u65f6\u95f4\u6233\n * \u6bcf\u4e00\u6b21\u9690\u85cf\u9875\u9762 hidden_time \u8bb0\u5f53\u524d\u65f6\u95f4\u6233\uff0c onbeforeunload\u65f6\u518d\u8bb0\u4e00\u6b21\u5f53\u524d\u65f6\u95f4\u6233\n * hidden_time[i] - entry_time[i] \u4f4d\u6bcf\u6b21\u505c\u7559\u7684\u65f6\u95f4\uff0c\u6c42\u548c\u4e3a\u603b\u7684\u505c\u7559\u65f6\u95f4\u3002\n *\n *\n * new PageView({closeCb: fn})\n *\n */\nfunction PageView(option) {\n    // \u8ba1\u7b97\u9875\u9762\u663e\u793a\u65f6\u7684\u65f6\u95f4\u6233\n    this.entry_time = [],\n    // \u8ba1\u7b97\u9875\u9762\u9690\u85cf\u65f6\u7684\u65f6\u95f4\u6233\n    this.hidden_time = [],\n    // \u505c\u7559\u65f6\u95f4  \u603b\u7684\u505c\u7559\u65f6\u95f4 = \u505c\u7559\u65f6\u95f4\u7d2f\u52a0\n    this.split_time = [],\n    // \u603b\u7684\u505c\u7559\u65f6\u95f4\n    this.stay_time = 0,\n\n    this.closeCb = option.closeCb || null\n    // \u521d\u59cb\u5316\n    this.init();\n  }\n  \n  \n  \n  // \u9875\u9762 \u8fdb\u5165\n  PageView.prototype.countEntryTime = function () {\n    this.entry_time.push(new Date().getTime());\n  };\n  \n  // \u9875\u9762 \u9690\u85cf\n  PageView.prototype.countHiddenTime = function () {\n    this.hidden_time.push(new Date().getTime());\n  };\n  \n  // \u7ec4\u88c5\u6570\u636e\n  PageView.prototype.getAnalysisData = function () {\n    let aEntryTime = this.entry_time,\n      aHiddenTime = this.hidden_time;\n  \n    // \u8ba1\u7b97\u505c\u7559\u65f6\u95f4\n    for (let i = 0; i < aHiddenTime.length; i++) {\n      let t = +(aHiddenTime[i] - aEntryTime[i])\n      this.split_time.push(t);\n    }\n  \n    // \u8ba1\u7b97\u505c\u7559\u603b\u65f6\u957f\n    let nStayTime = 0;\n    for (let i = 0; i < this.split_time.length; i++) {\n      nStayTime += this.split_time[i];\n    };\n    nStayTime = +nStayTime.toFixed(0);\n    this.stay_time = nStayTime;\n  \n    return {\n      split_time: this.split_time,\n      stay_time: this.stay_time\n    }\n  };\n  \n  // \u5173\u95ed\u6216\u5237\u65b0\u9875\u9762\u6570\u636e\u5904\u7406 \u56de\u8c03\u9875\u9762\u903b\u8f91\n  PageView.prototype.setAnalysis = function () {\n    let data = this.getAnalysisData();\n    if (data.stay_time) {\n      this.closeCb && this.closeCb(data, window.history.length);\n    } else {\n      console.error(\'\u505c\u7559\u65f6\u95f4\u8ba1\u7b97\u9519\u8bef\');\n    }\n  };\n  \n  // \u5173\u95ed\u6216\u5237\u65b0\u9875\u9762\n  PageView.prototype.initCloseWindow = function () {\n    let self = this;\n    // onbeforeunload onunload https://stackoverflow.com/questions/6895564/difference-between-onbeforeunload-and-onunload\n    window.addEventListener("beforeunload", function (event) {\n      // \u5173\u95ed\u6216\u5237\u65b0\u65f6 \u8bb0\u4e00\u6b21hidden\u65f6\u95f4\n      self.countHiddenTime();\n      self.setAnalysis();\n    });\n  };\n  \n  /**\n   * @description \u9875\u9762 \u663e\u793a\u9690\u85cf\n   * \u53c2\u8003: https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API\n   */\n  PageView.prototype.initChangeVisible = function () {\n    let self = this;\n    function handleVisibilityChange() {\n      // \u9875\u9762\u9690\u85cf\u8ba1\u7b97\u65f6\u95f4\n      if (document[hidden]) {\n        self.countHiddenTime();\n      } else {\n        // \u9875\u9762\u663e\u793a\u7edf\u8ba1\u65f6\u95f4\n        self.countEntryTime();\n      }\n    }\n  \n    // \u8bbe\u7f6e\u9690\u85cf\u5c5e\u6027\u548c\u6539\u53d8\u53ef\u89c1\u5c5e\u6027\u7684\u4e8b\u4ef6\u7684\u540d\u79f0\n    var hidden, visibilityChange;\n    if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support\n      hidden = "hidden";\n      visibilityChange = "visibilitychange";\n    } else if (typeof document.msHidden !== "undefined") {\n      hidden = "msHidden";\n      visibilityChange = "msvisibilitychange";\n    } else if (typeof document.webkitHidden !== "undefined") {\n      hidden = "webkitHidden";\n      visibilityChange = "webkitvisibilitychange";\n    }\n  \n    // \u517c\u5bb9 addEventListener\n    if (document.addEventListener) {\n      document.addEventListener(visibilityChange, handleVisibilityChange, false);\n    } else {\n      document.attachEvent(\'on\' + visibilityChange, handleVisibilityChange);\n    }\n  \n  };\n  \n  PageView.prototype.init = function () {\n    // \u7b2c\u4e00\u6b21\u8fdb\u5165\u9875\u9762\u65f6 \u8bb0entry\u65f6\u95f4\n    this.countEntryTime();\n    // \u521d\u59cb\u5316 \u9875\u9762\u9690\u85cf\u65f6\u95f4\n    this.initChangeVisible();\n    // \u521d\u59cb\u5316 \u9875\u9762\u5173\u95ed\u6216\u5237\u65b0\u4e8b\u4ef6\n    this.initCloseWindow();\n  };\n  \n  module.exports = PageView;\n')))}u.isMDXComponent=!0},5680:(e,n,t)=>{t.d(n,{xA:()=>c,yg:()=>y});var i=t(6540);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=i.createContext({}),d=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=d(e.components);return i.createElement(l.Provider,{value:n},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),u=d(t),m=o,y=u["".concat(l,".").concat(m)]||u[m]||p[m]||r;return t?i.createElement(y,s(s({ref:n},c),{},{components:t})):i.createElement(y,s({ref:n},c))}));function y(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,s=new Array(r);s[0]=m;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a[u]="string"==typeof e?e:o,s[1]=a;for(var d=2;d<r;d++)s[d]=t[d];return i.createElement.apply(null,s)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);