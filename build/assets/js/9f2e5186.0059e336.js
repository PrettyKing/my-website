"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8421],{264:(e,n,r)=>{r.r(n),r.d(n,{contentTitle:()=>o,default:()=>s,frontMatter:()=>t,metadata:()=>c,toc:()=>i});var a=r(8168),l=(r(6540),r(5680));const t={},o=void 0,c={unversionedId:"docker/Dockerfile\u8bed\u6cd5",id:"docker/Dockerfile\u8bed\u6cd5",isDocsHomePage:!1,title:"Dockerfile\u8bed\u6cd5",description:"FROM\uff08\u6307\u5b9a\u57fa\u7840 image\uff09",source:"@site/docs\\docker\\Dockerfile\u8bed\u6cd5.md",sourceDirName:"docker",slug:"/docker/Dockerfile\u8bed\u6cd5",permalink:"/docs/docker/Dockerfile\u8bed\u6cd5",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/docker\\Dockerfile\u8bed\u6cd5.md",version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Docker-compose\u57fa\u672c\u8bed\u6cd5",permalink:"/docs/docker/Docker-compose\u57fa\u672c\u8bed\u6cd5"},next:{title:"Docker\u57fa\u7840\u901f\u67e5",permalink:"/docs/docker/Docker\u57fa\u7840\u901f\u67e5"}},i=[],g={toc:i},p="wrapper";function s(e){let{components:n,...r}=e;return(0,l.yg)(p,(0,a.A)({},g,r,{components:n,mdxType:"MDXLayout"}),(0,l.yg)("h4",{id:"from\u6307\u5b9a\u57fa\u7840-image"},"FROM\uff08\u6307\u5b9a\u57fa\u7840 image\uff09"),(0,l.yg)("p",null,"\u6784\u5efa\u6307\u4ee4\uff0c\u5fc5\u987b\u6307\u5b9a\u4e14\u9700\u8981\u5728 Dockerfile \u5176\u4ed6\u6307\u4ee4\u7684\u524d\u9762\u3002\u540e\u7eed\u7684\u6307\u4ee4\u90fd\u4f9d\u8d56\u4e8e\u8be5\u6307\u4ee4\u6307\u5b9a\u7684 image\u3002FROM \u6307\u4ee4\u6307\u5b9a\u7684\u57fa\u7840 image \u53ef\u4ee5\u662f\u5b98\u65b9\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u7684\uff0c\u4e5f\u53ef\u4ee5\u4f4d\u4e8e\u672c\u5730\u4ed3\u5e93"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"FROM centos:7.2\nFROM centos\n")),(0,l.yg)("h4",{id:"maintainer\u7528\u6765\u6307\u5b9a\u955c\u50cf\u521b\u5efa\u8005\u4fe1\u606f"},"MAINTAINER\uff08\u7528\u6765\u6307\u5b9a\u955c\u50cf\u521b\u5efa\u8005\u4fe1\u606f\uff09"),(0,l.yg)("p",null,"\u6784\u5efa\u6307\u4ee4\uff0c\u7528\u4e8e\u5c06 image \u7684\u5236\u4f5c\u8005\u76f8\u5173\u7684\u4fe1\u606f\u5199\u5165\u5230 image \u4e2d\u3002\u5f53\u6211\u4eec\u5bf9\u8be5 image \u6267\u884c docker inspect \u547d\u4ee4\u65f6\uff0c\u8f93\u51fa\u4e2d\u6709\u76f8\u5e94\u7684\u5b57\u6bb5\u8bb0\u5f55\u8be5\u4fe1\u606f\u3002"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'MAINTAINER  wangyang "wangyang@itxdl.cn"\n')),(0,l.yg)("p",null,"\u200b\t\t"),(0,l.yg)("h4",{id:"label\u5c06\u5143\u6570\u636e\u6dfb\u52a0\u5230\u955c\u50cf"},"LABEL\uff08\u5c06\u5143\u6570\u636e\u6dfb\u52a0\u5230\u955c\u50cf\uff09"),(0,l.yg)("h5",{id:"\u6807\u7b7e\u7684\u5b9a\u4e49"},"\u6807\u7b7e\u7684\u5b9a\u4e49"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'# \u6307\u4ee4\u5c06\u5143\u6570\u636e\u6dfb\u52a0\u5230\u955c\u50cf\u3002`LABEL` \u662f\u952e\u503c\u5bf9\u3002\u8981\u5728 `LABEL` \u503c\u4e2d\u5305\u542b\u7a7a\u683c\uff0c\u8bf7\u50cf\u5728\u547d\u4ee4\u884c\u4e2d\u4e00\u6837\u4f7f\u7528\u5f15\u53f7\u548c\u53cd\u659c\u6760\nLABEL "com.example.vendor"="ACME Incorporated"\nLABEL com.example.label-with-value="foo"\nLABEL version="1.0"\nLABEL description="This text illustrates \\\nthat label-values can span multiple lines."\n\n# \u591a\u884c\u6807\u7b7e\u5b9a\u4e49\u65b9\u5f0f\nLABEL multi.label1="value1" multi.label2="value2" other="value3"\nLABEL multi.label1="value1" \\\n      multi.label2="value2" \\\n      other="value3"\n')),(0,l.yg)("h5",{id:"\u6807\u7b7e\u7684\u7ee7\u627f"},"\u6807\u7b7e\u7684\u7ee7\u627f"),(0,l.yg)("p",null,"\u57fa\u7840\u6216\u7236\u955c\u50cf\uff08",(0,l.yg)("inlineCode",{parentName:"p"},"FROM")," \u884c\u4e2d\u7684\u955c\u50cf\uff09\u4e2d\u5305\u542b\u7684\u6807\u7b7e\u7531\u60a8\u7684\u955c\u50cf\u7ee7\u627f\u3002\u5982\u679c\u6807\u7b7e\u5df2\u7ecf\u5b58\u5728\u4f46\u5177\u6709\u4e0d\u540c\u7684\u503c\uff0c\u5219\u6700\u8fd1\u5e94\u7528\u7684\u503c\u5c06\u8986\u76d6\u4efb\u4f55\u5148\u524d\u8bbe\u7f6e\u7684\u503c"),(0,l.yg)("h5",{id:"\u67e5\u770b\u955c\u50cf\u6807\u7b7e"},"\u67e5\u770b\u955c\u50cf\u6807\u7b7e"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},"$ docker image inspect --format='' myimage\n")),(0,l.yg)("h5",{id:"\u6848\u4f8b"},"\u6848\u4f8b"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'# dockerfile\nFROM busybox\nLABEL author=wangyanglinux\nCMD echo wangyanglinux\n\n# \u6784\u5efa\u955c\u50cf\n[root@k8s-master01 testd]# docker build -t wangyanglinux:0.0.1 . --no-cache\n\n# \u5b89\u88c5 jq\n[root@k8s-master01 testd]# yum install epel-release\n[root@k8s-master01 testd]# yum install jq\n\n# \u67e5\u770b\u6807\u7b7e\n[root@k8s-master01 testd]# docker image inspect wangyanglinux:0.0.1 --format "{{json .ContainerConfig.Labels}}" | jq\n{\n  "author": "wangyanglinux"\n}\n')),(0,l.yg)("h4",{id:"run\u5b89\u88c5\u8f6f\u4ef6\u7528"},"RUN\uff08\u5b89\u88c5\u8f6f\u4ef6\u7528\uff09"),(0,l.yg)("p",null,"\u6784\u5efa\u6307\u4ee4\uff0cRUN \u53ef\u4ee5\u8fd0\u884c\u4efb\u4f55\u88ab\u57fa\u7840 image \u652f\u6301\u7684\u547d\u4ee4\u3002\u5982\u57fa\u7840 image \u9009\u62e9\u4e86 Centos\uff0c\u90a3\u4e48\u8f6f\u4ef6\u7ba1\u7406\u90e8\u5206\u53ea\u80fd\u4f7f\u7528 Centos \u7684\u5305\u7ba1\u7406\u547d\u4ee4"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'RUN cd /tmp && curl -L \'http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.8/bin/apache-tomcat-7.0.8.tar.gz\' | tar -xz \nRUN ["/bin/bash", "-c", "echo hello"]\n')),(0,l.yg)("h4",{id:"user\u8bbe\u7f6econtainer\u5bb9\u5668\u7684\u7528\u6237"},"USER\uff08\u8bbe\u7f6econtainer\u5bb9\u5668\u7684\u7528\u6237\uff09"),(0,l.yg)("p",null,"\u8bbe\u7f6e\u6307\u4ee4\uff0c\u8bbe\u7f6e\u542f\u52a8\u5bb9\u5668\u7684\u7528\u6237\uff0c\u9ed8\u8ba4\u662f root \u7528\u6237"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'USER daemon  =  ENTRYPOINT ["memcached", "-u", "daemon"]  \n')),(0,l.yg)("h4",{id:"expose\u6307\u5b9a\u5bb9\u5668\u9700\u8981\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u5668\u7684\u7aef\u53e3"},"EXPOSE\uff08\u6307\u5b9a\u5bb9\u5668\u9700\u8981\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u5668\u7684\u7aef\u53e3\uff09"),(0,l.yg)("p",null,"\u8bbe\u7f6e\u6307\u4ee4\uff0c\u8be5\u6307\u4ee4\u4f1a\u5c06\u5bb9\u5668\u4e2d\u7684\u7aef\u53e3\u6620\u5c04\u6210\u5bbf\u4e3b\u673a\u5668\u4e2d\u7684\u67d0\u4e2a\u7aef\u53e3\u3002\u5f53\u4f60\u9700\u8981\u8bbf\u95ee\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4e0d\u662f\u7528\u5bb9\u5668\u7684 IP \u5730\u5740\u800c\u662f\u4f7f\u7528\u5bbf\u4e3b\u673a\u5668\u7684 IP \u5730\u5740\u548c\u6620\u5c04\u540e\u7684\u7aef\u53e3\u3002\u8981\u5b8c\u6210\u6574\u4e2a\u64cd\u4f5c\u9700\u8981\u4e24\u4e2a\u6b65\u9aa4\uff0c\u9996\u5148\u5728 Dockerfile \u4f7f\u7528 EXPOSE \u8bbe\u7f6e\u9700\u8981\u6620\u5c04\u7684\u5bb9\u5668\u7aef\u53e3\uff0c\u7136\u540e\u5728\u8fd0\u884c\u5bb9\u5668\u7684\u65f6\u5019\u6307\u5b9a -P \u9009\u9879\u52a0\u4e0a EXPOSE \u8bbe\u7f6e\u7684\u7aef\u53e3\uff0c\u8fd9\u6837 EXPOSE \u8bbe\u7f6e\u7684\u7aef\u53e3\u53f7\u4f1a\u88ab\u968f\u673a\u6620\u5c04\u6210\u5bbf\u4e3b\u673a\u5668\u4e2d\u7684\u4e00\u4e2a\u7aef\u53e3\u53f7\u3002\u4e5f\u53ef\u4ee5\u6307\u5b9a\u9700\u8981\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u5668\u7684\u90a3\u4e2a\u7aef\u53e3\uff0c\u8fd9\u65f6\u8981\u786e\u4fdd\u5bbf\u4e3b\u673a\u5668\u4e0a\u7684\u7aef\u53e3\u53f7\u6ca1\u6709\u88ab\u4f7f\u7528\u3002EXPOSE\u6307\u4ee4\u53ef\u4ee5\u4e00\u6b21\u8bbe\u7f6e\u591a\u4e2a\u7aef\u53e3\u53f7\uff0c\u76f8\u5e94\u7684\u8fd0\u884c\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u914d\u5957\u7684\u591a\u6b21\u4f7f\u7528 -p \u9009\u9879"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"# \u6620\u5c04\u591a\u4e2a\u7aef\u53e3  \nEXPOSE port1 port2 port3  \n\n# \u968f\u673a\u66b4\u9732\u9700\u8981\u8fd0\u884c\u7684\u7aef\u53e3\ndocker run -P image\n\n# \u76f8\u5e94\u7684\u8fd0\u884c\u5bb9\u5668\u4f7f\u7528\u7684\u547d\u4ee4  \ndocker run -p port1 -p port2 -p port3 image  \n\n# \u8fd8\u53ef\u4ee5\u6307\u5b9a\u9700\u8981\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u5668\u4e0a\u7684\u67d0\u4e2a\u7aef\u53e3\u53f7  \ndocker run -p host_port1:port1 -p host_port2:port2 -p host_port3:port3 image  \n")),(0,l.yg)("h4",{id:"env\u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf"},"ENV\uff08\u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff09"),(0,l.yg)("p",null,"\u6784\u5efa\u6307\u4ee4\uff0c\u5728 image \u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u73af\u5883\u53d8\u91cf\u3002\u8bbe\u7f6e\u4e86\u540e\uff0c\u540e\u7eed\u7684 RUN \u547d\u4ee4\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0ccontainer \u542f\u52a8\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 docker inspect \u67e5\u770b\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728 docker run --env key=value \u65f6\u8bbe\u7f6e\u6216\u4fee\u6539\u73af\u5883\u53d8\u91cf\u3002\u5047\u5982\u4f60\u5b89\u88c5\u4e86 JAVA \u7a0b\u5e8f\uff0c\u9700\u8981\u8bbe\u7f6e JAVA_HOME\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728 Dockerfile \u4e2d\u8fd9\u6837\u5199\uff1a"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"ENV JAVA_HOME /path/to/java/dirent\n")),(0,l.yg)("h4",{id:"arg\u8bbe\u7f6e\u53d8\u91cf"},"ARG\uff08\u8bbe\u7f6e\u53d8\u91cf\uff09"),(0,l.yg)("h5",{id:"\u8d77\u4f5c\u7528\u7684\u65f6\u673a"},"\u8d77\u4f5c\u7528\u7684\u65f6\u673a"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"arg \u662f\u5728 build \u7684\u65f6\u5019\u5b58\u5728\u7684, \u53ef\u4ee5\u5728 Dockerfile \u4e2d\u5f53\u505a\u53d8\u91cf\u6765\u4f7f\u7528"),(0,l.yg)("li",{parentName:"ul"},"env \u662f\u5bb9\u5668\u6784\u5efa\u597d\u4e4b\u540e\u7684\u73af\u5883\u53d8\u91cf, \u4e0d\u80fd\u5728 Dockerfile \u4e2d\u5f53\u53c2\u6570\u4f7f\u7528")),(0,l.yg)("h5",{id:"\u6848\u4f8b-1"},"\u6848\u4f8b"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'# Dockerfile\nFROM redis:3.2-alpine\n\nLABEL maintainer="wangyanglinux@163.com"\n\nARG REDIS_SET_PASSWORD=developer\nENV REDIS_PASSWORD ${REDIS_SET_PASSWORD}\n\nVOLUME /data\n\nEXPOSE 6379\n\nCMD ["sh", "-c", "exec redis-server --requirepass \\"$REDIS_PASSWORD\\""]\n')),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'FROM nginx:1.13.1-alpine\n\nLABEL maintainer="wangyanglinux@163.com"\n\nRUN mkdir -p /etc/nginx/cert \\\n    && mkdir -p /etc/nginx/conf.d \\\n    && mkdir -p /etc/nginx/sites\n\nCOPY ./nginx.conf /etc/ngixn/nginx.conf\nCOPY ./conf.d/ /etc/nginx/conf.d/\nCOPY ./cert/ /etc/nginx/cert/\n\nCOPY ./sites /etc/nginx/sites/\n\n\nARG PHP_UPSTREAM_CONTAINER=php-fpm\nARG PHP_UPSTREAM_PORT=9000\nRUN echo "upstream php-upstream { server ${PHP_UPSTREAM_CONTAINER}:${PHP_UPSTREAM_PORT}; }" > /etc/nginx/conf.d/upstream.conf\n\nVOLUME ["/var/log/nginx", "/var/www"]\n\nWORKDIR /usr/share/nginx/html\n')),(0,l.yg)("h4",{id:"add\u4ece-src-\u590d\u5236\u6587\u4ef6\u5230-container-\u7684-dest-\u8def\u5f84"},"ADD\uff08\u4ece src \u590d\u5236\u6587\u4ef6\u5230 container \u7684 dest \u8def\u5f84\uff09"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"ADD <src> <dest>  \n        <src> \u662f\u76f8\u5bf9\u88ab\u6784\u5efa\u7684\u6e90\u76ee\u5f55\u7684\u76f8\u5bf9\u8def\u5f84\uff0c\u53ef\u4ee5\u662f\u6587\u4ef6\u6216\u76ee\u5f55\u7684\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u8fdc\u7a0b\u7684\u6587\u4ef6 url;\n        <dest> \u662f container \u4e2d\u7684\u7edd\u5bf9\u8def\u5f84\n")),(0,l.yg)("h4",{id:"copy-\u4ece-src-\u590d\u5236\u6587\u4ef6\u5230-container-\u7684-dest-\u8def\u5f84"},"COPY \uff08\u4ece src \u590d\u5236\u6587\u4ef6\u5230 container \u7684 dest \u8def\u5f84\uff09"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"COPY <src> <dest> \n")),(0,l.yg)("h4",{id:"volume\u6307\u5b9a\u6302\u8f7d\u70b9"},"VOLUME\uff08\u6307\u5b9a\u6302\u8f7d\u70b9\uff09"),(0,l.yg)("p",null,"\u8bbe\u7f6e\u6307\u4ee4\uff0c\u4f7f\u5bb9\u5668\u4e2d\u7684\u4e00\u4e2a\u76ee\u5f55\u5177\u6709\u6301\u4e45\u5316\u5b58\u50a8\u6570\u636e\u7684\u529f\u80fd\uff0c\u8be5\u76ee\u5f55\u53ef\u4ee5\u88ab\u5bb9\u5668\u672c\u8eab\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u5171\u4eab\u7ed9\u5176\u4ed6\u5bb9\u5668\u4f7f\u7528\u3002\u6211\u4eec\u77e5\u9053\u5bb9\u5668\u4f7f\u7528\u7684\u662f AUFS\uff0c\u8fd9\u79cd\u6587\u4ef6\u7cfb\u7edf\u4e0d\u80fd\u6301\u4e45\u5316\u6570\u636e\uff0c\u5f53\u5bb9\u5668\u5173\u95ed\u540e\uff0c\u6240\u6709\u7684\u66f4\u6539\u90fd\u4f1a\u4e22\u5931\u3002\u5f53\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u6709\u6301\u4e45\u5316\u6570\u636e\u7684\u9700\u6c42\u65f6\u53ef\u4ee5\u5728 Dockerfile\u4e2d \u4f7f\u7528\u8be5\u6307\u4ee4"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'FROM base  \nVOLUME ["/tmp/data"]  \n')),(0,l.yg)("h4",{id:"workdir\u5207\u6362\u76ee\u5f55"},"WORKDIR\uff08\u5207\u6362\u76ee\u5f55\uff09"),(0,l.yg)("p",null,"\u8bbe\u7f6e\u6307\u4ee4\uff0c\u53ef\u4ee5\u591a\u6b21\u5207\u6362(\u76f8\u5f53\u4e8ecd\u547d\u4ee4)\uff0c\u5bf9RUN,CMD,ENTRYPOINT\u751f\u6548"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"WORKDIR /p1   \nRUN touch a.txt\nWORKDIR p2 \nRUN vim a.txt\n")),(0,l.yg)("h4",{id:"cmd\u8bbe\u7f6e-container-\u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c"},"CMD\uff08\u8bbe\u7f6e container \u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c\uff09"),(0,l.yg)("p",null,"\u8bbe\u7f6e\u6307\u4ee4\uff0c\u7528\u4e8e container \u542f\u52a8\u65f6\u6307\u5b9a\u7684\u64cd\u4f5c\u3002\u8be5\u64cd\u4f5c\u53ef\u4ee5\u662f\u6267\u884c\u81ea\u5b9a\u4e49\u811a\u672c\uff0c\u4e5f\u53ef\u4ee5\u662f\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u3002\u8be5\u6307\u4ee4\u53ea\u80fd\u5728\u6587\u4ef6\u4e2d\u5b58\u5728\u4e00\u6b21\uff0c\u5982\u679c\u6709\u591a\u4e2a\uff0c\u5219\u53ea\u6267\u884c\u6700\u540e\u4e00\u6761"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"CMD echo \u201cHello, World!\u201d \n\nCMD /usr/local/nginx/sbin/nginx  tail -f /usr/local/nginx/logs/access.log\n")),(0,l.yg)("h4",{id:"entrypoint\u8bbe\u7f6econtainer\u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c"},"ENTRYPOINT\uff08\u8bbe\u7f6econtainer\u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c\uff09"),(0,l.yg)("p",null,"\u8bbe\u7f6e\u6307\u4ee4\uff0c\u6307\u5b9a\u5bb9\u5668\u542f\u52a8\u65f6\u6267\u884c\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u591a\u6b21\u8bbe\u7f6e\uff0c\u4f46\u662f\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u6709\u6548\u3002"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"ENTRYPOINT ls -l \n")),(0,l.yg)("p",null,"\u8be5\u6307\u4ee4\u7684\u4f7f\u7528\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u79cd\u662f\u72ec\u81ea\u4f7f\u7528\uff0c\u53e6\u4e00\u79cd\u548c CMD \u6307\u4ee4\u914d\u5408\u4f7f\u7528\u3002\u5f53\u72ec\u81ea\u4f7f\u7528\u65f6\uff0c\u5982\u679c\u4f60\u8fd8\u4f7f\u7528\u4e86 CMD \u547d\u4ee4\u4e14 CMD \u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u53ef\u6267\u884c\u7684\u547d\u4ee4\uff0c\u90a3\u4e48 CMD \u6307\u4ee4\u548c ENTRYPOINT \u4f1a\u4e92\u76f8\u8986\u76d6\u53ea\u6709\u6700\u540e\u4e00\u4e2a CMD \u6216\u8005 ENTRYPOINT \u6709\u6548"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"CMD echo \u201cHello, World!\u201d \nENTRYPOINT ls -l\n# CMD \u6307\u4ee4\u5c06\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u53ea\u6709 ENTRYPOINT \u6307\u4ee4\u88ab\u6267\u884c \nENTRYPOINT ls -l\nCMD echo \u201cHello, World!\u201d \n")),(0,l.yg)("p",null,"\u53e6\u4e00\u79cd\u7528\u6cd5\u548c CMD \u6307\u4ee4\u914d\u5408\u4f7f\u7528\u6765\u6307\u5b9a ENTRYPOINT \u7684\u9ed8\u8ba4\u53c2\u6570\uff0c\u8fd9\u65f6 CMD \u6307\u4ee4\u4e0d\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u53ef\u6267\u884c\u547d\u4ee4\uff0c\u4ec5\u4ec5\u662f\u53c2\u6570\u90e8\u5206\uff1bENTRYPOINT \u6307\u4ee4\u53ea\u80fd\u4f7f\u7528 JSON \u65b9\u5f0f\u6307\u5b9a\u6267\u884c\u547d\u4ee4\uff0c\u800c\u4e0d\u80fd\u6307\u5b9a\u53c2\u6570"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'FROM ubuntu  \nCMD ["-l"]  \nENTRYPOINT ["/usr/bin/ls"]\n')),(0,l.yg)("h4",{id:"cmd-\u4e0e-entrypoint-\u7684\u8f83\u91cf"},"CMD \u4e0e ENTRYPOINT \u7684\u8f83\u91cf"),(0,l.yg)("p",null,"\u5b98\u65b9\u91ca\u4e49\uff1a",(0,l.yg)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/builder/#cmd"},"https://docs.docker.com/engine/reference/builder/#cmd")),(0,l.yg)("p",null,"cmd \u7ed9\u51fa\u7684\u662f\u4e00\u4e2a\u5bb9\u5668\u7684\u9ed8\u8ba4\u7684\u53ef\u6267\u884c\u4f53\u3002\u4e5f\u5c31\u662f\u5bb9\u5668\u542f\u52a8\u4ee5\u540e\uff0c\u9ed8\u8ba4\u7684\u6267\u884c\u7684\u547d\u4ee4"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'FROM centos\nCMD echo "hello cmd!"\n\ndocker run xx \n==> hello cmd!\n\n# \u5982\u679c\u6211\u4eec\u5728 run \u65f6\u6307\u5b9a\u4e86\u547d\u4ee4\u6216\u8005\u6709entrypoint\uff0c\u90a3\u4e48 cmd \u5c31\u4f1a\u88ab\u8986\u76d6\u3002\u4ecd\u7136\u662f\u4e0a\u9762\u7684 image\u3002run \u547d\u4ee4\u53d8\u4e86\uff1a\ndocker run xx echo glgl\n==> glgl\n')),(0,l.yg)("p",null,"cmd \u662f\u9ed8\u8ba4\u4f53\u7cfb\uff0centrypoint \u662f\u6b63\u7edf\u5730\u7528\u4e8e\u5b9a\u4e49\u5bb9\u5668\u542f\u52a8\u4ee5\u540e\u7684\u6267\u884c\u4f53"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},'FROM centos \nCMD ["p in cmd"]\nENTRYPOINT ["echo"]\n\n\n[root@k8s-master01 testd]# docker run --name test1  ent:v1\np in cmd\n[root@k8s-master01 testd]# docker run --name test2 ent:v1  p in run\np in run\n\n\n# ENTRYPOINT shell \u6a21\u5f0f\u4efb\u4f55 run \u548c cmd \u7684\u53c2\u6570\u90fd\u65e0\u6cd5\u88ab\u4f20\u5165\u5230 entrypoint \u91cc\u3002\u5b98\u7f51\u63a8\u8350\u7b2c\u4e00\u79cd\u7528\u6cd5\nFROM centos\nCMD ["p in cmd"]\nENTRYPOINT echo\n')),(0,l.yg)("h4",{id:"onbuild\u5728\u5b50\u955c\u50cf\u4e2d\u6267\u884c"},"ONBUILD\uff08\u5728\u5b50\u955c\u50cf\u4e2d\u6267\u884c\uff09"),(0,l.yg)("p",null,"ONBUILD \u6307\u5b9a\u7684\u547d\u4ee4\u5728\u6784\u5efa\u955c\u50cf\u65f6\u5e76\u4e0d\u6267\u884c\uff0c\u800c\u662f\u5728\u5b83\u7684\u5b50\u955c\u50cf\u4e2d\u6267\u884c"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"ONBUILD ADD . /app/src\nONBUILD RUN /usr/local/bin/python-build --dir /app/src\n")),(0,l.yg)("h4",{id:"stopsignal-signal"},"STOPSIGNAL signal"),(0,l.yg)("p",null,"STOPSIGNAL \u6307\u4ee4\u8bbe\u7f6e\u5c06\u53d1\u9001\u5230\u5bb9\u5668\u4ee5\u9000\u51fa\u7684\u7cfb\u7edf\u8c03\u7528\u4fe1\u53f7\u3002\u8fd9\u4e2a\u4fe1\u53f7\u53ef\u4ee5\u662f\u4e00\u4e2a\u6709\u6548\u7684\u65e0\u7b26\u53f7\u6570\u5b57\uff0c\u4e0e\u5185\u6838\u7684",(0,l.yg)("inlineCode",{parentName:"p"},"syscall"),"\u8868\u4e2d\u7684\u4f4d\u7f6e\u76f8\u5339\u914d\uff0c\u4f8b\u5982",(0,l.yg)("inlineCode",{parentName:"p"},"9"),"\uff0c\u6216\u8005\u662f",(0,l.yg)("inlineCode",{parentName:"p"},"SIGNAME"),"\u683c\u5f0f\u7684\u4fe1\u53f7\u540d\uff0c\u4f8b\u5982\uff1aSIGKILL"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},"SIGHUP 1 A \u7ec8\u7aef\u6302\u8d77\u6216\u8005\u63a7\u5236\u8fdb\u7a0b\u7ec8\u6b62\n\nSIGINT 2 A \u952e\u76d8\u4e2d\u65ad\uff08\u5982break\u952e\u88ab\u6309\u4e0b\uff09\n\nSIGQUIT 3 C \u952e\u76d8\u7684\u9000\u51fa\u952e\u88ab\u6309\u4e0b\n\nSIGILL 4 C \u975e\u6cd5\u6307\u4ee4\n\nSIGABRT 6 C \u7531abort(3)\u53d1\u51fa\u7684\u9000\u51fa\u6307\u4ee4\n\nSIGFPE 8 C \u6d6e\u70b9\u5f02\u5e38\n\nSIGKILL 9 AEF Kill\u4fe1\u53f7\n\nSIGSEGV 11 C \u65e0\u6548\u7684\u5185\u5b58\u5f15\u7528\n\nSIGPIPE 13 A \u7ba1\u9053\u7834\u88c2: \u5199\u4e00\u4e2a\u6ca1\u6709\u8bfb\u7aef\u53e3\u7684\u7ba1\u9053\n\nSIGALRM 14 A \u7531alarm(2)\u53d1\u51fa\u7684\u4fe1\u53f7\n\nSIGTERM 15 A \u7ec8\u6b62\u4fe1\u53f7\n\nSIGUSR1 30,10,16 A \u7528\u6237\u81ea\u5b9a\u4e49\u4fe1\u53f71\n\nSIGUSR2 31,12,17 A \u7528\u6237\u81ea\u5b9a\u4e49\u4fe1\u53f72\n\nSIGCHLD 20,17,18 B \u5b50\u8fdb\u7a0b\u7ed3\u675f\u4fe1\u53f7\n\nSIGCONT 19,18,25 \u8fdb\u7a0b\u7ee7\u7eed\uff08\u66fe\u88ab\u505c\u6b62\u7684\u8fdb\u7a0b\uff09\n\nSIGSTOP 17,19,23 DEF \u7ec8\u6b62\u8fdb\u7a0b\n\nSIGTSTP 18,20,24 D \u63a7\u5236\u7ec8\u7aef\uff08tty\uff09\u4e0a\u6309\u4e0b\u505c\u6b62\u952e\n\nSIGTTIN 21,21,26 D \u540e\u53f0\u8fdb\u7a0b\u4f01\u56fe\u4ece\u63a7\u5236\u7ec8\u7aef\u8bfb\n\nSIGTTOU 22,22,27 D \u540e\u53f0\u8fdb\u7a0b\u4f01\u56fe\u4ece\u63a7\u5236\u7ec8\u7aef\u5199\n")),(0,l.yg)("p",null,"\u200b\t"),(0,l.yg)("h4",{id:"shell-\u8986\u76d6\u547d\u4ee4\u7684shell\u6a21\u5f0f\u6240\u4f7f\u7528\u7684\u9ed8\u8ba4-shell"},"SHELL \uff08\u8986\u76d6\u547d\u4ee4\u7684shell\u6a21\u5f0f\u6240\u4f7f\u7528\u7684\u9ed8\u8ba4 shell\uff09"),(0,l.yg)("p",null,"Linux \u7684\u9ed8\u8ba4shell\u662f ","[\u201c/bin/sh\u201d, \u201c-c\u201d]","\uff0cWindows \u7684\u662f ","[\u201ccmd\u201d, \u201c/S\u201d, \u201c/C\u201d]","\u3002SHELL \u6307\u4ee4\u5fc5\u987b\u4ee5 JSON \u683c\u5f0f\u7f16\u5199\u3002SHELL \u6307\u4ee4\u5728\u6709\u4e24\u4e2a\u5e38\u7528\u7684\u4e14\u4e0d\u592a\u76f8\u540c\u7684\u672c\u5730 shell:cmd \u548c powershell\uff0c\u4ee5\u53ca\u53ef\u9009\u7684 sh \u7684 windows \u4e0a\u7279\u522b\u6709\u7528"),(0,l.yg)("h4",{id:"healthcheck-\u5bb9\u5668\u5065\u5eb7\u72b6\u51b5\u68c0\u67e5\u547d\u4ee4"},"HEALTHCHECK \uff08\u5bb9\u5668\u5065\u5eb7\u72b6\u51b5\u68c0\u67e5\u547d\u4ee4\uff09"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"HEALTHCHECK [OPTIONS] CMD command\n    [OPTIONS] \u7684\u9009\u9879\u652f\u6301\u4ee5\u4e0b\u4e09\u4e2d\u9009\u9879\n        --interval=DURATION \u4e24\u6b21\u68c0\u67e5\u9ed8\u8ba4\u7684\u65f6\u95f4\u95f4\u9694\u4e3a 30 \u79d2\n    --timeout=DURATION \u5065\u5eb7\u68c0\u67e5\u547d\u4ee4\u8fd0\u884c\u8d85\u65f6\u65f6\u957f\uff0c\u9ed8\u8ba4 30 \u79d2\n    --retries=N \u5f53\u8fde\u7eed\u5931\u8d25\u6307\u5b9a\u6b21\u6570\u540e\uff0c\u5219\u5bb9\u5668\u88ab\u8ba4\u4e3a\u662f\u4e0d\u5065\u5eb7\u7684\uff0c\u72b6\u6001\u4e3a unhealthy\uff0c\u9ed8\u8ba4\u6b21\u6570\u662f3\n    \n    CMD\u540e\u8fb9\u7684\u547d\u4ee4\u7684\u8fd4\u56de\u503c\u51b3\u5b9a\u4e86\u672c\u6b21\u5065\u5eb7\u68c0\u67e5\u662f\u5426\u6210\u529f\uff0c\u5177\u4f53\u7684\u8fd4\u56de\u503c\u5982\u4e0b\uff1a\n        0: success - \u8868\u793a\u5bb9\u5668\u662f\u5065\u5eb7\u7684\n        1: unhealthy - \u8868\u793a\u5bb9\u5668\u5df2\u7ecf\u4e0d\u80fd\u5de5\u4f5c\u4e86\n        2: reserved - \u4fdd\u7559\u503c\n    \nHEALTHCHECK NONE\n\n# \u7b2c\u4e00\u4e2a\u7684\u529f\u80fd\u662f\u5728\u5bb9\u5668\u5185\u90e8\u8fd0\u884c\u4e00\u4e2a\u547d\u4ee4\u6765\u68c0\u67e5\u5bb9\u5668\u7684\u5065\u5eb7\u72b6\u51b5\n# \u7b2c\u4e8c\u4e2a\u7684\u529f\u80fd\u662f\u5728\u57fa\u7840\u955c\u50cf\u4e2d\u53d6\u6d88\u5065\u5eb7\u68c0\u67e5\u547d\u4ee4\n# \u4e3a\u4e86\u5e2e\u52a9\u8c03\u8bd5\u5931\u8d25\u7684\u63a2\u6d4b\uff0ccommand \u5199\u5728 stdout \u6216 stderr \u4e0a\u7684\u4efb\u4f55\u8f93\u51fa\u6587\u672c\uff08UTF-8\u7f16\u7801\uff09\u90fd\u5c06\u5b58\u50a8\u5728\u5065\u5eb7\u72b6\u6001\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7 docker inspect \u8fdb\u884c\u67e5\u8be2\u3002 \u8fd9\u6837\u7684\u8f93\u51fa\u5e94\u8be5\u4fdd\u6301\u7b80\u77ed\uff08\u76ee\u524d\u53ea\u5b58\u50a8\u524d4096\u4e2a\u5b57\u8282\uff09\n")),(0,l.yg)("h5",{id:"\u6ce8\u610f"},"\u6ce8\u610f"),(0,l.yg)("p",null,"HEALTHCHECK \u547d\u4ee4\u53ea\u80fd\u51fa\u73b0\u4e00\u6b21\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u591a\u6b21\uff0c\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u751f\u6548"),(0,l.yg)("h5",{id:"\u6a21\u677f"},"\u6a21\u677f"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-dockerfile"},"HEALTHCHECK --interval=5m --timeout=3s \\\nCMD curl -f http://localhost/ || exit 1\n")),(0,l.yg)("h5",{id:"\u67e5\u770b\u5bb9\u5668\u7684\u5065\u5eb7\u72b6\u6001"},"\u67e5\u770b\u5bb9\u5668\u7684\u5065\u5eb7\u72b6\u6001"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},"$ docker inspect \u2013format \u2018{{json .State.Health.Status}}\u2019 cID\n")))}s.isMDXComponent=!0},5680:(e,n,r)=>{r.d(n,{xA:()=>p,yg:()=>m});var a=r(6540);function l(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function t(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,a)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(n){l(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function c(e,n){if(null==e)return{};var r,a,l=function(e,n){if(null==e)return{};var r,a,l={},t=Object.keys(e);for(a=0;a<t.length;a++)r=t[a],n.indexOf(r)>=0||(l[r]=e[r]);return l}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(a=0;a<t.length;a++)r=t[a],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(l[r]=e[r])}return l}var i=a.createContext({}),g=function(e){var n=a.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},p=function(e){var n=g(e.components);return a.createElement(i.Provider,{value:n},e.children)},s="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var r=e.components,l=e.mdxType,t=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),s=g(r),u=l,m=s["".concat(i,".").concat(u)]||s[u]||d[u]||t;return r?a.createElement(m,o(o({ref:n},p),{},{components:r})):a.createElement(m,o({ref:n},p))}));function m(e,n){var r=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var t=r.length,o=new Array(t);o[0]=u;var c={};for(var i in n)hasOwnProperty.call(n,i)&&(c[i]=n[i]);c.originalType=e,c[s]="string"==typeof e?e:l,o[1]=c;for(var g=2;g<t;g++)o[g]=r[g];return a.createElement.apply(null,o)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"}}]);