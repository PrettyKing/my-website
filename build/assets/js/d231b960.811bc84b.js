"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2056],{5680:(e,n,r)=>{r.d(n,{xA:()=>m,yg:()=>y});var a=r(6540);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function l(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,a)}return r}function t(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?l(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,a,o=function(e,n){if(null==e)return{};var r,a,o={},l=Object.keys(e);for(a=0;a<l.length;a++)r=l[a],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)r=l[a],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var p=a.createContext({}),c=function(e){var n=a.useContext(p),r=n;return e&&(r="function"==typeof e?e(n):t(t({},n),e)),r},m=function(e){var n=c(e.components);return a.createElement(p.Provider,{value:n},e.children)},i="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var r=e.components,o=e.mdxType,l=e.originalType,p=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),i=c(r),d=o,y=i["".concat(p,".").concat(d)]||i[d]||g[d]||l;return r?a.createElement(y,t(t({ref:n},m),{},{components:r})):a.createElement(y,t({ref:n},m))}));function y(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var l=r.length,t=new Array(l);t[0]=d;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s[i]="string"==typeof e?e:o,t[1]=s;for(var c=2;c<l;c++)t[c]=r[c];return a.createElement.apply(null,t)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},8033:(e,n,r)=>{r.r(n),r.d(n,{contentTitle:()=>t,default:()=>i,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var a=r(8168),o=(r(6540),r(5680));const l={},t=void 0,s={unversionedId:"docker/Docker-compose\u57fa\u672c\u8bed\u6cd5",id:"docker/Docker-compose\u57fa\u672c\u8bed\u6cd5",isDocsHomePage:!1,title:"Docker-compose\u57fa\u672c\u8bed\u6cd5",description:"`yaml",source:"@site/docs\\docker\\Docker-compose\u57fa\u672c\u8bed\u6cd5.md",sourceDirName:"docker",slug:"/docker/Docker-compose\u57fa\u672c\u8bed\u6cd5",permalink:"/docs/docker/Docker-compose\u57fa\u672c\u8bed\u6cd5",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/docker\\Docker-compose\u57fa\u672c\u8bed\u6cd5.md",version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Docker image Build \u9ad8\u7ea7",permalink:"/docs/docker/Docker image Build \u9ad8\u7ea7"},next:{title:"Dockerfile\u8bed\u6cd5",permalink:"/docs/docker/Dockerfile\u8bed\u6cd5"}},p=[{value:"Example",id:"example",children:[]}],c={toc:p},m="wrapper";function i(e){let{components:n,...r}=e;return(0,o.yg)(m,(0,a.A)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"version: '2'\nservices:\n  web:\n    image: dockercloud/hello-world\n    ports:\n      - 8080\n    networks:\n      - front-tier\n      - back-tier\n \n  redis:\n    image: redis\n    links:\n      - web\n    networks:\n      - back-tier\n \n  lb:\n    image: dockercloud/haproxy\n    ports:\n      - 80:80\n    links:\n      - web\n    networks:\n      - front-tier\n      - back-tier\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock \n \nnetworks:\n  front-tier:\n    driver: bridge\n  back-tier:\ndriver: bridge\n")),(0,o.yg)("h5",{id:"1image"},"1\u3001image"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"services:\n  web:\n    image: hello-world\n")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"# \u955c\u50cf\u53ef\u7528\u683c\u5f0f\nimage: redis\nimage: ubuntu:14.04\nimage: tutum/influxdb\nimage: example-registry.com:4000/postgresql\nimage: a4bc65fd\n")),(0,o.yg)("h5",{id:"2build"},"2\u3001build"),(0,o.yg)("p",null,"\u670d\u52a1\u9664\u4e86\u53ef\u4ee5\u57fa\u4e8e\u6307\u5b9a\u7684\u955c\u50cf\uff0c\u8fd8\u53ef\u4ee5\u57fa\u4e8e\u4e00\u4efd Dockerfile\uff0c\u5728\u4f7f\u7528 up \u542f\u52a8\u4e4b\u65f6\u6267\u884c\u6784\u5efa\u4efb\u52a1\uff0c\u8fd9\u4e2a\u6784\u5efa\u6807\u7b7e\u5c31\u662f build\uff0c\u5b83\u53ef\u4ee5\u6307\u5b9a Dockerfile \u6240\u5728\u6587\u4ef6\u5939\u7684\u8def\u5f84\u3002Compose \u5c06\u4f1a\u5229\u7528\u5b83\u81ea\u52a8\u6784\u5efa\u8fd9\u4e2a\u955c\u50cf\uff0c\u7136\u540e\u4f7f\u7528\u8fd9\u4e2a\u955c\u50cf\u542f\u52a8\u670d\u52a1\u5bb9\u5668"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"build: /path/to/build/dir\n")),(0,o.yg)("p",null,"\u4e5f\u53ef\u4ee5\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u53ea\u8981\u4e0a\u4e0b\u6587\u786e\u5b9a\u5c31\u53ef\u4ee5\u8bfb\u53d6\u5230 Dockerfile"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"build: ./dir\n")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"build:\n  context: ../\n  dockerfile: path/of/Dockerfile\n   args:\n    buildno: 1\n    password: secret\nimage: webapp:tag\n")),(0,o.yg)("h5",{id:"3command"},"3\u3001command"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"}," \n# == \ncommand: [bundle, exec, thin, -p, 3000]\n")),(0,o.yg)("h5",{id:"4container_name\u9879\u76ee\u540d\u79f0\u670d\u52a1\u540d\u79f0\u5e8f\u53f7"},"4\u3001container_name\uff1a<\u9879\u76ee\u540d\u79f0><\u670d\u52a1\u540d\u79f0><\u5e8f\u53f7>"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"container_name: app\n")),(0,o.yg)("h5",{id:"5depends_on"},"5\u3001depends_on"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"version: '2'\nservices:\n  web:\n    build: .\n    depends_on:\n      - db\n      - redis\n  redis:\n    image: redis\n  db:\n    image: postgres\n")),(0,o.yg)("h5",{id:"6dns"},"6\u3001dns"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"dns: 8.8.8.8\n\ndns:\n  - 8.8.8.8\n  - 9.9.9.9\n")),(0,o.yg)("h5",{id:"7tmpfs"},"7\u3001tmpfs"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"tmpfs: /run\ntmpfs:\n  - /run\n  - /tmp\n")),(0,o.yg)("h5",{id:"8-entrypoint"},"8\u3001 entrypoint"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"entrypoint: /code/entrypoint.sh\n")),(0,o.yg)("h5",{id:"9env_file"},"9\u3001env_file"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"env_file: .env\naa=123\nname=zhangsan\naddr=beijing\n\nenv_file:\n  - ./common.env\n  - ./apps/web.env\n  - /opt/secrets.env\n")),(0,o.yg)("h5",{id:"10environment\u955c\u50cf\u53d8\u91cf"},"10\u3001environment\uff1a\u955c\u50cf\u53d8\u91cf"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"environment:\n  RACK_ENV: development\n  SHOW: 'true'\n  SESSION_SECRET: 123\n \n ==\n \nenvironment:\n  - RACK_ENV=development\n  - SHOW=true\n  - SESSION_SECRET\n")),(0,o.yg)("h5",{id:"11expose"},"11\u3001expose"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'expose:\n - "3000"\n - "8000"\n')),(0,o.yg)("h5",{id:"12-external_links\u94fe\u63a5\u5916\u90e8\u5bb9\u5668"},"12\u3001 external_links\uff1a\u94fe\u63a5\u5916\u90e8\u5bb9\u5668"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"external_links:\n - redis_1\n - project_db_1:mysql\n - project_db_1:postgresql\n")),(0,o.yg)("h5",{id:"13extra_hosts"},"13\u3001extra_hosts"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'extra_hosts:\n - "somehost:162.242.195.82"\n - "otherhost:50.31.209.229"\n')),(0,o.yg)("h5",{id:"14labels"},"14\u3001labels"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'labels:\n  com.example.description: "Accounting webapp"\n  com.example.department: "Finance"\n  com.example.label-with-empty-value: ""\nlabels:\n  - "com.example.description=Accounting webapp"\n  - "com.example.department=Finance"\n  - "com.example.label-with-empty-value"\n')),(0,o.yg)("h5",{id:"15links\u4e0e-docker-client-\u7684---link-\u4e00\u6837\u6548\u679c\u4f1a\u8fde\u63a5\u5230\u5176\u5b83\u670d\u52a1\u4e2d\u7684\u5bb9\u5668"},"15\u3001links\uff1a\u4e0e Docker client \u7684 --link \u4e00\u6837\u6548\u679c\uff0c\u4f1a\u8fde\u63a5\u5230\u5176\u5b83\u670d\u52a1\u4e2d\u7684\u5bb9\u5668"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"web:\n  links:\n   - db:database\n   - redis\n")),(0,o.yg)("h5",{id:"16-logging"},"16\u3001 logging"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'logging:\n  driver: syslog\n  options:\n    syslog-address: "tcp://192.168.0.42:123"\n')),(0,o.yg)("h5",{id:"17pid"},"17\u3001pid"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'pid: "host"\n')),(0,o.yg)("h5",{id:"18port"},"18\u3001port"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'ports:\n - "3000"\n - "8000:8000"\n - "49100:22"\n - "127.0.0.1:8001:8001"\n')),(0,o.yg)("h5",{id:"19security_opt"},"19\u3001security_opt"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"# \u4e3a\u6bcf\u4e2a\u5bb9\u5668\u8986\u76d6\u9ed8\u8ba4\u7684\u6807\u7b7e\u3002\u7b80\u5355\u8bf4\u6765\u5c31\u662f\u7ba1\u7406\u5168\u90e8\u670d\u52a1\u7684\u6807\u7b7e\u3002\u6bd4\u5982\u8bbe\u7f6e\u5168\u90e8\u670d\u52a1\u7684user\u6807\u7b7e\u503c\u4e3aUSER\u3002\nsecurity_opt:\n  - label:user:USER\n  - label:role:ROLE\n")),(0,o.yg)("h5",{id:"20-stop_signal"},"20\u3001 stop_signal"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"stop_signal: SIGUSR1\n")),(0,o.yg)("h5",{id:"21volumes"},"21\u3001volumes"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"volumes:\n  // \u53ea\u662f\u6307\u5b9a\u4e00\u4e2a\u8def\u5f84\uff0cDocker \u4f1a\u81ea\u52a8\u5728\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377\uff08\u8fd9\u4e2a\u8def\u5f84\u662f\u5bb9\u5668\u5185\u90e8\u7684\uff09\u3002\n  - /var/lib/mysql\n \n  // \u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u6302\u8f7d\u6570\u636e\u5377\n  - /opt/data:/var/lib/mysql\n \n  // \u4ee5 Compose \u914d\u7f6e\u6587\u4ef6\u4e3a\u4e2d\u5fc3\u7684\u76f8\u5bf9\u8def\u5f84\u4f5c\u4e3a\u6570\u636e\u5377\u6302\u8f7d\u5230\u5bb9\u5668\u3002\n  - ./cache:/tmp/cache\n \n  // \u4f7f\u7528\u7528\u6237\u7684\u76f8\u5bf9\u8def\u5f84\uff08~/ \u8868\u793a\u7684\u76ee\u5f55\u662f /home/<\u7528\u6237\u76ee\u5f55>/ \u6216\u8005 /root/\uff09\u3002\n  - ~/configs:/etc/configs/:ro\n \n  // \u5df2\u7ecf\u5b58\u5728\u7684\u547d\u540d\u7684\u6570\u636e\u5377\u3002\n  - datavolume:/var/lib/mysql\n")),(0,o.yg)("h5",{id:"22volumes_from\u4ece\u5176\u5b83\u5bb9\u5668\u6216\u8005\u670d\u52a1\u6302\u8f7d\u6570\u636e\u5377\u53ef\u9009\u7684\u53c2\u6570\u662f-ro\u6216\u8005-rw\u524d\u8005\u8868\u793a\u5bb9\u5668\u53ea\u8bfb\u540e\u8005\u8868\u793a\u5bb9\u5668\u5bf9\u6570\u636e\u5377\u662f\u53ef\u8bfb\u53ef\u5199\u7684\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u53ef\u8bfb\u53ef\u5199\u7684"},"22\u3001volumes_from\uff1a\u4ece\u5176\u5b83\u5bb9\u5668\u6216\u8005\u670d\u52a1\u6302\u8f7d\u6570\u636e\u5377\uff0c\u53ef\u9009\u7684\u53c2\u6570\u662f :ro\u6216\u8005 :rw\uff0c\u524d\u8005\u8868\u793a\u5bb9\u5668\u53ea\u8bfb\uff0c\u540e\u8005\u8868\u793a\u5bb9\u5668\u5bf9\u6570\u636e\u5377\u662f\u53ef\u8bfb\u53ef\u5199\u7684\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u53ef\u8bfb\u53ef\u5199\u7684"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"volumes_from:\n  - service_name\n  - service_name:ro\n  - container:container_name\n  - container:container_name:rw\n")),(0,o.yg)("h5",{id:"23cap_add-cap_drop"},"23\u3001cap_add, cap_drop"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"cap_add:\n  - ALL\n \ncap_drop:\n  - NET_ADMIN\n  - SYS_ADMIN\n")),(0,o.yg)("h5",{id:"24extends"},"24\u3001extends"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"extends:\n  file: common.yml\n  service: webapp\n")),(0,o.yg)("h5",{id:"25network_mode"},"25\u3001network_mode"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'network_mode: "bridge"\nnetwork_mode: "host"\nnetwork_mode: "none"\nnetwork_mode: "service:[service name]"\nnetwork_mode: "container:[container name/id]"\n')),(0,o.yg)("h5",{id:"26-networks"},"26\u3001 networks"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"services:\n  some-service:\n    networks:\n     - some-network\n     - other-network\n")),(0,o.yg)("h2",{id:"example"},"Example"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"version: '2'\n\nservices:\n   db:\n     image: mysql:5.7\n     restart: always\n     environment:\n       MYSQL_ROOT_PASSWORD: somewordpress\n       MYSQL_DATABASE: wordpress\n       MYSQL_USER: wordpress\n       MYSQL_PASSWORD: wordpress\n\n   wordpress:\n     depends_on:\n       - db\n     image: wordpress:latest\n     restart: always\n     ports:\n       - \"8000:80\"\n     environment:\n       WORDPRESS_DB_HOST: db:3306\n       WORDPRESS_DB_USER: wordpress\n       WORDPRESS_DB_PASSWORD: wordpress\n")))}i.isMDXComponent=!0}}]);