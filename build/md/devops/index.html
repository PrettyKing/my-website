<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="å«è¾° Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="å«è¾° Blog Atom Feed"><title data-react-helmet="true">å«è¾°</title><meta data-react-helmet="true" property="og:title" content="å«è¾°"><meta data-react-helmet="true" property="og:url" content="http://githubci.faithcal.com/md/devops"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://githubci.faithcal.com/md/devops"><link data-react-helmet="true" rel="alternate" href="http://githubci.faithcal.com/md/devops" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://githubci.faithcal.com/md/devops" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2a08f740.css">
<link rel="preload" href="/assets/js/runtime~main.fcd159b8.js" as="script">
<link rel="preload" href="/assets/js/main.d15b887f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/logo.png" alt="è¯—çš„è¿œæ–¹" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/logo.png" alt="è¯—çš„è¿œæ–¹" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">å«è¾°</b></a><a class="navbar__item navbar__link" href="/docs/intro">å¤§å‰ç«¯</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/md/devops">devops</a><a class="navbar__item navbar__link" href="/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/logo.png" alt="è¯—çš„è¿œæ–¹" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/logo.png" alt="è¯—çš„è¿œæ–¹" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">å«è¾°</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">å¤§å‰ç«¯</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/md/devops">devops</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">åšå®¢</a></li></ul></div></div></div></nav><div class="main-wrapper mdx-wrapper mdx-page"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_eQvw"><div class="col col--8"><header><h1 class="h1Heading_dC7a">DevOps</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="ä¸€devopsä»‹ç»"></a>ä¸€ã€DevOpsä»‹ç»<a class="hash-link" href="#ä¸€devopsä»‹ç»" title="Direct link to heading">#</a></h3><p>è½¯ä»¶å¼€å‘æœ€å¼€å§‹æ˜¯ç”±ä¸¤ä¸ªå›¢é˜Ÿç»„æˆï¼š</p><ul><li>å¼€å‘è®¡åˆ’ç”±<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">å¼€å‘å›¢é˜Ÿ</a>ä»å¤´å¼€å§‹è®¾è®¡å’Œæ•´ä½“ç³»ç»Ÿçš„æ„å»ºã€‚éœ€è¦ç³»ç»Ÿä¸åœçš„è¿­ä»£æ›´æ–°ã€‚</li><li><a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">è¿ç»´å›¢é˜Ÿ</a>å°†å¼€å‘å›¢é˜Ÿçš„Codeè¿›è¡Œæµ‹è¯•åéƒ¨ç½²ä¸Šçº¿ã€‚å¸Œæœ›ç³»ç»Ÿç¨³å®šå®‰å…¨è¿è¡Œã€‚</li></ul><p>è¿™çœ‹ä¼¼ä¸¤ä¸ªç›®æ ‡ä¸åŒçš„å›¢é˜Ÿéœ€è¦ååŒå®Œæˆä¸€ä¸ªè½¯ä»¶çš„å¼€å‘ã€‚</p><p>åœ¨å¼€å‘å›¢é˜ŸæŒ‡å®šå¥½è®¡åˆ’å¹¶å®Œæˆcodingåï¼Œéœ€è¦æä¾›åˆ°è¿ç»´å›¢é˜Ÿã€‚</p><p>è¿ç»´å›¢é˜Ÿå‘å¼€å‘å›¢é˜Ÿåé¦ˆéœ€è¦ä¿®å¤çš„BUGä»¥åŠä¸€äº›éœ€è¦è¿”å·¥çš„ä»»åŠ¡ã€‚</p><p>è¿™æ—¶å¼€å‘å›¢é˜Ÿéœ€è¦ç»å¸¸ç­‰å¾…è¿ç»´å›¢é˜Ÿçš„åé¦ˆã€‚è¿™æ— ç–‘å»¶é•¿äº†äº‹ä»¶å¹¶æ¨è¿Ÿäº†æ•´ä¸ªè½¯ä»¶å¼€å‘çš„å‘¨æœŸã€‚</p><p>ä¼šæœ‰ä¸€ç§æ–¹å¼ï¼Œåœ¨å¼€å‘å›¢é˜Ÿç­‰å¾…çš„æ—¶å€™ï¼Œè®©å¼€å‘å›¢é˜Ÿè½¬ç§»åˆ°ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­ã€‚ç­‰å¾…è¿ç»´å›¢é˜Ÿä¸ºä¹‹å‰çš„ä»£ç æä¾›åé¦ˆã€‚</p><p>å¯æ˜¯è¿™æ ·å°±æ„å‘³ç€ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®éœ€è¦ä¸€ä¸ªæ›´é•¿çš„å‘¨æœŸæ‰å¯ä»¥å¼€å‘å‡ºæœ€ç»ˆä»£ç ã€‚</p><hr><p>åŸºäºç°åœ¨çš„äº’è”ç½‘ç°çŠ¶ï¼Œæ›´æ¨å´‡æ•æ·å¼å¼€å‘ï¼Œè¿™æ ·å°±å¯¼è‡´é¡¹ç›®çš„è¿­ä»£é€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯ç”±äºå¼€å‘å›¢é˜Ÿä¸è¿ç»´å›¢é˜Ÿçš„æ²Ÿé€šé—®é¢˜ï¼Œä¼šå¯¼è‡´æ–°ç‰ˆæœ¬ä¸Šçº¿çš„æ—¶é—´æˆæœ¬å¾ˆé«˜ã€‚è¿™åˆè¿èƒŒçš„æ•æ·å¼å¼€å‘çš„æœ€åˆçš„ç›®çš„ã€‚</p><p>é‚£ä¹ˆå¦‚æœè®©å¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿæ•´åˆåˆ°æˆä¸€ä¸ªå›¢é˜Ÿï¼ŒååŒåº”å¯¹ä¸€å¥—è½¯ä»¶å‘¢ï¼Ÿè¿™å°±è¢«ç§°ä¸º<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>ã€‚</p><p><a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>ï¼Œå­—é¢æ„æ€æ˜¯Development &amp;Operationsçš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯å¼€å‘&amp;è¿ç»´ã€‚</p><p>è™½ç„¶å­—é¢æ„æ€åªæ¶‰åŠåˆ°äº†å¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿï¼Œå…¶å®QAæµ‹è¯•å›¢é˜Ÿä¹Ÿæ˜¯å‚ä¸å…¶ä¸­çš„ã€‚</p><p>ç½‘ä¸Šå¯ä»¥æŸ¥çœ‹åˆ°<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>çš„ç¬¦å·ç±»ä¼¼äºä¸€ä¸ªæ— ç©·å¤§çš„ç¬¦å·</p><table><thead><tr><th align="center"><a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a></th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124130409521.png" alt="image-20211124130409521"></td></tr></tbody></table><p>è¿™è¡¨æ˜<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>æ˜¯ä¸€ä¸ªä¸æ–­æé«˜æ•ˆç‡å¹¶ä¸”æŒç»­ä¸æ–­å·¥ä½œçš„è¿‡ç¨‹</p><p><a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>çš„æ–¹å¼å¯ä»¥è®©å…¬å¸èƒ½å¤Ÿæ›´å¿«åœ°åº”å¯¹æ›´æ–°å’Œå¸‚åœºå‘å±•å˜åŒ–ï¼Œå¼€å‘å¯ä»¥å¿«é€Ÿäº¤ä»˜ï¼Œéƒ¨ç½²ä¹Ÿæ›´åŠ ç¨³å®šã€‚</p><p>æ ¸å¿ƒå°±åœ¨äº<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">ç®€åŒ–Devå’ŒOpså›¢é˜Ÿä¹‹é—´çš„æµç¨‹ï¼Œä½¿æ•´ä½“è½¯ä»¶å¼€å‘è¿‡ç¨‹æ›´å¿«é€Ÿã€‚</a></p><p>æ•´ä½“çš„è½¯ä»¶å¼€å‘æµç¨‹åŒ…æ‹¬ï¼š</p><ul><li>PLANï¼šå¼€å‘å›¢é˜Ÿæ ¹æ®å®¢æˆ·çš„ç›®æ ‡åˆ¶å®šå¼€å‘è®¡åˆ’</li><li>CODEï¼šæ ¹æ®PLANå¼€å§‹ç¼–ç è¿‡ç¨‹ï¼Œéœ€è¦å°†ä¸åŒç‰ˆæœ¬çš„ä»£ç å­˜å‚¨åœ¨ä¸€ä¸ªåº“ä¸­ã€‚</li><li>BUILDï¼šç¼–ç å®Œæˆåï¼Œéœ€è¦å°†ä»£ç æ„å»ºå¹¶ä¸”è¿è¡Œã€‚</li><li>TESTï¼šæˆåŠŸæ„å»ºé¡¹ç›®åï¼Œéœ€è¦æµ‹è¯•ä»£ç æ˜¯å¦å­˜åœ¨BUGæˆ–é”™è¯¯ã€‚</li><li>DEPLOYï¼šä»£ç ç»è¿‡æ‰‹åŠ¨æµ‹è¯•å’Œè‡ªåŠ¨åŒ–æµ‹è¯•åï¼Œè®¤å®šä»£ç å·²ç»å‡†å¤‡å¥½éƒ¨ç½²å¹¶ä¸”äº¤ç»™è¿ç»´å›¢é˜Ÿã€‚</li><li>OPERATEï¼šè¿ç»´å›¢é˜Ÿå°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</li><li>MONITORï¼šé¡¹ç›®éƒ¨ç½²ä¸Šçº¿åï¼Œéœ€è¦æŒç»­çš„ç›‘æ§äº§å“ã€‚</li><li>INTEGRATEï¼šç„¶åå°†ç›‘æ§é˜¶æ®µæ”¶åˆ°çš„åé¦ˆå‘é€å›PLANé˜¶æ®µï¼Œæ•´ä½“åå¤çš„æµç¨‹å°±æ˜¯<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>çš„æ ¸å¿ƒï¼Œå³æŒç»­é›†æˆã€æŒç»­éƒ¨ç½²ã€‚</li></ul><p>ä¸ºäº†ä¿è¯æ•´ä½“æµç¨‹å¯ä»¥é«˜æ•ˆçš„å®Œæˆï¼Œå„ä¸ªé˜¶æ®µéƒ½æœ‰æ¯”è¾ƒå¸¸è§çš„å·¥å…·ï¼Œå¦‚ä¸‹å›¾ï¼š</p><table><thead><tr><th align="center">è½¯ä»¶å¼€å‘è¿‡ç¨‹&amp;æ¶‰åŠå·¥å…·</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/2021-11-23_175935.png" alt="2021-11-23_175935"></td></tr></tbody></table><p>æœ€ç»ˆå¯ä»¥ç»™<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>ä¸‹ä¸€ä¸ªå®šä¹‰ï¼š<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps å¼ºè°ƒçš„æ˜¯é«˜æ•ˆç»„ç»‡å›¢é˜Ÿä¹‹é—´å¦‚ä½•é€šè¿‡è‡ªåŠ¨åŒ–çš„å·¥å…·åä½œå’Œæ²Ÿé€šæ¥å®Œæˆè½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä»è€Œæ›´å¿«ã€æ›´é¢‘ç¹åœ°äº¤ä»˜æ›´ç¨³å®šçš„è½¯ä»¶ã€‚</a></p><p>è‡ªåŠ¨åŒ–çš„å·¥å…·åä½œå’Œæ²Ÿé€šæ¥å®Œæˆè½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="äºŒcodeé˜¶æ®µå·¥å…·"></a>äºŒã€Codeé˜¶æ®µå·¥å…·<a class="hash-link" href="#äºŒcodeé˜¶æ®µå·¥å…·" title="Direct link to heading">#</a></h3><p>åœ¨codeé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸åŒç‰ˆæœ¬çš„ä»£ç å­˜å‚¨åˆ°ä¸€ä¸ªä»“åº“ä¸­ï¼Œå¸¸è§çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·å°±æ˜¯SVNæˆ–è€…Gitï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨Gitä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼ŒGitLabä½œä¸ºè¿œç¨‹ä»“åº“ã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="21-gitå®‰è£…"></a>2.1 Gitå®‰è£…<a class="hash-link" href="#21-gitå®‰è£…" title="Direct link to heading">#</a></h4><p><a href="https://git-scm.com/%EF%BC%88%E5%82%BB%E7%93%9C%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89" target="_blank" rel="noopener noreferrer">https://git-scm.com/ï¼ˆå‚»ç“œå¼å®‰è£…ï¼‰</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="22-gitlabå®‰è£…"></a>2.2 GitLabå®‰è£…<a class="hash-link" href="#22-gitlabå®‰è£…" title="Direct link to heading">#</a></h4><p>å•ç‹¬å‡†å¤‡æœåŠ¡å™¨ï¼Œé‡‡ç”¨Dockerå®‰è£…</p><ul><li><p>æŸ¥çœ‹GitLabé•œåƒ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker search gitlab</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ‹‰å–GitLabé•œåƒ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull gitlab/gitlab-ce</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‡†å¤‡docker-compose.ymlæ–‡ä»¶</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3.1&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gitlab</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;gitlab/gitlab-ce:latest&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">GITLAB_OMNIBUS_CONFIG</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        external_url &#x27;http://192.168.11.11:8929&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        gitlab_rails[&#x27;gitlab_shell_ssh_port&#x27;] = 2224</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;8929:8929&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2224:2224&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./config:/etc/gitlab&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./logs:/var/log/gitlab&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./data:/var/opt/gitlab&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å¯åŠ¨å®¹å™¨ï¼ˆéœ€è¦ç¨ç­‰ä¸€å°ä¼šâ€¦â€¦ï¼‰</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose up -d</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>è®¿é—®GitLabé¦–é¡µ</p><table><thead><tr><th align="center">é¦–é¡µ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124182140596.png" alt="image-20211124182140596"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹rootç”¨æˆ·åˆå§‹å¯†ç </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it gitlab cat /etc/gitlab/initial_root_password</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">åˆå§‹å¯†ç </th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124182921234.png" alt="image-20211124182921234"></td></tr></tbody></table></li><li><p>ç™»å½•rootç”¨æˆ·</p><table><thead><tr><th align="center">ç™»å½•æˆåŠŸåè·³è½¬é¡µé¢</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124183003858.png" alt="image-20211124183003858"></td></tr></tbody></table></li><li><p>ç¬¬ä¸€æ¬¡ç™»å½•åéœ€è¦ä¿®æ”¹å¯†ç </p><table><thead><tr><th align="center">ä¿®æ”¹å¯†ç </th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124193444561.png" alt="image-20211124193444561"></td></tr></tbody></table></li></ul><p>æå®šåï¼Œå³å¯åƒGiteeã€GitHubä¸€æ ·ä½¿ç”¨ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="ä¸‰buildé˜¶æ®µå·¥å…·"></a>ä¸‰ã€Buildé˜¶æ®µå·¥å…·<a class="hash-link" href="#ä¸‰buildé˜¶æ®µå·¥å…·" title="Direct link to heading">#</a></h3><p>æ„å»ºJavaé¡¹ç›®çš„å·¥å…·ä¸€èˆ¬æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯Mavenï¼Œä¸€ä¸ªæ˜¯Gradleã€‚</p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©Mavenä½œä¸ºé¡¹ç›®çš„ç¼–è¯‘å·¥å…·ã€‚</p><p>å…·ä½“å®‰è£…Mavenæµç¨‹ä¸åšé˜è¿°ï¼Œä½†æ˜¯éœ€è¦ç¡®ä¿é…ç½®å¥½Mavenä»“åº“ç§æœä»¥åŠJDKç¼–è¯‘ç‰ˆæœ¬ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="å››operateé˜¶æ®µå·¥å…·"></a>å››ã€Operateé˜¶æ®µå·¥å…·<a class="hash-link" href="#å››operateé˜¶æ®µå·¥å…·" title="Direct link to heading">#</a></h3><p>éƒ¨ç½²è¿‡ç¨‹ï¼Œä¼šé‡‡ç”¨Dockerè¿›è¡Œéƒ¨ç½²ï¼Œæš‚æ—¶åªå®‰è£…Dockerå³å¯ï¼Œåç»­è¿˜éœ€å®‰è£…Kubenetes</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="41-dockerå®‰è£…"></a>4.1 Dockerå®‰è£…<a class="hash-link" href="#41-dockerå®‰è£…" title="Direct link to heading">#</a></h4><ul><li><p>å‡†å¤‡æµ‹è¯•ç¯å¢ƒ&amp;ç”Ÿäº§ç¯å¢ƒ</p></li><li><p>ä¸‹è½½Dockerä¾èµ–ç»„ä»¶</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install yum-utils device-mapper-persistent-data lvm2</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>è®¾ç½®ä¸‹è½½Dockerçš„é•œåƒæºä¸ºé˜¿é‡Œäº‘</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å®‰è£…DockeræœåŠ¡</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install docker-ce</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å®‰è£…æˆåŠŸåï¼Œå¯åŠ¨Dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># å¯åŠ¨DockeræœåŠ¡</span></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start docker</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</span></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable docker</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æµ‹è¯•å®‰è£…æˆåŠŸ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker version</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">æ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124200317795.png" alt="image-20211124200317795"></td></tr></tbody></table></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="42-docker-composeå®‰è£…"></a>4.2 Docker-Composeå®‰è£…<a class="hash-link" href="#42-docker-composeå®‰è£…" title="Direct link to heading">#</a></h4><ul><li><p>ä¸‹è½½Docker/Composeï¼š<a href="https://github.com/docker/compose" target="_blank" rel="noopener noreferrer">https://github.com/docker/compose</a></p></li><li><p>å°†ä¸‹è½½å¥½çš„<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">docker-compose-Linux-x86_64</a>æ–‡ä»¶ç§»åŠ¨åˆ°Linuxæ“ä½œç³»ç»Ÿï¼šâ€¦â€¦</p></li><li><p>è®¾ç½®<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">docker-compose-Linux-x86_64</a>æ–‡ä»¶æƒé™ï¼Œå¹¶ç§»åŠ¨åˆ°$PATHç›®å½•ä¸­</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># è®¾ç½®æ–‡ä»¶æƒé™</span></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod a+x docker-compose-Linux-x86_64</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># ç§»åŠ¨åˆ°/usr/binç›®å½•ä¸‹ï¼Œå¹¶é‡å‘½åä¸ºdocker-compose</span></span><span class="token-line" style="color:#393A34"><span class="token plain">mv docker-compose-Linux-x86_64 /usr/bin/docker-compose</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æµ‹è¯•å®‰è£…æˆåŠŸ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose version</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">æ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124200658107.png" alt="image-20211124200658107"></td></tr></tbody></table></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="äº”integrateå·¥å…·"></a>äº”ã€Integrateå·¥å…·<a class="hash-link" href="#äº”integrateå·¥å…·" title="Direct link to heading">#</a></h3><p>æŒç»­é›†æˆã€æŒç»­éƒ¨ç½²çš„å·¥å…·å¾ˆå¤šï¼Œå…¶ä¸­Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„æŒç»­é›†æˆå¹³å°ã€‚</p><p>Jenkinsæ¶‰åŠåˆ°å°†ç¼–å†™å®Œæ¯•çš„ä»£ç å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¿˜æ¶‰åŠåˆ°äº†æ„å»ºé¡¹ç›®ç­‰ä»»åŠ¡ã€‚</p><p>Jenkinséœ€è¦å¤§é‡çš„æ’ä»¶ä¿è¯å·¥ä½œï¼Œå®‰è£…æˆæœ¬è¾ƒé«˜ï¼Œä¸‹é¢ä¼šåŸºäºDockeræ­å»ºJenkinsã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="51-jenkinsä»‹ç»"></a>5.1 Jenkinsä»‹ç»<a class="hash-link" href="#51-jenkinsä»‹ç»" title="Direct link to heading">#</a></h4><p>Jenkinsæ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶é¡¹ç›®ï¼Œæ˜¯åŸºäºJavaå¼€å‘çš„ä¸€ç§æŒç»­é›†æˆå·¥å…·</p><p>Jenkinsåº”ç”¨å¹¿æ³›ï¼Œå¤§å¤šæ•°äº’è”ç½‘å…¬å¸éƒ½é‡‡ç”¨Jenkinsé…åˆGitLabã€Dockerã€K8sä½œä¸ºå®ç°<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>çš„æ ¸å¿ƒå·¥å…·ã€‚</p><p>Jenkinsæœ€å¼ºå¤§çš„å°±åœ¨äºæ’ä»¶ï¼ŒJenkinså®˜æ–¹æä¾›äº†å¤§é‡çš„æ’ä»¶åº“ï¼Œæ¥è‡ªåŠ¨åŒ–CI/CDè¿‡ç¨‹ä¸­çš„å„ç§çç¢åŠŸèƒ½ã€‚</p><table><thead><tr><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125141950900.png" alt="image-20211125141950900"></td><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125141701495.png" alt="image-20211124200317795"></td></tr></tbody></table><p>Jenkinsæœ€ä¸»è¦çš„å·¥ä½œå°±æ˜¯å°†GitLabä¸Šå¯ä»¥æ„å»ºçš„å·¥ç¨‹ä»£ç æ‹‰å–å¹¶ä¸”è¿›è¡Œæ„å»ºï¼Œå†æ ¹æ®æµç¨‹å¯ä»¥é€‰æ‹©å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒæˆ–æ˜¯ç”Ÿäº§ç¯å¢ƒã€‚</p><p>ä¸€èˆ¬æ˜¯GitLabä¸Šçš„ä»£ç ç»è¿‡å¤§é‡çš„æµ‹è¯•åï¼Œç¡®å®šå‘è¡Œç‰ˆæœ¬ï¼Œå†å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p><p>CI/CDå¯ä»¥ç†è§£ä¸ºï¼š</p><ul><li>CIè¿‡ç¨‹å³æ˜¯é€šè¿‡Jenkinså°†ä»£ç æ‹‰å–ã€æ„å»ºã€åˆ¶ä½œé•œåƒäº¤ç»™æµ‹è¯•äººå‘˜æµ‹è¯•ã€‚<ul><li>æŒç»­é›†æˆï¼šè®©è½¯ä»¶ä»£ç å¯ä»¥æŒç»­çš„é›†æˆåˆ°ä¸»å¹²ä¸Šï¼Œå¹¶è‡ªåŠ¨æ„å»ºå’Œæµ‹è¯•ã€‚</li></ul></li><li>CDè¿‡ç¨‹å³æ˜¯é€šè¿‡Jenkinså°†æ‰“å¥½æ ‡ç­¾çš„å‘è¡Œç‰ˆæœ¬ä»£ç æ‹‰å–ã€æ„å»ºã€åˆ¶ä½œé•œåƒäº¤ç»™è¿ç»´äººå‘˜éƒ¨ç½²ã€‚<ul><li>æŒç»­äº¤ä»˜ï¼šè®©ç»è¿‡æŒç»­é›†æˆçš„ä»£ç å¯ä»¥è¿›è¡Œæ‰‹åŠ¨éƒ¨ç½²ã€‚</li><li>æŒç»­éƒ¨ç½²ï¼šè®©å¯ä»¥æŒç»­äº¤ä»˜çš„ä»£ç éšæ—¶éšåœ°çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</li></ul></li></ul><table><thead><tr><th align="center">CIã€CD</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125154112097.png" alt="image-20211125154112097"></td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="52-jenkinså®‰è£…"></a>5.2 Jenkinså®‰è£…<a class="hash-link" href="#52-jenkinså®‰è£…" title="Direct link to heading">#</a></h4><ul><li><p>æ‹‰å–Jenkinsé•œåƒ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull jenkins/jenkins</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ç¼–å†™docker-compose.yml</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3.1&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jenkins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins/jenkins</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 8080</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 50000</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./data/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/jenkins_home/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>é¦–æ¬¡å¯åŠ¨ä¼šå› ä¸ºæ•°æ®å·dataç›®å½•æ²¡æœ‰æƒé™å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼Œè®¾ç½®dataç›®å½•å†™æƒé™</p><table><thead><tr><th align="center">é”™è¯¯æ—¥å¿—</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124202610243.png" alt="image-20211124202610243"></td></tr></tbody></table><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">chmod -R a+w data/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>é‡æ–°å¯åŠ¨Jenkinså®¹å™¨åï¼Œç”±äºJenkinséœ€è¦ä¸‹è½½å¤§é‡å†…å®¹ï¼Œä½†æ˜¯ç”±äºé»˜è®¤ä¸‹è½½åœ°å€ä¸‹è½½é€Ÿåº¦è¾ƒæ…¢ï¼Œéœ€è¦é‡æ–°è®¾ç½®ä¸‹è½½åœ°å€ä¸ºå›½å†…é•œåƒç«™</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># ä¿®æ”¹æ•°æ®å·ä¸­çš„hudson.model.UpdateCenter.xmlæ–‡ä»¶</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml version=&#x27;1.1&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;sites&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;site&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;id&gt;default&lt;/id&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;url&gt;https://updates.jenkins.io/update-center.json&lt;/url&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/site&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/sites&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># å°†ä¸‹è½½åœ°å€æ›¿æ¢ä¸ºhttp://mirror.esuni.jp/jenkins/updates/update-center.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml version=&#x27;1.1&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;sites&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;site&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;id&gt;default&lt;/id&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;url&gt;http://mirror.esuni.jp/jenkins/updates/update-center.json&lt;/url&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/site&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/sites&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ¸…åå¤§å­¦çš„æ’ä»¶æºä¹Ÿå¯ä»¥https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å†æ¬¡é‡å¯Jenkinså®¹å™¨ï¼Œè®¿é—®Jenkinsï¼ˆéœ€è¦ç¨å¾®ç­‰ä¼šï¼‰</p><table><thead><tr><th align="center">Jenkinsé¦–é¡µ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124204517433.png" alt="image-20211124204517433"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124203336300.png" alt="image-20211124203336300"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹å¯†ç ç™»å½•Jenkinsï¼Œå¹¶ç™»å½•ä¸‹è½½æ’ä»¶</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it jenkins cat /var/jenkins_home/secrets/initialAdminPassword</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">ç™»å½•å¹¶ä¸‹è½½æ’ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124205050484.png" alt="image-20211124205050484"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124205513465.png" alt="image-20211124205513465"></td></tr></tbody></table></li><li><p>é€‰æ‹©éœ€è¦å®‰è£…çš„æ’ä»¶</p><table><thead><tr><th align="center">é€‰æ‹©éœ€è¦å®‰è£…çš„æ’ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124205854418.png" alt="image-20211124205854418"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124205858730.png" alt="image-20211124205858730"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124205917317.png" alt="image-20211124205917317"></td></tr></tbody></table></li><li><p>ä¸‹è½½å®Œæ¯•è®¾ç½®ä¿¡æ¯è¿›å…¥é¦–é¡µï¼ˆå¯èƒ½ä¼šå‡ºç°ä¸‹è½½å¤±è´¥çš„æ’ä»¶ï¼‰</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124211635550.png" alt="image-20211124211635550"></td></tr><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124211700999.png" alt="image-20211124211700999"></td></tr><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211124211720836.png" alt="image-20211124211720836"></td></tr></tbody></table></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="53-jenkinså…¥é—¨é…ç½®"></a>5.3 Jenkinså…¥é—¨é…ç½®<a class="hash-link" href="#53-jenkinså…¥é—¨é…ç½®" title="Direct link to heading">#</a></h4><p>ç”±äºJenkinséœ€è¦ä»Gitæ‹‰å–ä»£ç ã€éœ€è¦æœ¬åœ°æ„å»ºã€ç”šè‡³éœ€è¦ç›´æ¥å‘å¸ƒè‡ªå®šä¹‰é•œåƒåˆ°Dockerä»“åº“ï¼Œæ‰€ä»¥Jenkinséœ€è¦é…ç½®å¤§é‡å†…å®¹ã€‚</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="531-æ„å»ºä»»åŠ¡"></a>5.3.1 æ„å»ºä»»åŠ¡<a class="hash-link" href="#531-æ„å»ºä»»åŠ¡" title="Direct link to heading">#</a></h5><p>å‡†å¤‡å¥½GitLabä»“åº“ä¸­çš„é¡¹ç›®ï¼Œå¹¶ä¸”é€šè¿‡Jenkinsé…ç½®é¡¹ç›®çš„å®ç°å½“å‰é¡¹ç›®çš„<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">DevOps</a>åŸºæœ¬æµç¨‹ã€‚</p><ul><li><p>æ„å»ºMavenå·¥ç¨‹å‘å¸ƒåˆ°GitLabï¼ˆGiteeã€Githubå‡å¯ï¼‰</p><table><thead><tr><th align="center">GitLabæŸ¥çœ‹é¡¹ç›®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125195818670.png" alt="image-20211125195818670"></td></tr></tbody></table></li><li><p>Jenkinsç‚¹å‡»å·¦ä¾§å¯¼èˆªæ–°å»ºä»»åŠ¡</p><table><thead><tr><th align="center">æ–°å»ºä»»åŠ¡</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125163541645.png" alt="image-20211125163541645"></td></tr></tbody></table></li><li><p>é€‰æ‹©è‡ªç”±é£æ ¼æ„å»ºä»»åŠ¡</p><table><thead><tr><th align="center">æ„å»ºä»»åŠ¡</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125170350811.png" alt="image-20211125170350811"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="531-é…ç½®æºç æ‹‰å–åœ°å€"></a>5.3.1 é…ç½®æºç æ‹‰å–åœ°å€<a class="hash-link" href="#531-é…ç½®æºç æ‹‰å–åœ°å€" title="Direct link to heading">#</a></h5><p>Jenkinséœ€è¦å°†Gitä¸Šå­˜æ”¾çš„æºç å­˜å‚¨åˆ°JenkinsæœåŠ¡æ‰€åœ¨ç£ç›˜çš„æœ¬åœ°</p><ul><li><p>é…ç½®ä»»åŠ¡æºç æ‹‰å–çš„åœ°å€</p><table><thead><tr><th align="center">æºç ç®¡ç†</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125170418337.png" alt="image-20211125170418337"></td></tr></tbody></table></li><li><p>Jenkinsç«‹å³æ„å»º</p><table><thead><tr><th align="center">ç‚¹å‡»ä»»åŠ¡testä¸­çš„ç«‹å³æ„å»º</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125200218093.png" alt="image-20211125200218093"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹æ„å»ºå·¥ç¨‹çš„æ—¥å¿—ï¼Œç‚¹å‡»ä¸Šè¿°â‘¢çš„ä»»åŠ¡æ¡å³å¯</p><table><thead><tr><th align="center">æŸ¥çœ‹ä»»åŠ¡æ‹‰å–Gitæºç æ—¥å¿—</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125201701443.png" alt="image-20211125201701443"></td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°æºç å·²ç»æ‹‰å–å¸¦Jenkinsæœ¬åœ°ï¼Œå¯ä»¥æ ¹æ®ç¬¬ä¸‰è¡Œæ—¥å¿—ä¿¡æ¯ï¼ŒæŸ¥çœ‹Jenkinsæœ¬åœ°æ‹‰å–åˆ°çš„æºç ã€‚</p></li><li><p>æŸ¥çœ‹Jenkinså®¹å™¨ä¸­<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">/var/jenkins_home/workspace/test</a>çš„æºç </p><table><thead><tr><th align="center">æºç å­˜æ”¾ä½ç½®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125201919108.png" alt="image-20211125201919108"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="532-é…ç½®mavenæ„å»ºä»£ç "></a>5.3.2 é…ç½®Mavenæ„å»ºä»£ç <a class="hash-link" href="#532-é…ç½®mavenæ„å»ºä»£ç " title="Direct link to heading">#</a></h5><p>ä»£ç æ‹‰å–åˆ°Jenkinsæœ¬åœ°åï¼Œéœ€è¦åœ¨Jenkinsä¸­å¯¹ä»£ç è¿›è¡Œæ„å»ºï¼Œè¿™é‡Œéœ€è¦Mavençš„ç¯å¢ƒï¼Œè€ŒMavenéœ€è¦Javaçš„ç¯å¢ƒï¼Œæ¥ä¸‹æ¥éœ€è¦åœ¨Jenkinsä¸­å®‰è£…JDKå’ŒMavenï¼Œå¹¶ä¸”é…ç½®åˆ°JenkinsæœåŠ¡ã€‚</p><ul><li><p>å‡†å¤‡JDKã€Mavenå‹ç¼©åŒ…é€šè¿‡æ•°æ®å·æ˜ å°„åˆ°Jenkinså®¹å™¨å†…éƒ¨</p><table><thead><tr><th align="center">æ•°æ®å·å­˜æ”¾ä½ç½®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125203757232.png" alt="image-20211125203757232"></td></tr></tbody></table></li><li><p>è§£å‹å‹ç¼©åŒ…ï¼Œå¹¶é…ç½®Mavençš„settings.xml</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI xml"><pre tabindex="0" class="prism-code language-xml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- é˜¿é‡Œäº‘é•œåƒåœ°å€ --&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mirror</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">alimaven</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">aliyun maven</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://maven.aliyun.com/nexus/content/groups/public/</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">mirrorOf</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">central</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mirrorOf</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">mirror</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- JDK1.8ç¼–è¯‘æ’ä»¶ --&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">profile</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jdk-1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">activation</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">activeByDefault</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">activeByDefault</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">jdk</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">jdk</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">activation</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.source</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.target</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maven.compiler.compilerVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maven.compiler.compilerVersion</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">profile</span><span class="token tag punctuation" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>Jenkinsé…ç½®JDK&amp;Mavenå¹¶ä¿å­˜</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125204811759.png" alt="image-20211125204811759"></td></tr><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125204818869.png" alt="image-20211125204818869"></td></tr></tbody></table></li><li><p>é…ç½®Jenkinsä»»åŠ¡æ„å»ºä»£ç </p><table><thead><tr><th align="center">é…ç½®Mavenæ„å»ºä»£ç </th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125205027013.png" alt="image-20211125205027013"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125205020738.png" alt="image-20211125205020738"></td></tr></tbody></table></li><li><p>ç«‹å³æ„å»ºæµ‹è¯•ï¼ŒæŸ¥çœ‹targetä¸‹çš„jaråŒ…</p><table><thead><tr><th align="center">æ„å»ºæºç </th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125205240208.png" alt="image-20211125205240208"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125205725948.png" alt="image-20211125205725948"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="533-é…ç½®publishå‘å¸ƒè¿œç¨‹æ“ä½œ"></a>5.3.3 é…ç½®Publishå‘å¸ƒ&amp;è¿œç¨‹æ“ä½œ<a class="hash-link" href="#533-é…ç½®publishå‘å¸ƒè¿œç¨‹æ“ä½œ" title="Direct link to heading">#</a></h5><p>jaråŒ…æ„å»ºå¥½ä¹‹åï¼Œå°±å¯ä»¥æ ¹æ®æƒ…å†µå‘å¸ƒåˆ°æµ‹è¯•æˆ–ç”Ÿäº§ç¯å¢ƒï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°ä¹‹å‰ä¸‹è½½å¥½çš„æ’ä»¶Publish Over SSHã€‚</p><ul><li><p>é…ç½®Publish Over SSHè¿æ¥æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ</p><table><thead><tr><th align="center">Publish Over SSHé…ç½®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125210148202.png" alt="image-20211125210148202"></td></tr></tbody></table></li><li><p>é…ç½®ä»»åŠ¡çš„æ„å»ºåæ“ä½œï¼Œå‘å¸ƒjaråŒ…åˆ°ç›®æ ‡æœåŠ¡</p><table><thead><tr><th align="center">é…ç½®æ„å»ºåæ“ä½œ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125205027013.png" alt="image-20211125205027013"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125210424346.png" alt="image-20211125210424346"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125210626631.png" alt="image-20211125210626631"></td></tr></tbody></table></li><li><p>ç«‹å³æ„å»ºä»»åŠ¡ï¼Œå¹¶å»ç›®æ ‡æœåŠ¡æŸ¥çœ‹</p><table><thead><tr><th align="center">ç«‹å³æ„å»º</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125210755556.png" alt="image-20211125210755556"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211125210826057.png" alt="image-20211125210826057"></td></tr></tbody></table></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="å…­cicdå…¥é—¨æ“ä½œ"></a>å…­ã€CIã€CDå…¥é—¨æ“ä½œ<a class="hash-link" href="#å…­cicdå…¥é—¨æ“ä½œ" title="Direct link to heading">#</a></h3><p>åŸºäºJenkinsæ‹‰å–GitLabçš„SpringBootä»£ç è¿›è¡Œæ„å»ºå‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒå®ç°æŒç»­é›†æˆ</p><p>åŸºäºJenkinsæ‹‰å–GitLabæŒ‡å®šå‘è¡Œç‰ˆæœ¬çš„SpringBootä»£ç è¿›è¡Œæ„å»ºå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒå®ç°CDå®ç°æŒç»­éƒ¨ç½²</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="61-æŒç»­é›†æˆ"></a>6.1 æŒç»­é›†æˆ<a class="hash-link" href="#61-æŒç»­é›†æˆ" title="Direct link to heading">#</a></h4><p>ä¸ºäº†è®©ç¨‹åºä»£ç å¯ä»¥è‡ªåŠ¨æ¨é€åˆ°æµ‹è¯•ç¯å¢ƒåŸºäºDockeræœåŠ¡è¿è¡Œï¼Œéœ€è¦æ·»åŠ Dockeré…ç½®å’Œè„šæœ¬æ–‡ä»¶è®©ç¨‹åºå¯ä»¥åœ¨é›†æˆåˆ°ä¸»å¹²çš„åŒæ—¶è¿è¡Œèµ·æ¥ã€‚</p><ul><li><p>æ·»åŠ Dockerfileæ–‡ä»¶</p><table><thead><tr><th align="center">æ„å»ºè‡ªå®šä¹‰é•œåƒ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126161304485.png" alt="image-20211126161304485"></td></tr></tbody></table></li><li><p>æ·»åŠ docker-compose.ymlæ–‡ä»¶</p><table><thead><tr><th align="center">åŠ è½½è‡ªå®šä¹‰é•œåƒå¯åŠ¨å®¹å™¨</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126161331991.png" alt="image-20211126161331991"></td></tr></tbody></table></li><li><p>è¿½åŠ Jenkinsæ„å»ºåæ“ä½œè„šæœ¬å‘½ä»¤</p><table><thead><tr><th align="center">æ„å»ºåå‘å¸ƒå¹¶æ‰§è¡Œè„šæœ¬å‘½ä»¤</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126161408514.png" alt="image-20211126161408514"></td></tr></tbody></table></li><li><p>å‘å¸ƒåˆ°GitLabåç”±Jenkinsç«‹å³æ„å»ºå¹¶æ‰˜é€åˆ°ç›®æ ‡æœåŠ¡å™¨</p><table><thead><tr><th align="center">æ„å»ºæ—¥å¿—</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126161448527.png" alt="image-20211126161448527"></td></tr></tbody></table></li><li><p>æµ‹è¯•éƒ¨ç½²åˆ°ç›®æ ‡æœåŠ¡å™¨ç¨‹åº</p><table><thead><tr><th align="center">æŸ¥çœ‹ç›®æ ‡æœåŠ¡å™¨å¹¶æµ‹è¯•æ¥å£</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126161504715.png" alt="image-20211126161504715"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126161509411.png" alt="image-20211126161509411"></td></tr></tbody></table></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="62-æŒç»­äº¤ä»˜éƒ¨ç½²"></a>6.2 æŒç»­äº¤ä»˜ã€éƒ¨ç½²<a class="hash-link" href="#62-æŒç»­äº¤ä»˜éƒ¨ç½²" title="Direct link to heading">#</a></h4><p>ç¨‹åºä»£ç åœ¨ç»è¿‡å¤šæ¬¡é›†æˆæ“ä½œåˆ°è¾¾æœ€ç»ˆå¯ä»¥äº¤ä»˜ï¼ŒæŒç»­äº¤ä»˜æ•´ä½“æµç¨‹å’ŒæŒç»­é›†æˆç±»ä¼¼ï¼Œä¸è¿‡éœ€è¦é€‰å–æŒ‡å®šçš„å‘è¡Œç‰ˆæœ¬</p><ul><li><p>ä¸‹è½½Git Parameteræ’ä»¶</p><table><thead><tr><th align="center">ä¸‹è½½Git Parameter</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126165209057.png" alt="image-20211126165209057"></td></tr></tbody></table></li><li><p>è®¾ç½®é¡¹ç›®å‚æ•°åŒ–æ„å»º</p><table><thead><tr><th align="center">åŸºäºGitæ ‡ç­¾æ„å»º</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126165444124.png" alt="image-20211126165444124"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126172828266.png" alt="image-20211126172828266"></td></tr></tbody></table></li><li><p>ç»™é¡¹ç›®æ·»åŠ tagç‰ˆæœ¬</p><table><thead><tr><th align="center">æ·»åŠ tagç‰ˆæœ¬</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126165639286.png" alt="image-20211126165639286"></td></tr></tbody></table></li><li><p>ä»»åŠ¡æ„å»ºæ—¶ï¼Œé‡‡ç”¨Shellæ–¹å¼æ„å»ºï¼Œæ‹‰å–æŒ‡å®štagç‰ˆæœ¬ä»£ç </p><table><thead><tr><th align="center">åˆ‡æ¢æŒ‡å®šæ ‡ç­¾å¹¶æ„å»ºé¡¹ç›®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126174715028.png" alt="image-20211126174715028"></td></tr></tbody></table></li><li><p>åŸºäºParameteræ„å»ºä»»åŠ¡ï¼Œä»»åŠ¡å‘å¸ƒåˆ°ç›®æ ‡æœåŠ¡å™¨</p><table><thead><tr><th align="center">æ„å»ºä»»åŠ¡</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211126174159487.png" alt="image-20211126174159487"></td></tr></tbody></table></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="ä¸ƒé›†æˆsonar-qube"></a>ä¸ƒã€é›†æˆSonar Qube<a class="hash-link" href="#ä¸ƒé›†æˆsonar-qube" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="71-sonar-qubeä»‹ç»"></a>7.1 Sonar Qubeä»‹ç»<a class="hash-link" href="#71-sonar-qubeä»‹ç»" title="Direct link to heading">#</a></h4><p>Sonar Qubeæ˜¯ä¸€ä¸ªå¼€æºçš„ä»£ç åˆ†æå¹³å°ï¼Œæ”¯æŒJavaã€Pythonã€PHPã€JavaScriptã€CSSç­‰25ç§ä»¥ä¸Šçš„è¯­è¨€ï¼Œå¯ä»¥æ£€æµ‹å‡ºé‡å¤ä»£ç ã€ä»£ç æ¼æ´ã€ä»£ç è§„èŒƒå’Œå®‰å…¨æ€§æ¼æ´çš„é—®é¢˜ã€‚</p><p>Sonar Qubeå¯ä»¥ä¸å¤šç§è½¯ä»¶æ•´åˆè¿›è¡Œä»£ç æ‰«æï¼Œæ¯”å¦‚Mavenï¼ŒGradleï¼ŒGitï¼ŒJenkinsç­‰ï¼Œå¹¶ä¸”ä¼šå°†ä»£ç æ£€æµ‹ç»“æœæ¨é€å›Sonar Qubeå¹¶ä¸”åœ¨ç³»ç»Ÿæä¾›çš„UIç•Œé¢ä¸Šæ˜¾ç¤ºå‡ºæ¥</p><table><thead><tr><th align="center">Sonar Qubeçš„UIç•Œé¢</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129190039986.png" alt="image-20211129190039986"></td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="72-sonar-qubeç¯å¢ƒæ­å»º"></a>7.2 Sonar Qubeç¯å¢ƒæ­å»º<a class="hash-link" href="#72-sonar-qubeç¯å¢ƒæ­å»º" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="721-sonar-qubeå®‰è£…"></a>7.2.1 Sonar Qubeå®‰è£…<a class="hash-link" href="#721-sonar-qubeå®‰è£…" title="Direct link to heading">#</a></h5><p>Sonar Qubeåœ¨7.9ç‰ˆæœ¬ä¸­å·²ç»æ”¾å¼ƒäº†å¯¹MySQLçš„æ”¯æŒï¼Œå¹¶ä¸”å»ºè®®åœ¨å•†ä¸šç¯å¢ƒä¸­é‡‡ç”¨PostgreSQLï¼Œé‚£ä¹ˆå®‰è£…Sonar Qubeæ—¶éœ€è¦ä¾èµ–PostgreSQLã€‚</p><p>å¹¶ä¸”è¿™é‡Œä¼šå®‰è£…Sonar Qubeçš„é•¿æœŸæ”¯æŒç‰ˆæœ¬<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">8.9</a></p><ul><li><p>æ‹‰å–é•œåƒ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull postgres</span></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull sonarqube:8.9.3-community</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ç¼–å†™docker-compoe.yml</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3.1&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> db</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 5432</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">5432</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sonarnet</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sonarqube</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonarqube</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8.9.3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">community</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonarqube</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> db</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;9000:9000&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sonarnet</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SONAR_JDBC_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/sonar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SONAR_JDBC_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SONAR_JDBC_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sonarnet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bridge</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å¯åŠ¨å®¹å™¨</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose up -d</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>éœ€è¦è®¾ç½®sysctl.confæ–‡ä»¶ä¿¡æ¯</p><table><thead><tr><th align="center">è®¾ç½®vm.max_map_count</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211207145215817.png" alt="image-20211207145215817"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211207145342350.png" alt="image-20211207145342350"></td></tr></tbody></table><p>å¹¶æ‰§è¡Œå‘½ä»¤åˆ·æ–°</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">sysctl -p</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>é‡æ–°å¯åŠ¨éœ€è¦ä¸€å®šæ—¶é—´å¯åŠ¨ï¼Œå¯ä»¥å¯ä»¥æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼Œçœ‹åˆ°å¦‚ä¸‹å†…å®¹ä»£è¡¨å¯åŠ¨æˆåŠŸ</p><table><thead><tr><th align="center">å®¹å™¨æ—¥å¿—</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129191426344.png" alt="image-20211129191426344"></td></tr></tbody></table></li><li><p>è®¿é—®Sonar Qubeé¦–é¡µ</p><table><thead><tr><th align="center">ç™»å½•</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129191537050.png" alt="image-20211129191537050"></td></tr></tbody></table></li><li><p>è¿˜éœ€è¦é‡æ–°è®¾ç½®ä¸€æ¬¡å¯†ç </p><table><thead><tr><th align="center">é‡æ–°è®¾ç½®å¯†ç </th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129193824428.png" alt="image-20211129193824428"></td></tr></tbody></table></li><li><p>Sonar Qubeé¦–é¡µ</p><table><thead><tr><th align="center">Sonar Qubeé¦–é¡µ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129194148239.png" alt="image-20211129194148239"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="722-å®‰è£…ä¸­æ–‡æ’ä»¶"></a>7.2.2 å®‰è£…ä¸­æ–‡æ’ä»¶<a class="hash-link" href="#722-å®‰è£…ä¸­æ–‡æ’ä»¶" title="Direct link to heading">#</a></h5><table><thead><tr><th align="center">å®‰è£…ä¸­æ–‡æ’ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129194621820.png" alt="image-20211129194621820"></td></tr></tbody></table><p>å®‰è£…æˆåŠŸåéœ€è¦é‡å¯ï¼Œå®‰è£…å¤±è´¥é‡æ–°ç‚¹å‡»installé‡è£…å³å¯ã€‚</p><p>å®‰è£…æˆåŠŸåï¼Œä¼šæŸ¥çœ‹åˆ°é‡å¯æŒ‰é’®ï¼Œç‚¹å‡»å³å¯</p><table><thead><tr><th align="center">é‡å¯æŒ‰é’®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129194748765.png" alt="image-20211129194748765"></td></tr></tbody></table><p>é‡å¯åæŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th align="center">é¦–é¡µæ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129194931944.png" alt="image-20211129194931944"></td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="73-sonar-qubeåŸºæœ¬ä½¿ç”¨"></a>7.3 Sonar QubeåŸºæœ¬ä½¿ç”¨<a class="hash-link" href="#73-sonar-qubeåŸºæœ¬ä½¿ç”¨" title="Direct link to heading">#</a></h4><p>Sonar Qubeçš„ä½¿ç”¨æ–¹å¼å¾ˆå¤šï¼ŒMavenå¯ä»¥æ•´åˆï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨sonar-scannerçš„æ–¹å¼ï¼Œå†æŸ¥çœ‹Sonar Qubeçš„æ£€æµ‹æ•ˆæœ</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="731-mavenå®ç°ä»£ç æ£€æµ‹"></a>7.3.1 Mavenå®ç°ä»£ç æ£€æµ‹<a class="hash-link" href="#731-mavenå®ç°ä»£ç æ£€æµ‹" title="Direct link to heading">#</a></h5><ul><li><p>ä¿®æ”¹Mavençš„settings.xmlæ–‡ä»¶é…ç½®Sonar Qubeä¿¡æ¯</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI xml"><pre tabindex="0" class="prism-code language-xml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">profile</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">sonar</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">activation</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">activeByDefault</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">activeByDefault</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">activation</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">sonar.login</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">admin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">sonar.login</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">sonar.password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">123456789</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">sonar.password</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">sonar.host.url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">http://192.168.11.11:9000</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">sonar.host.url</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">properties</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">profile</span><span class="token tag punctuation" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>åœ¨ä»£ç ä½ç½®æ‰§è¡Œå‘½ä»¤ï¼šmvn sonar:sonar</p><table><thead><tr><th align="center">æ‰§è¡Œä»£ç æ£€æµ‹</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129195430146.png" alt="image-20211129195430146"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹Sonar Qubeç•Œé¢æ£€æµ‹ç»“æœ</p><table><thead><tr><th align="center">Sonar Qubeæ£€æµ‹ç»“æœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129195503762.png" alt="image-20211129195503762"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="732-sonar-scannerå®ç°ä»£ç æ£€æµ‹"></a>7.3.2 Sonar-scannerå®ç°ä»£ç æ£€æµ‹<a class="hash-link" href="#732-sonar-scannerå®ç°ä»£ç æ£€æµ‹" title="Direct link to heading">#</a></h5><ul><li><p>ä¸‹è½½Sonar-scannerï¼š<a href="https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/" target="_blank" rel="noopener noreferrer">https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/</a></p><p>ä¸‹è½½4.6.xç‰ˆæœ¬å³å¯ï¼Œè¦æ±‚Linuxç‰ˆæœ¬</p></li><li><p>è§£å‹å¹¶é…ç½®sonaræœåŠ¡ç«¯ä¿¡æ¯</p><ul><li><p>ç”±äºæ˜¯zipå‹ç¼©åŒ…ï¼Œéœ€è¦å®‰è£…unzipè§£å‹æ’ä»¶</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install unzip</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>è§£å‹å‹ç¼©åŒ…</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">unzip sonar-scanner-cli/sonar-scanner-cli-4.6.0.2311-linux.zip</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>é…ç½®sonarQubeæœåŠ¡ç«¯åœ°å€ï¼Œä¿®æ”¹confä¸‹çš„sonar-scanner.properties</p><table><thead><tr><th align="center">é…ç½®æœåŠ¡ç«¯ä¿¡æ¯</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130140043382.png" alt="image-20211130140043382"></td></tr></tbody></table></li></ul></li><li><p>æ‰§è¡Œå‘½ä»¤æ£€æµ‹ä»£ç </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># åœ¨é¡¹ç›®æ‰€åœ¨ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span></span><span class="token-line" style="color:#393A34"><span class="token plain">~/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=demo -Dsonar.projectKey=java -Dsonar.java.binaries=target/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">Psï¼šä¸»è¦æŸ¥çœ‹æˆ‘çš„sonar-scanneræ‰§è¡Œå‘½ä»¤çš„ä½ç½®</a></p><table><thead><tr><th align="center">æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130141303457.png" alt="image-20211130141303457"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹SonarQubeç•Œé¢æ£€æµ‹ç»“æœ</p><table><thead><tr><th align="center">æ£€æµ‹ç»“æœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130144608025.png" alt="image-20211130144608025"></td></tr></tbody></table></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="74-jenkinsé›†æˆsonar-qube"></a>7.4 Jenkinsé›†æˆSonar Qube<a class="hash-link" href="#74-jenkinsé›†æˆsonar-qube" title="Direct link to heading">#</a></h4><p>Jenkinsç»§æ‰¿Sonar Qubeå®ç°ä»£ç æ‰«æéœ€è¦å…ˆä¸‹è½½æ•´åˆæ’ä»¶</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="741-jenkinså®‰è£…æ’ä»¶"></a>7.4.1 Jenkinså®‰è£…æ’ä»¶<a class="hash-link" href="#741-jenkinså®‰è£…æ’ä»¶" title="Direct link to heading">#</a></h5><table><thead><tr><th align="center">ä¸‹è½½Sonar Qubeæ’ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129201625561.png" alt="image-20211129201625561"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129201607240.png" alt="image-20211129201607240"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129202147390.png" alt="image-20211129202147390"></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="742-jenkinsé…ç½®sonar-qube"></a>7.4.2 Jenkinsé…ç½®Sonar Qube<a class="hash-link" href="#742-jenkinsé…ç½®sonar-qube" title="Direct link to heading">#</a></h5><ul><li><p>å¼€å¯Sonar Qubeæƒé™éªŒè¯</p><table><thead><tr><th align="center">å¼€å¯Sonar Qubeæƒé™æ ¡éªŒ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130144850186.png" alt="image-20211130144850186"></td></tr></tbody></table></li><li><p>è·å–Sonar Qubeçš„ä»¤ç‰Œ</p><table><thead><tr><th align="center">è·å–ä»¤ç‰Œ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129203102334.png" alt="image-20211129203102334"></td></tr></tbody></table></li><li><p>é…ç½®Jenkinsçš„Sonar Qubeä¿¡æ¯</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129203235019.png" alt="image-20211129203235019"></td></tr><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129203342171.png" alt="image-20211129203342171"></td></tr><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211129203457604.png" alt="image-20211129203457604"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="743-é…ç½®sonar-scanner"></a>7.4.3 é…ç½®Sonar-scanner<a class="hash-link" href="#743-é…ç½®sonar-scanner" title="Direct link to heading">#</a></h5><ul><li><p>å°†Sonar-scaneræ·»åŠ åˆ°Jenkinsæ•°æ®å·ä¸­å¹¶é…ç½®å…¨å±€é…ç½®</p><table><thead><tr><th align="center">é…ç½®Sonar-scanner</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130153628925.png" alt="image-20211130153628925"></td></tr></tbody></table></li><li><p>é…ç½®ä»»åŠ¡çš„Sonar-scanner</p><table><thead><tr><th align="center">é…ç½®ä»»åŠ¡çš„Sonar-scanner</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130155849143.png" alt="image-20211130155849143"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="744-æ„å»ºä»»åŠ¡"></a>7.4.4 æ„å»ºä»»åŠ¡<a class="hash-link" href="#744-æ„å»ºä»»åŠ¡" title="Direct link to heading">#</a></h5><table><thead><tr><th align="center">æ„å»ºä»»åŠ¡</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130160017465.png" alt="image-20211130160017465"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130160047648.png" alt="image-20211130160047648"></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="å…«é›†æˆharbor"></a>å…«ã€é›†æˆHarbor<a class="hash-link" href="#å…«é›†æˆharbor" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="81-harborä»‹ç»"></a>8.1 Harborä»‹ç»<a class="hash-link" href="#81-harborä»‹ç»" title="Direct link to heading">#</a></h4><p>å‰é¢åœ¨éƒ¨ç½²é¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦é‡‡ç”¨Jenkinsæ¨é€jaråŒ…åˆ°æŒ‡å®šæœåŠ¡å™¨ï¼Œå†é€šè¿‡è„šæœ¬å‘½ä»¤è®©ç›®æ ‡æœåŠ¡å™¨å¯¹å½“å‰jarè¿›è¡Œéƒ¨ç½²ï¼Œè¿™ç§æ–¹å¼åœ¨é¡¹ç›®è¾ƒå¤šæ—¶ï¼Œæ¯ä¸ªç›®æ ‡æœåŠ¡å™¨éƒ½éœ€è¦å°†jaråŒ…åˆ¶ä½œæˆè‡ªå®šä¹‰é•œåƒå†é€šè¿‡dockerè¿›è¡Œå¯åŠ¨ï¼Œé‡å¤æ“ä½œæ¯”è¾ƒå¤šï¼Œä¼šé™ä½é¡¹ç›®éƒ¨ç½²æ—¶é—´ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Harborä½œä¸ºç§æœ‰çš„Dockeré•œåƒä»“åº“ã€‚è®©Jenkinsç»Ÿä¸€å°†é¡¹ç›®æ‰“åŒ…å¹¶åˆ¶ä½œæˆDockeré•œåƒå‘å¸ƒåˆ°Harborä»“åº“ä¸­ï¼Œåªéœ€è¦é€šçŸ¥ç›®æ ‡æœåŠ¡ï¼Œè®©ç›®æ ‡æœåŠ¡ç»Ÿä¸€å»Harborä»“åº“ä¸Šæ‹‰å–é•œåƒå¹¶åœ¨æœ¬åœ°éƒ¨ç½²å³å¯ã€‚</p><p>Dockerå®˜æ–¹æä¾›äº†Registryé•œåƒä»“åº“ï¼Œä½†æ˜¯Registryçš„åŠŸèƒ½ç›¸å¯¹ç®€é™‹ã€‚Harboræ˜¯VMwareå…¬å¸æä¾›çš„ä¸€æ¬¾é•œåƒä»“åº“ï¼Œæä¾›äº†æƒé™æ§åˆ¶ã€åˆ†å¸ƒå¼å‘å¸ƒã€å¼ºå¤§çš„å®‰å…¨æ‰«æä¸å®¡æŸ¥æœºåˆ¶ç­‰åŠŸèƒ½</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="82-harborå®‰è£…"></a>8.2 Harborå®‰è£…<a class="hash-link" href="#82-harborå®‰è£…" title="Direct link to heading">#</a></h4><p>è¿™é‡Œé‡‡ç”¨åŸç”Ÿçš„æ–¹å¼å®‰è£…Harborã€‚</p><ul><li><p>ä¸‹è½½Harborå®‰è£…åŒ…ï¼š<a href="https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz" target="_blank" rel="noopener noreferrer">https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz</a></p></li><li><p>æ‹–æ‹½åˆ°Linuxå¹¶è§£å‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf harbor-offline-installer-v2.3.4.tgz -C /usr/local/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ä¿®æ”¹Harboré…ç½®æ–‡ä»¶ï¼š</p><ul><li><p>é¦–å…ˆå¤åˆ¶ä¸€ä»½harbor.ymlé…ç½®</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">cp harbor.yml.tmpl harbor.yml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ç¼–è¾‘harbor.ymlé…ç½®æ–‡ä»¶</p><table><thead><tr><th align="center">é…ç½®Harboræ–‡ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130215555218.png" alt="image-20211130215555218"></td></tr></tbody></table></li></ul></li><li><p>å¯åŠ¨Harbor</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">./install.sh</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">æŸ¥çœ‹æ—¥å¿—</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130215941857.png" alt="image-20211130215941857"></td></tr></tbody></table></li><li><p>ç™»å½•Harbor</p><table><thead><tr><th align="center">ç™»å½•Harbor</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130220028840.png" alt="image-20211130220028840"></td></tr></tbody></table></li><li><p>é¦–é¡µä¿¡æ¯</p><table><thead><tr><th align="center">é¦–é¡µä¿¡æ¯</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211130220111602.png" alt="image-20211130220111602"></td></tr></tbody></table></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="83-harborä½¿ç”¨æ–¹å¼"></a>8.3 Harborä½¿ç”¨æ–¹å¼<a class="hash-link" href="#83-harborä½¿ç”¨æ–¹å¼" title="Direct link to heading">#</a></h4><p>Harborä½œä¸ºé•œåƒä»“åº“ï¼Œä¸»è¦çš„äº¤äº’æ–¹å¼å°±æ˜¯å°†é•œåƒä¸Šä¼ åˆ°Harborä¸Šï¼Œä»¥åŠä»Harborä¸Šä¸‹è½½æŒ‡å®šé•œåƒ</p><p>åœ¨ä¼ è¾“é•œåƒå‰ï¼Œå¯ä»¥å…ˆä½¿ç”¨Harboræä¾›çš„æƒé™ç®¡ç†ï¼Œå°†é¡¹ç›®è®¾ç½®ä¸ºç§æœ‰é¡¹ç›®ï¼Œå¹¶å¯¹ä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒè§’è‰²ï¼Œä»è€Œæ›´æ–¹ä¾¿ç®¡ç†é•œåƒã€‚</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="831-æ·»åŠ ç”¨æˆ·æ„å»ºé¡¹ç›®"></a>8.3.1 æ·»åŠ ç”¨æˆ·æ„å»ºé¡¹ç›®<a class="hash-link" href="#831-æ·»åŠ ç”¨æˆ·æ„å»ºé¡¹ç›®" title="Direct link to heading">#</a></h5><ul><li><p>åˆ›å»ºç”¨æˆ·</p><table><thead><tr><th align="center">åˆ›å»ºç”¨æˆ·</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201213427157.png" alt="image-20211201213427157"></td></tr></tbody></table></li><li><p>æ„å»ºé¡¹ç›®ï¼ˆè®¾ç½®ä¸ºç§æœ‰ï¼‰</p><table><thead><tr><th align="center">æ„å»ºé¡¹ç›®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201213751780.png" alt="image-20211201213751780"></td></tr></tbody></table></li><li><p>ç»™é¡¹ç›®è¿½åŠ ç”¨æˆ·</p><table><thead><tr><th align="center">è¿½åŠ ç”¨æˆ·ç®¡ç†</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201213832458.png" alt="image-20211201213832458"></td></tr></tbody></table></li><li><p>åˆ‡æ¢æµ‹è¯•ç”¨æˆ·</p><table><thead><tr><th align="center">åˆ‡æ¢æµ‹è¯•ç”¨æˆ·</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201214008303.png" alt="image-20211201214008303"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="832-å‘å¸ƒé•œåƒåˆ°harbor"></a>8.3.2 å‘å¸ƒé•œåƒåˆ°Harbor<a class="hash-link" href="#832-å‘å¸ƒé•œåƒåˆ°harbor" title="Direct link to heading">#</a></h5><ul><li><p>ä¿®æ”¹é•œåƒåç§°</p><p>åç§°è¦æ±‚ï¼š<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">harboråœ°å€/é¡¹ç›®å/é•œåƒå:ç‰ˆæœ¬</a></p><table><thead><tr><th>ä¿®æ”¹é•œåƒåç§°</th></tr></thead><tbody><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201221040200.png" alt="image-20211201221040200"></td></tr></tbody></table></li><li><p>ä¿®æ”¹daemon.jsonï¼Œæ”¯æŒDockerä»“åº“ï¼Œå¹¶é‡å¯Docker</p><table><thead><tr><th align="center">ä¿®æ”¹daemon.jsonï¼Œæ”¯æŒDockerä»“åº“</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201215931237.png" alt="image-20211201215931237"></td></tr></tbody></table></li><li><p>è®¾ç½®ç™»å½•ä»“åº“ä¿¡æ¯</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker login -u ç”¨æˆ·å -p å¯†ç  Harboråœ°å€</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ¨é€é•œåƒåˆ°Harbor</p><table><thead><tr><th align="center">æ¨é€é•œåƒåˆ°Harbor</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201221225196.png" alt="image-20211201221225196"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201221300055.png" alt="image-20211201221300055"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="833-ä»harboræ‹‰å–é•œåƒls"></a>8.3.3 ä»Harboræ‹‰å–é•œåƒls<a class="hash-link" href="#833-ä»harboræ‹‰å–é•œåƒls" title="Direct link to heading">#</a></h5><p>è·Ÿä¼ ç»Ÿæ–¹å¼ä¸€æ ·ï¼Œä¸è¿‡éœ€è¦å…ˆé…ç½®<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">/etc/docker/daemon.json</a>æ–‡ä»¶</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;registry-mirrors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;https://pee6w651.mirror.aliyuncs.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;insecure-registries&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;192.168.11.11:80&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">æ‹‰å–é•œåƒ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211201222450091.png" alt="image-20211201222450091"></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="834-jenkinså®¹å™¨ä½¿ç”¨å®¿ä¸»æœºdocker"></a>8.3.4 Jenkinså®¹å™¨ä½¿ç”¨å®¿ä¸»æœºDocker<a class="hash-link" href="#834-jenkinså®¹å™¨ä½¿ç”¨å®¿ä¸»æœºdocker" title="Direct link to heading">#</a></h5><p>æ„å»ºé•œåƒå’Œå‘å¸ƒé•œåƒåˆ°harboréƒ½éœ€è¦ä½¿ç”¨åˆ°dockerå‘½ä»¤ã€‚è€Œåœ¨Jenkinså®¹å™¨å†…éƒ¨å®‰è£…Dockerå®˜æ–¹æ¨èç›´æ¥é‡‡ç”¨å®¿ä¸»æœºå¸¦çš„Dockerå³å¯ã€‚</p><p>è®¾ç½®Jenkinså®¹å™¨ä½¿ç”¨å®¿ä¸»æœºDocker</p><ul><li><p>è®¾ç½®å®¿ä¸»æœºdocker.sockæƒé™ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown root:root /var/run/docker.sock</span></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chmod o+rw /var/run/docker.sock</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ·»åŠ æ•°æ®å·</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3.1&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jenkins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins/jenkins</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jenkins</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 8080</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 50000</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./data/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/jenkins_home/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /usr/bin/docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/bin/docker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/run/docker.sock</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /etc/docker/daemon.json</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/docker/daemon.json</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="835-æ·»åŠ æ„å»ºæ“ä½œ"></a>8.3.5 æ·»åŠ æ„å»ºæ“ä½œ<a class="hash-link" href="#835-æ·»åŠ æ„å»ºæ“ä½œ" title="Direct link to heading">#</a></h5><table><thead><tr><th align="center">åˆ¶ä½œè‡ªå®šä¹‰é•œåƒ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211229155834500.png" alt="image-20211229155834500"></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="836-ç¼–å†™éƒ¨ç½²è„šæœ¬"></a>8.3.6 ç¼–å†™éƒ¨ç½²è„šæœ¬<a class="hash-link" href="#836-ç¼–å†™éƒ¨ç½²è„šæœ¬" title="Direct link to heading">#</a></h5><p>éƒ¨ç½²é¡¹ç›®éœ€è¦é€šè¿‡Publish Over SSHæ’ä»¶ï¼Œè®©ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ã€‚ä¸ºäº†æ–¹ä¾¿ä¸€æ¬¡æ€§å®ç°æ‹‰å–é•œåƒå’Œå¯åŠ¨çš„å‘½ä»¤ï¼Œæ¨èé‡‡ç”¨è„šæœ¬æ–‡ä»¶çš„æ–¹å¼ã€‚</p><p>æ·»åŠ è„šæœ¬æ–‡ä»¶åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå†é€šè¿‡Publish Over SSHæ’ä»¶è®©ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œè„šæœ¬å³å¯ã€‚</p><ul><li><p>ç¼–å†™è„šæœ¬æ–‡ä»¶ï¼Œæ·»åŠ åˆ°ç›®æ ‡æœåŠ¡å™¨</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">harbor_url=$1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">harbor_project_name=$2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">project_name=$3</span></span><span class="token-line" style="color:#393A34"><span class="token plain">tag=$4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">port=$5</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">imageName=$harbor_url/$harbor_project_name/$project_name:$tag</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">containerId=`docker ps -a | grep ${project_name} | awk &#x27;{print $1}&#x27;`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ &quot;$containerId&quot; != &quot;&quot; ] ; then</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    docker stop $containerId</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    docker rm $containerId</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Delete Container Success&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">imageId=`docker images | grep ${project_name} | awk &#x27;{print $3}&#x27;`</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ &quot;$imageId&quot; != &quot;&quot; ] ; then</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    docker rmi -f $imageId</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Delete Image Success&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">docker login -u DevOps -p P@ssw0rd $harbor_url</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull $imageName</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d -p $port:$port --name $project_name $imageName</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Start Container Success&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $project_name</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¹¶è®¾ç½®æƒé™ä¸ºå¯æ‰§è¡Œ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">chmod a+x deploy.sh</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">å¦‚å›¾</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211203192047357.png" alt="image-20211203192047357"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="837-é…ç½®æ„å»ºåæ“ä½œ"></a>8.3.7 é…ç½®æ„å»ºåæ“ä½œ<a class="hash-link" href="#837-é…ç½®æ„å»ºåæ“ä½œ" title="Direct link to heading">#</a></h5><table><thead><tr><th align="center">æ‰§è¡Œè„šæœ¬æ–‡ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211229155949038.png" alt="image-20211229155949038"></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="ä¹jenkinsæµæ°´çº¿"></a>ä¹ã€Jenkinsæµæ°´çº¿<a class="hash-link" href="#ä¹jenkinsæµæ°´çº¿" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="91-jenkinsæµæ°´çº¿ä»»åŠ¡ä»‹ç»"></a>9.1 Jenkinsæµæ°´çº¿ä»»åŠ¡ä»‹ç»<a class="hash-link" href="#91-jenkinsæµæ°´çº¿ä»»åŠ¡ä»‹ç»" title="Direct link to heading">#</a></h4><p>ä¹‹å‰é‡‡ç”¨Jenkinsçš„è‡ªç”±é£æ ¼æ„å»ºçš„é¡¹ç›®ï¼Œæ¯ä¸ªæ­¥éª¤æµç¨‹éƒ½è¦é€šè¿‡ä¸åŒçš„æ–¹å¼è®¾ç½®ï¼Œå¹¶ä¸”æ„å»ºè¿‡ç¨‹ä¸­æ•´ä½“æµç¨‹æ˜¯ä¸å¯è§çš„ï¼Œæ— æ³•ç¡®è®¤æ¯ä¸ªæµç¨‹èŠ±è´¹çš„æ—¶é—´ï¼Œå¹¶ä¸”é—®é¢˜ä¸æ–¹ä¾¿å®šä½é—®é¢˜ã€‚</p><p>Jenkinsçš„Pipelineå¯ä»¥è®©é¡¹ç›®çš„å‘å¸ƒæ•´ä½“æµç¨‹å¯è§†åŒ–ï¼Œæ˜ç¡®æ‰§è¡Œçš„é˜¶æ®µï¼Œå¯ä»¥å¿«é€Ÿçš„å®šä½é—®é¢˜ã€‚å¹¶ä¸”æ•´ä¸ªé¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥é€šè¿‡ä¸€ä¸ªJenkinsfileæ–‡ä»¶ç®¡ç†ï¼Œè€Œä¸”Jenkinsfileæ–‡ä»¶æ˜¯å¯ä»¥æ”¾åœ¨é¡¹ç›®ä¸­ç»´æŠ¤ã€‚</p><p>æ‰€ä»¥Pipelineç›¸å¯¹è‡ªç”±é£æ ¼æˆ–è€…å…¶ä»–çš„é¡¹ç›®é£æ ¼æ›´å®¹æ˜“æ“ä½œã€‚</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="92-jenkinsæµæ°´çº¿ä»»åŠ¡"></a>9.2 Jenkinsæµæ°´çº¿ä»»åŠ¡<a class="hash-link" href="#92-jenkinsæµæ°´çº¿ä»»åŠ¡" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="921-æ„å»ºjenkinsæµæ°´çº¿ä»»åŠ¡"></a>9.2.1 æ„å»ºJenkinsæµæ°´çº¿ä»»åŠ¡<a class="hash-link" href="#921-æ„å»ºjenkinsæµæ°´çº¿ä»»åŠ¡" title="Direct link to heading">#</a></h5><ul><li><p>æ„å»ºä»»åŠ¡</p><table><thead><tr><th>æ„å»ºJenkinsæµæ°´çº¿ä»»åŠ¡</th></tr></thead><tbody><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202144429302.png" alt="image-20211202144429302"></td></tr></tbody></table></li><li><p>ç”ŸæˆGroovyè„šæœ¬</p><table><thead><tr><th align="center">Hello Worldè„šæœ¬ç”Ÿæˆ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202144531749.png" alt="image-20211202144531749"></td></tr></tbody></table></li><li><p>æ„å»ºåæŸ¥çœ‹è§†å›¾</p><table><thead><tr><th align="center">æ„å»ºåæŸ¥çœ‹è§†å›¾</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202144616117.png" alt="image-20211202144616117"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="922-groovyè„šæœ¬"></a>9.2.2 Groovyè„šæœ¬<a class="hash-link" href="#922-groovyè„šæœ¬" title="Direct link to heading">#</a></h5><ul><li><p>Groovyè„šæœ¬åŸºç¡€è¯­æ³•</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">// æ‰€æœ‰è„šæœ¬å‘½ä»¤åŒ…å«åœ¨pipeline{}ä¸­</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // æŒ‡å®šä»»åŠ¡åœ¨å“ªä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼ˆJenkinsæ”¯æŒåˆ†å¸ƒå¼ï¼‰</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // é…ç½®å…¨å±€ç¯å¢ƒï¼ŒæŒ‡å®šå˜é‡å=å˜é‡å€¼ä¿¡æ¯</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        host = &#x27;192.168.11.11&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // å­˜æ”¾æ‰€æœ‰ä»»åŠ¡çš„åˆé›†</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // å•ä¸ªä»»åŠ¡</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;ä»»åŠ¡1&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // å®ç°ä»»åŠ¡çš„å…·ä½“æµç¨‹</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                echo &#x27;do something&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // å•ä¸ªä»»åŠ¡</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;ä»»åŠ¡2&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // å®ç°ä»»åŠ¡çš„å…·ä½“æµç¨‹</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                echo &#x27;do something&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // â€¦â€¦</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ç¼–å†™ä¾‹å­æµ‹è¯•</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // å­˜æ”¾æ‰€æœ‰ä»»åŠ¡çš„åˆé›†</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ‹‰å–Gitä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                echo &#x27;æ‹‰å–Gitä»£ç &#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ£€æµ‹ä»£ç è´¨é‡&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                echo &#x27;æ£€æµ‹ä»£ç è´¨é‡&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ„å»ºä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                echo &#x27;æ„å»ºä»£ç &#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒHarbor&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                echo &#x27;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒHarbor&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;åŸºäºHarboréƒ¨ç½²å·¥ç¨‹&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                echo &#x27;åŸºäºHarboréƒ¨ç½²å·¥ç¨‹&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">é…ç½®Grovvyè„šæœ¬</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202145155428.png" alt="image-20211202145155428"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th align="center">æŸ¥çœ‹æ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202145240166.png" alt="image-20211202145240166"></td></tr></tbody></table></li></ul><p><a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">Psï¼šæ¶‰åŠåˆ°ç‰¹å®šè„šæœ¬ï¼ŒJenkinsç»™äºˆäº†å……è¶³çš„æç¤ºï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå‘½ä»¤</a></p><table><thead><tr><th align="center">ç”Ÿæˆå‘½ä»¤ä½ç½®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202145349043.png" alt="image-20211202145349043"></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="923-jenkinsfileå®ç°"></a>9.2.3 Jenkinsfileå®ç°<a class="hash-link" href="#923-jenkinsfileå®ç°" title="Direct link to heading">#</a></h5><p>Jenkinsfileæ–¹å¼éœ€è¦å°†è„šæœ¬å†…å®¹ç¼–å†™åˆ°é¡¹ç›®ä¸­çš„Jenkinsfileæ–‡ä»¶ä¸­ï¼Œæ¯æ¬¡æ„å»ºä¼šè‡ªåŠ¨æ‹‰å–é¡¹ç›®å¹¶ä¸”è·å–é¡¹ç›®ä¸­Jenkinsfileæ–‡ä»¶å¯¹é¡¹ç›®è¿›è¡Œæ„å»º</p><ul><li><p>é…ç½®pipeline</p><table><thead><tr><th align="center">é…ç½®pipeline</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202151127254.png" alt="image-20211202151127254"></td></tr></tbody></table></li><li><p>å‡†å¤‡Jenkinsfile</p><table><thead><tr><th align="center">å‡†å¤‡Jenkinsfileæ–‡ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202151155145.png" alt="image-20211202151155145"></td></tr></tbody></table></li><li><p>æµ‹è¯•æ•ˆæœ</p><table><thead><tr><th align="center">æµ‹è¯•æ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202151225161.png" alt="image-20211202151225161"></td></tr></tbody></table></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="93-jenkinsæµæ°´çº¿ä»»åŠ¡å®ç°"></a>9.3 Jenkinsæµæ°´çº¿ä»»åŠ¡å®ç°<a class="hash-link" href="#93-jenkinsæµæ°´çº¿ä»»åŠ¡å®ç°" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="931-å‚æ•°åŒ–æ„å»º"></a>9.3.1 å‚æ•°åŒ–æ„å»º<a class="hash-link" href="#931-å‚æ•°åŒ–æ„å»º" title="Direct link to heading">#</a></h5><p>æ·»åŠ å‚æ•°åŒ–æ„å»ºï¼Œæ–¹ä¾¿é€‰æ‹©ä¸çš„é¡¹ç›®ç‰ˆæœ¬</p><table><thead><tr><th align="center">Gitå‚æ•°åŒ–æ„å»º</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202191944277.png" alt="image-20211202191944277"></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="932-æ‹‰å–gitä»£ç "></a>9.3.2 æ‹‰å–Gitä»£ç <a class="hash-link" href="#932-æ‹‰å–gitä»£ç " title="Direct link to heading">#</a></h5><p>é€šè¿‡æµæ°´çº¿è¯­æ³•ç”ŸæˆCheckoutä»£ç çš„è„šæœ¬</p><table><thead><tr><th align="center">è¯­æ³•ç”Ÿæˆ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202192047619.png" alt="image-20211202192047619"></td></tr></tbody></table><p><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211202192129895.png" alt="image-20211202192129895">å°†*/masteræ›´æ”¹ä¸ºæ ‡ç­¾<a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">${tag}</a></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ‹‰å–Gitä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: &#x27;${tag}&#x27;]], extensions: [], userRemoteConfigs: [[url: &#x27;http://49.233.115.171:8929/root/test.git&#x27;]]])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="933-æ„å»ºä»£ç "></a>9.3.3 æ„å»ºä»£ç <a class="hash-link" href="#933-æ„å»ºä»£ç " title="Direct link to heading">#</a></h5><p>é€šè¿‡è„šæœ¬æ‰§è¡Œmvnçš„æ„å»ºå‘½ä»¤</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ‹‰å–Gitä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: &#x27;${tag}&#x27;]], extensions: [], userRemoteConfigs: [[url: &#x27;http://49.233.115.171:8929/root/test.git&#x27;]]])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ„å»ºä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="934-ä»£ç è´¨é‡æ£€æµ‹"></a>9.3.4 ä»£ç è´¨é‡æ£€æµ‹<a class="hash-link" href="#934-ä»£ç è´¨é‡æ£€æµ‹" title="Direct link to heading">#</a></h5><p>é€šè¿‡è„šæœ¬æ‰§è¡Œsonar-scannerå‘½ä»¤å³å¯</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ‹‰å–Gitä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: &#x27;${tag}&#x27;]], extensions: [], userRemoteConfigs: [[url: &#x27;http://49.233.115.171:8929/root/test.git&#x27;]]])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ„å»ºä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ£€æµ‹ä»£ç è´¨é‡&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=31388be45653876c1f51ec02f0d478e2d9d0e1fa&#x27; </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="935-åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒ"></a>9.3.5 åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒ<a class="hash-link" href="#935-åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒ" title="Direct link to heading">#</a></h5><ul><li><p>ç”Ÿæˆè‡ªå®šä¹‰é•œåƒè„šæœ¬</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborHost = &#x27;192.168.11.11:80&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborRepo = &#x27;repository&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborUser = &#x27;DevOps&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborPasswd = &#x27;P@ssw0rd&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // å­˜æ”¾æ‰€æœ‰ä»»åŠ¡çš„åˆé›†</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ‹‰å–Gitä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: &#x27;${tag}&#x27;]], extensions: [], userRemoteConfigs: [[url: &#x27;http://49.233.115.171:8929/root/test.git&#x27;]]])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ„å»ºä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ£€æµ‹ä»£ç è´¨é‡&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=31388be45653876c1f51ec02f0d478e2d9d0e1fa&#x27; </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒHarbor&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;cp ./target/*.jar ./docker/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                cd ./docker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker build -t ${JOB_NAME}:${tag} ./&#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;docker login -u ${harborUser} -p ${harborPasswd} ${harborHost}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker tag ${JOB_NAME}:${tag} ${harborHost}/${harborRepo}/${JOB_NAME}:${tag}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker push ${harborHost}/${harborRepo}/${JOB_NAME}:${tag}&#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ç”ŸæˆPublish Over SSHè„šæœ¬</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborHost = &#x27;192.168.11.11:80&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborRepo = &#x27;repository&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborUser = &#x27;DevOps&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborPasswd = &#x27;P@ssw0rd&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // å­˜æ”¾æ‰€æœ‰ä»»åŠ¡çš„åˆé›†</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ‹‰å–Gitä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: &#x27;${tag}&#x27;]], extensions: [], userRemoteConfigs: [[url: &#x27;http://49.233.115.171:8929/root/test.git&#x27;]]])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ„å»ºä»£ç &#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }docker</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ£€æµ‹ä»£ç è´¨é‡&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=7d66af4b39cfe4f52ac0a915d4c9d5c513207098&#x27; </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒHarbor&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;cp ./target/*.jar ./docker/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                cd ./docker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker build -t ${JOB_NAME}:${tag} ./&#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;docker login -u ${harborUser} -p ${harborPasswd} ${harborHost}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker tag ${JOB_NAME}:${tag} ${harborHost}/${harborRepo}/${JOB_NAME}:${tag}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker push ${harborHost}/${harborRepo}/${JOB_NAME}:${tag}&#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;ç›®æ ‡æœåŠ¡å™¨æ‹‰å–é•œåƒå¹¶è¿è¡Œ&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sshPublisher(publishers: [sshPublisherDesc(configName: &#x27;testEnvironment&#x27;, transfers: [sshTransfer(cleanRemote: false, excludes: &#x27;&#x27;, execCommand: &quot;/usr/bin/deploy.sh $harborHost $harborRepo $JOB_NAME $tag $port &quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#x27;[, ]+&#x27;, remoteDirectory: &#x27;&#x27;, remoteDirectorySDF: false, removePrefix: &#x27;&#x27;, sourceFiles: &#x27;&#x27;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><p>[Psï¼šç”±äºé‡‡ç”¨å˜é‡ï¼Œè®°å¾—ä½¿ç”¨åŒå¼•å·]</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="94-jenkinsæµæ°´çº¿æ•´åˆé’‰é’‰"></a>9.4 Jenkinsæµæ°´çº¿æ•´åˆé’‰é’‰<a class="hash-link" href="#94-jenkinsæµæ°´çº¿æ•´åˆé’‰é’‰" title="Direct link to heading">#</a></h4><p>åœ¨ç¨‹åºéƒ¨ç½²æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡é’‰é’‰çš„æœºå™¨äººåŠæ—¶å‘ç¾¤ä¼—å‘é€éƒ¨ç½²çš„æœ€ç»ˆç»“æœé€šçŸ¥</p><ul><li><p>å®‰è£…æ’ä»¶</p><table><thead><tr><th align="center">å®‰è£…æ’ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211209151549412.png" alt="image-20211209151549412"></td></tr></tbody></table></li><li><p>é’‰é’‰å†…éƒ¨åˆ›å»ºç¾¤ç»„å¹¶æ„å»ºæœºå™¨äºº</p><table><thead><tr><th align="center">é’‰é’‰å†…éƒ¨åˆ›å»ºç¾¤ç»„å¹¶æ„å»ºæœºå™¨äºº</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211209152217433.png" alt="image-20211209152217433"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211209152252050.png" alt="image-20211209152252050"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211209152403312.png" alt="image-20211209152403312"></td></tr></tbody></table><p>æœ€ç»ˆæˆ–è·å–åˆ°Webhookä¿¡æ¯</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">https://oapi.dingtalk.com/robot/send?access_token=kej4ehkj34gjhg34jh5bh5jb34hj53b4</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>ç³»ç»Ÿé…ç½®æ·»åŠ é’‰é’‰é€šçŸ¥</p><table><thead><tr><th align="center">é…ç½®é’‰é’‰é€šçŸ¥</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211209162923440.png" alt="image-20211209162923440"></td></tr></tbody></table></li></ul><ul><li><p>ä»»åŠ¡ä¸­è¿½åŠ æµæ°´çº¿é…ç½®</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        sonarLogin = &#x27;2bab7bf7d5af25e2c2ca2f178af2c3c55c64d5d8&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborUser = &#x27;admin&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborPassword = &#x27;Harbor12345&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborHost = &#x27;192.168.11.12:8888&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborRepo = &#x27;repository&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ‹‰å–Gitä»£ç &#x27;){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: &#x27;$tag&#x27;]], extensions: [], userRemoteConfigs: [[url: &#x27;http://49.233.115.171:8929/root/lsx.git&#x27;]]])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Mavenæ„å»ºä»£ç &#x27;){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;SonarQubeæ£€æµ‹ä»£ç &#x27;){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=${sonarLogin}&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒ&#x27;){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;cd docker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                mv ../target/*.jar ./</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker build -t ${JOB_NAME}:$tag .</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ¨é€è‡ªå®šä¹‰é•œåƒ&#x27;){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;docker login -u ${harborUser} -p ${harborPassword} ${harborHost}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker tag ${JOB_NAME}:$tag ${harborHost}/${harborRepo}/${JOB_NAME}:$tag</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker push ${harborHost}/${harborRepo}/${JOB_NAME}:$tag&#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;é€šçŸ¥ç›®æ ‡æœåŠ¡å™¨&#x27;){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sshPublisher(publishers: [sshPublisherDesc(configName: &#x27;centos-docker&#x27;, transfers: [sshTransfer(cleanRemote: false, excludes: &#x27;&#x27;, execCommand: &quot;/usr/bin/deploy.sh $harborHost $harborRepo $JOB_NAME $tag $port&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#x27;[, ]+&#x27;, remoteDirectory: &#x27;&#x27;, remoteDirectorySDF: false, removePrefix: &#x27;&#x27;, sourceFiles: &#x27;&#x27;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    post {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        success {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dingtalk (</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                robot: &#x27;Jenkins-DingDing&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                type:&#x27;MARKDOWN&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                title: &quot;success: ${JOB_NAME}&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                text: [&quot;- æˆåŠŸæ„å»º:${JOB_NAME}é¡¹ç›®!\n- ç‰ˆæœ¬:${tag}\n- æŒç»­æ—¶é—´:${currentBuild.durationString}\n- ä»»åŠ¡:#${JOB_NAME}&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        failure {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            dingtalk (</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                robot: &#x27;Jenkins-DingDing&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                type:&#x27;MARKDOWN&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                title: &quot;fail: ${JOB_NAME}&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                text: [&quot;- å¤±è´¥æ„å»º:${JOB_NAME}é¡¹ç›®!\n- ç‰ˆæœ¬:${tag}\n- æŒç»­æ—¶é—´:${currentBuild.durationString}\n- ä»»åŠ¡:#${JOB_NAME}&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th align="center">é’‰é’‰é€šçŸ¥æ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211209163021396.png" alt="image-20211209163021396"></td></tr></tbody></table></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="åkubernetesç¼–æ’å·¥å…·"></a>åã€Kubernetesç¼–æ’å·¥å…·<a class="hash-link" href="#åkubernetesç¼–æ’å·¥å…·" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="101-kubernetesä»‹ç»"></a>10.1 Kubernetesä»‹ç»<a class="hash-link" href="#101-kubernetesä»‹ç»" title="Direct link to heading">#</a></h4><p>Kubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œç”¨äºç®¡ç†äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–çš„åº”ç”¨ï¼ŒKubernetesçš„ç›®æ ‡æ˜¯è®©éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç®€å•å¹¶ä¸”é«˜æ•ˆï¼ˆpowerfulï¼‰ï¼ŒKubernetesæä¾›äº†åº”ç”¨éƒ¨ç½²ï¼Œè§„åˆ’ï¼Œæ›´æ–°ï¼Œç»´æŠ¤çš„ä¸€ç§æœºåˆ¶ã€‚</p><p>Kubernetesä¸€ä¸ªæ ¸å¿ƒçš„ç‰¹ç‚¹å°±æ˜¯èƒ½å¤Ÿè‡ªä¸»çš„ç®¡ç†å®¹å™¨æ¥ä¿è¯äº‘å¹³å°ä¸­çš„å®¹å™¨æŒ‰ç…§ç”¨æˆ·çš„æœŸæœ›çŠ¶æ€è¿è¡Œç€ï¼Œç®¡ç†å‘˜å¯ä»¥åŠ è½½ä¸€ä¸ªå¾®å‹æœåŠ¡ï¼Œè®©è§„åˆ’å™¨æ¥æ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼ŒåŒæ—¶ï¼ŒKubernetesä¹Ÿç³»ç»Ÿæå‡å·¥å…·ä»¥åŠäººæ€§åŒ–æ–¹é¢ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿çš„éƒ¨ç½²è‡ªå·±çš„åº”ç”¨ã€‚</p><p>Kubernetesä¸»è¦èƒ½å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼š</p><ul><li><p>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</p><p>Kubernetes å¯ä»¥ä½¿ç”¨ DNS åç§°æˆ–è‡ªå·±çš„ IP åœ°å€å…¬å¼€å®¹å™¨ï¼Œå¦‚æœè¿›å…¥å®¹å™¨çš„æµé‡å¾ˆå¤§ï¼Œ Kubernetes å¯ä»¥è´Ÿè½½å‡è¡¡å¹¶åˆ†é…ç½‘ç»œæµé‡ï¼Œä»è€Œä½¿éƒ¨ç½²ç¨³å®šã€‚</p></li><li><p>å­˜å‚¨ç¼–æ’</p><p>Kubernetes å…è®¸ä½ è‡ªåŠ¨æŒ‚è½½ä½ é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿï¼Œæ¯”å¦‚æœ¬åœ°å­˜å‚¨ï¼Œç±»ä¼¼Dockerçš„æ•°æ®å·ã€‚</p></li><li><p>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</p><p>ä½ å¯ä»¥ä½¿ç”¨ Kubernetes æè¿°å·²éƒ¨ç½²å®¹å™¨çš„æ‰€éœ€çŠ¶æ€ï¼Œå®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€ æ›´æ”¹ä¸ºæœŸæœ›çŠ¶æ€ã€‚Kubernetes ä¼šè‡ªåŠ¨å¸®ä½ æ ¹æ®æƒ…å†µéƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œå¹¶åˆ é™¤ç°æœ‰å®¹å™¨ç»™æ–°å®¹å™¨æä¾›èµ„æºã€‚</p></li><li><p>è‡ªåŠ¨å®Œæˆè£…ç®±è®¡ç®—</p><p>Kubernetes å…è®¸ä½ è®¾ç½®æ¯ä¸ªå®¹å™¨çš„èµ„æºï¼Œæ¯”å¦‚CPUå’Œå†…å­˜ã€‚</p></li><li><p>è‡ªæˆ‘ä¿®å¤</p><p>Kubernetes é‡æ–°å¯åŠ¨å¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„å®¹å™¨ï¼Œå¹¶è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ã€‚</p></li><li><p>ç§˜é’¥ä¸é…ç½®ç®¡ç†</p><p>Kubernetes å…è®¸ä½ å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh å¯†é’¥ã€‚ä½ å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²å¯†é’¥ã€‚</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="102-kubernetesæ¶æ„"></a>10.2 Kubernetesæ¶æ„<a class="hash-link" href="#102-kubernetesæ¶æ„" title="Direct link to heading">#</a></h4><p>Kubernetes æ­å»ºéœ€è¦è‡³å°‘ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªMasterè´Ÿè´£ç®¡ç†ï¼Œä¸€ä¸ªSlaveæ­å»ºåœ¨å·¥ä½œæœåŠ¡å™¨ä¸Šè´Ÿè´£åˆ†é…ã€‚</p><table><thead><tr><th align="center">kubernetesæ¶æ„</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211210114507638.png" alt="image-20211210114507638"></td></tr></tbody></table><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°å„ä¸ªç»„ä»¶çš„åŸºæœ¬åŠŸèƒ½ï¼š</p><ul><li>API Serverï¼šä½œä¸ºK8sé€šè®¯çš„æ ¸å¿ƒç»„ä»¶ï¼ŒK8så†…éƒ¨äº¤äº’ä»¥åŠæ¥æ”¶å‘é€æŒ‡ä»¤çš„ç»„ä»¶ã€‚</li><li>controller-managerï¼šä½œä¸ºK8sçš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦åšèµ„æºè°ƒåº¦ï¼Œæ ¹æ®é›†ç¾¤æƒ…å†µåˆ†é…èµ„æº</li><li>etcdï¼šä¸€ä¸ªkey-valueçš„æ•°æ®åº“ï¼Œå­˜å‚¨å­˜å‚¨é›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯</li><li>schedulerï¼šè´Ÿè´£è°ƒåº¦æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹</li><li>cloud-controller-managerï¼šè´Ÿè´£è°ƒåº¦å…¶ä»–äº‘æœåŠ¡äº§å“</li><li>kubeletï¼šç®¡ç†Podsä¸Šé¢çš„å®¹å™¨ã€‚</li><li>kube-proxyï¼šè´Ÿè´£å¤„ç†å…¶ä»–Slaveæˆ–å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</li><li>Podï¼šå¯ä»¥ç†è§£ä¸ºå°±æ˜¯è¿è¡Œçš„å®¹å™¨</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="103-kuberneteså®‰è£…"></a>10.3 Kuberneteså®‰è£…<a class="hash-link" href="#103-kuberneteså®‰è£…" title="Direct link to heading">#</a></h4><p>è¿™é‡Œä¼šé‡‡ç”¨<a href="https://kuboard.cn/%E6%8F%90%E4%BE%9B%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85K8s%EF%BC%8C%E5%AE%89%E8%A3%85%E5%8D%95Master%E8%8A%82%E7%82%B9" target="_blank" rel="noopener noreferrer">https://kuboard.cn/æä¾›çš„æ–¹å¼å®‰è£…K8sï¼Œå®‰è£…å•MasterèŠ‚ç‚¹</a></p><ul><li>è¦æ±‚ä½¿ç”¨Centos7.8ç‰ˆæœ¬ï¼š<a href="https://vault.centos.org/7.8.2003/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso" target="_blank" rel="noopener noreferrer">https://vault.centos.org/7.8.2003/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso</a></li><li>è‡³å°‘2å° <strong>2æ ¸4G</strong> çš„æœåŠ¡å™¨</li></ul><p>å®‰è£…æµç¨‹</p><table><thead><tr><th align="center">å®‰è£…æµç¨‹</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211210190653687.png" alt="image-20211210190653687"></td></tr></tbody></table><p>å‡†å¤‡å¥½æœåŠ¡å™¨åå¼€å§‹å®‰è£…</p><ul><li><p>é‡æ–°è®¾ç½®hostnameï¼Œä¸å…è®¸ä¸ºlocalhost</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># ä¿®æ”¹ hostnameï¼Œåå­—ä¸å…è®¸ä½¿ç”¨ä¸‹åˆ’çº¿ã€å°æ•°ç‚¹ã€å¤§å†™å­—æ¯ï¼Œä¸èƒ½å«master</span></span><span class="token-line" style="color:#393A34"><span class="token plain">hostnamectl set-hostname your-new-host-name</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æŸ¥çœ‹ä¿®æ”¹ç»“æœ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">hostnamectl status</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># è®¾ç½® hostname è§£æ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;127.0.0.1   $(hostname)&quot; &gt;&gt; /etc/hosts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>è¦æ±‚2å°æœåŠ¡ä¹‹é—´å¯ä»¥ç›¸äº’é€šè®¯</p></li><li><p>å®‰è£…è½¯ä»¶</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># é˜¿é‡Œäº‘ docker hub é•œåƒ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export REGISTRY_MIRROR=https://registry.cn-hangzhou.aliyuncs.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSL https://kuboard.cn/install-script/v1.19.x/install_kubelet.sh | sh -s 1.19.5</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><p>é¦–å…ˆåˆå§‹åŒ–MasterèŠ‚ç‚¹</p><blockquote><p>å…³äºåˆå§‹åŒ–æ—¶ç”¨åˆ°çš„ç¯å¢ƒå˜é‡</p><ul><li><strong>APISERVER_NAME</strong> ä¸èƒ½æ˜¯ master çš„ hostname</li><li><strong>APISERVER_NAME</strong> å¿…é¡»å…¨ä¸ºå°å†™å­—æ¯ã€æ•°å­—ã€å°æ•°ç‚¹ï¼Œä¸èƒ½åŒ…å«å‡å·</li><li><strong>POD_SUBNET</strong> æ‰€ä½¿ç”¨çš„ç½‘æ®µä¸èƒ½ä¸ <strong><em>masterèŠ‚ç‚¹/workerèŠ‚ç‚¹</em></strong> æ‰€åœ¨çš„ç½‘æ®µé‡å ã€‚è¯¥å­—æ®µçš„å–å€¼ä¸ºä¸€ä¸ª <a href="https://kuboard.cn/glossary/cidr.html" target="_blank" rel="noopener noreferrer">CIDR</a> å€¼ï¼Œå¦‚æœæ‚¨å¯¹ CIDR è¿™ä¸ªæ¦‚å¿µè¿˜ä¸ç†Ÿæ‚‰ï¼Œè¯·ä»ç„¶æ‰§è¡Œ export POD_SUBNET=10.100.0.0/16 å‘½ä»¤ï¼Œä¸åšä¿®æ”¹</li></ul></blockquote><ul><li><p>è®¾ç½®ipï¼ŒåŸŸåï¼Œç½‘æ®µå¹¶æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ›¿æ¢ x.x.x.x ä¸º master èŠ‚ç‚¹å®é™… IPï¼ˆè¯·ä½¿ç”¨å†…ç½‘ IPï¼‰</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># export å‘½ä»¤åªåœ¨å½“å‰ shell ä¼šè¯ä¸­æœ‰æ•ˆï¼Œå¼€å¯æ–°çš„ shell çª—å£åï¼Œå¦‚æœè¦ç»§ç»­å®‰è£…è¿‡ç¨‹ï¼Œè¯·é‡æ–°æ‰§è¡Œæ­¤å¤„çš„ export å‘½ä»¤</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export MASTER_IP=192.168.11.32</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ›¿æ¢ apiserver.demo ä¸º æ‚¨æƒ³è¦çš„ dnsName</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export APISERVER_NAME=apiserver.demo</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># Kubernetes å®¹å™¨ç»„æ‰€åœ¨çš„ç½‘æ®µï¼Œè¯¥ç½‘æ®µå®‰è£…å®Œæˆåï¼Œç”± kubernetes åˆ›å»ºï¼Œäº‹å…ˆå¹¶ä¸å­˜åœ¨äºæ‚¨çš„ç‰©ç†ç½‘ç»œä¸­</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export POD_SUBNET=10.100.0.1/16</span></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;${MASTER_IP}    ${APISERVER_NAME}&quot; &gt;&gt; /etc/hosts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSL https://kuboard.cn/install-script/v1.19.x/init_master.sh | sh -s 1.19.5</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ£€æŸ¥Masterå¯åŠ¨çŠ¶æ€</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç­‰å¾… 3-10 åˆ†é’Ÿï¼Œç›´åˆ°æ‰€æœ‰çš„å®¹å™¨ç»„å¤„äº Running çŠ¶æ€</span></span><span class="token-line" style="color:#393A34"><span class="token plain">watch kubectl get pod -n kube-system -o wide</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æŸ¥çœ‹ master èŠ‚ç‚¹åˆå§‹åŒ–ç»“æœ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes -o wide</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><p><code>Psï¼šå¦‚æœå‡ºç°NotReadyçš„æƒ…å†µæ‰§è¡Œï¼ˆæœ€æ–°ç‰ˆæœ¬çš„BUGï¼Œ1.19ä¸€èˆ¬æ²¡æœ‰ï¼‰</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull quay.io/coreos/flannel:v0.10.0-amd64 </span></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /etc/cni/net.d/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF&gt; /etc/cni/net.d/10-flannel.conf</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;name&quot;:&quot;cbr0&quot;,&quot;type&quot;:&quot;flannel&quot;,&quot;delegate&quot;: {&quot;isDefaultGateway&quot;: true}}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /usr/share/oci-umount/oci-umount.d -p</span></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /run/flannel/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF&gt; /run/flannel/subnet.env</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_NETWORK=172.100.0.0/16</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_SUBNET=172.100.1.0/24</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_MTU=1450</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_IPMASQ=true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®‰è£…ç½‘ç»œæœåŠ¡æ’ä»¶</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">export POD_SUBNET=10.100.0.0/16</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://kuboard.cn/install-script/v1.22.x/calico-operator.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://kuboard.cn/install-script/v1.22.x/calico-custom-resources.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s#192.168.0.0/16#${POD_SUBNET}#&quot; calico-custom-resources.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f calico-custom-resources.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>åˆå§‹åŒ–workerèŠ‚ç‚¹</p><ul><li><p>è·å–Joinå‘½ä»¤å‚æ•°ï¼Œåœ¨MasterèŠ‚ç‚¹æ‰§è¡Œ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm token create --print-join-command</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">è·å–å‘½ä»¤</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211213183025291.png" alt="image-20211213183025291"></td></tr></tbody></table></li></ul><ul><li><p>åœ¨workerèŠ‚ç‚¹åˆå§‹åŒ–</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># åªåœ¨ worker èŠ‚ç‚¹æ‰§è¡Œ</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ›¿æ¢ x.x.x.x ä¸º master èŠ‚ç‚¹çš„å†…ç½‘ IP</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export MASTER_IP=192.168.11.32</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ›¿æ¢ apiserver.demo ä¸ºåˆå§‹åŒ– master èŠ‚ç‚¹æ—¶æ‰€ä½¿ç”¨çš„ APISERVER_NAME</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export APISERVER_NAME=apiserver.demo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;${MASTER_IP}    ${APISERVER_NAME}&quot; &gt;&gt; /etc/hosts</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ›¿æ¢ä¸º master èŠ‚ç‚¹ä¸Š kubeadm token create å‘½ä»¤çš„è¾“å‡º</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm join apiserver.demo:6443 --token vwfilu.3nhndohc5gn1jv9k     --discovery-token-ca-cert-hash sha256:22ff15cabfe87ab48a7db39b3bbf986fee92ec92eb8efc7fe9b0abe2175ff0c2</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><p>æ£€æŸ¥æœ€ç»ˆè¿è¡Œæ•ˆæœ</p><ul><li><p>åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes -o wide</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><p><code>Psï¼šå¦‚æœå‡ºç°NotReadyçš„æƒ…å†µæ‰§è¡Œï¼ˆæœ€æ–°ç‰ˆæœ¬çš„BUGï¼Œ1.19ä¸€èˆ¬æ²¡æœ‰ï¼‰</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull quay.io/coreos/flannel:v0.10.0-amd64 </span></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /etc/cni/net.d/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF&gt; /etc/cni/net.d/10-flannel.conf</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;name&quot;:&quot;cbr0&quot;,&quot;type&quot;:&quot;flannel&quot;,&quot;delegate&quot;: {&quot;isDefaultGateway&quot;: true}}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /usr/share/oci-umount/oci-umount.d -p</span></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /run/flannel/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF&gt; /run/flannel/subnet.env</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_NETWORK=172.100.0.0/16</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_SUBNET=172.100.1.0/24</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_MTU=1450</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_IPMASQ=true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><p>è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@k8smaster ~]# kubectl get nodes</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">æ­å»ºæˆåŠŸæ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211210184851810.png" alt="image-20211210184851810"></td></tr></tbody></table></li></ul><p>å®‰è£…Kuboardç®¡ç†K8sé›†ç¾¤</p><ul><li><p>å®‰è£…Kuboard</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//addons.kuboard.cn/kuboard/kuboard</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">v3.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œè¯¥æŒ‡ä»¤ä½¿ç”¨åä¸ºäº‘çš„é•œåƒä»“åº“æ›¿ä»£ docker hub åˆ†å‘ Kuboard æ‰€éœ€è¦çš„é•œåƒ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3-swr.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æŸ¥çœ‹å¯åŠ¨æƒ…å†µ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">watch kubectl get pods -n kuboard</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">æŸ¥çœ‹æ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211213184701784.png" alt="image-20211213184701784"></td></tr></tbody></table></li><li><p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é“¾æ¥ http://your-node-ip-address:30080</p><table><thead><tr><th align="center">é¦–é¡µ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211213184742709.png" alt="image-20211213184742709"></td></tr></tbody></table></li><li><p>è¾“å…¥åˆå§‹ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ç™»å½•</p><ul><li>ç”¨æˆ·åï¼š <code>admin</code></li><li>å¯†ç ï¼š <code>Kuboard123</code></li></ul><table><thead><tr><th align="center">é¦–é¡µæ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20211213184840120.png" alt="image-20211213184840120"></td></tr></tbody></table></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="104-kubernetesæ“ä½œ"></a>10.4 Kubernetesæ“ä½œ<a class="hash-link" href="#104-kubernetesæ“ä½œ" title="Direct link to heading">#</a></h4><p>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£Kubernetesåœ¨è¿è¡Œæˆ‘ä»¬çš„èµ„æºæ—¶ï¼Œå…³è”åˆ°äº†å“ªäº›å†…å®¹</p><ul><li><p>èµ„æºçš„æ„å»ºæ–¹å¼ï¼š</p><ul><li>é‡‡ç”¨kubectlçš„å‘½ä»¤æ–¹å¼</li><li>yamlæ–‡ä»¶æ–¹å¼</li></ul></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1041-namespace"></a>10.4.1 Namespace<a class="hash-link" href="#1041-namespace" title="Direct link to heading">#</a></h5><ul><li><p>å‘½åç©ºé—´ï¼šä¸»è¦æ˜¯ä¸ºäº†å¯¹Kubernetesä¸­è¿è¡Œçš„èµ„æºè¿›è¡Œè¿‡éš”ç¦»ï¼Œ ä½†æ˜¯ç½‘ç»œæ˜¯äº’é€šçš„ï¼Œç±»ä¼¼Dockerçš„å®¹å™¨ï¼Œå¯ä»¥å°†å¤šä¸ªèµ„æºé…ç½®åˆ°ä¸€ä¸ªNameSpaceä¸­ã€‚è€ŒNameSpaceå¯ä»¥å¯¹ä¸åŒç¯å¢ƒè¿›è¡Œèµ„æºéš”ç¦»ï¼Œé»˜è®¤æƒ…å†µä¸‹Kubernetesæä¾›äº†defaultå‘½åç©ºé—´ï¼Œåœ¨æ„å»ºèµ„æºæ—¶ï¼Œå¦‚æœä¸æŒ‡å®šèµ„æºï¼Œé»˜è®¤é‡‡ç”¨defaultèµ„æºã€‚
å‘½ä»¤æ–¹å¼ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># æŸ¥çœ‹ç°æœ‰çš„å…¨éƒ¨å‘½åç©ºé—´</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get ns</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ„å»ºå‘½åç©ºé—´</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create ns å‘½åç©ºé—´åç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># åˆ é™¤ç°æœ‰å‘½åç©ºé—´ï¼Œ å¹¶ä¸”ä¼šåˆ é™¤ç©ºé—´ä¸‹çš„å…¨éƒ¨èµ„æº</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete ns å‘½åç©ºé—´åç§°</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>yamlæ–‡ä»¶æ–¹å¼ï¼šï¼ˆæ„å»ºèµ„æºæ—¶ï¼Œè®¾ç½®å‘½åç©ºé—´ï¼‰</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Namespace</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1042-pod"></a>10.4.2 Pod<a class="hash-link" href="#1042-pod" title="Direct link to heading">#</a></h5><ul><li><p>Podï¼šKubernetesè¿è¡Œçš„ä¸€ç»„å®¹å™¨ï¼ŒPodæ˜¯Kubernetesçš„æœ€å°å•ä½ï¼Œä½†æ˜¯å¯¹äºDockerè€Œç„¶ï¼ŒPodä¸­ä¼šè¿è¡Œå¤šä¸ªDockerå®¹å™¨</p><ul><li><p>å‘½ä»¤æ–¹å¼ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„pod</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -A</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŸ¥çœ‹æŒ‡å®šNamespaceä¸‹çš„Pod</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-n å‘½åç©ºé—´</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#ï¼ˆé»˜è®¤defaultï¼‰</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åˆ›å»ºPod</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl run podåç§° --image</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">é•œåƒåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pod podåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åˆ é™¤pod</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pod podåç§° </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-n å‘½åç©ºé—´</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#ï¼ˆé»˜è®¤defaultï¼‰</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŸ¥çœ‹podè¾“å‡ºçš„æ—¥å¿—</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -f podåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># è¿›å»podå®¹å™¨å†…éƒ¨</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it podåç§° -- </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŸ¥çœ‹kubernetesç»™Podåˆ†é…çš„ipä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡ipå’Œå®¹å™¨çš„ç«¯å£ï¼Œå¯ä»¥ç›´æ¥è®¿é—®</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -owide</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>yamlæ–¹å¼ï¼ˆæ¨èï¼‰</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> è¿è¡Œçš„podåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> podåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> å‘½åç©ºé—´</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> é•œåƒåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> å®¹å™¨åç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å¯åŠ¨Podï¼škubectl apply -f yamlæ–‡ä»¶åç§°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># åˆ é™¤Podï¼škubectl delete -f yamlæ–‡ä»¶åç§°</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>Podä¸­è¿è¡Œå¤šä¸ªå®¹å™¨</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> è¿è¡Œçš„podåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> podåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> å‘½åç©ºé—´</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> é•œåƒåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> å®¹å™¨åç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> é•œåƒåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> å®¹å™¨åç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">â€¦â€¦â€¦â€¦    </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯åŠ¨åå¯ä»¥æŸ¥çœ‹åˆ°</p><table><thead><tr><th align="center">Kuboardæ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220104203155749.png" alt="image-20220104203155749"></td></tr></tbody></table></li></ul></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1043-deployment"></a>10.4.3 Deployment<a class="hash-link" href="#1043-deployment" title="Direct link to heading">#</a></h5><p>éƒ¨ç½²æ—¶ï¼Œå¯ä»¥é€šè¿‡Deploymentç®¡ç†å’Œç¼–æ’Pod</p><p>Deploymentéƒ¨ç½²å®ç°</p><ul><li><p>å‘½ä»¤æ–¹å¼</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># åŸºäºDeploymentå¯åŠ¨å®¹å™¨</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create deployment deploymentåç§° --image=é•œåƒåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># ç”¨deploymentå¯åŠ¨çš„å®¹å™¨ä¼šåœ¨è¢«åˆ é™¤åè‡ªåŠ¨å†æ¬¡åˆ›å»ºï¼Œè¾¾åˆ°æ•…éšœæ¼‚ç§»çš„æ•ˆæœ</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># éœ€è¦ä½¿ç”¨deployçš„æ–¹å¼åˆ é™¤deploy</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æŸ¥çœ‹ç°åœ¨çš„deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># åˆ é™¤deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete deployment deploymentåç§°</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># åŸºäºDeploymentå¯åŠ¨å®¹å™¨å¹¶è®¾ç½®Podé›†ç¾¤æ•°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create deployment deploymentåç§° --image=é•œåƒåç§° --replicas é›†ç¾¤ä¸ªæ•°</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">é…ç½®æ–‡ä»¶æ–¹å¼</a></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æ­£å¸¸ä½¿ç”¨kubectlè¿è¡Œyamlå³å¯</p></li></ul><p>å¼¹æ€§ä¼¸ç¼©åŠŸèƒ½</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># åŸºäºscaleå®ç°å¼¹æ€§ä¼¸ç¼©</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale deploy/Deploymentåç§° --replicas é›†ç¾¤ä¸ªæ•°</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># æˆ–è€…ä¿®æ”¹yamlæ–‡ä»¶</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit deploy Deploymentåç§°</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">å›¾å½¢åŒ–é¡µé¢ä¿®æ”¹</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220104210823057.png" alt="image-20220104210823057"></td></tr></tbody></table><p>ç°åº¦å‘å¸ƒ</p><p>Deployå¯ä»¥åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬æ•°æ®æ—¶ï¼ŒæˆåŠŸå¯åŠ¨ä¸€ä¸ªpodï¼Œæ‰ä¼šä¸‹çº¿ä¸€ä¸ªè€ç‰ˆæœ¬çš„Pod</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">set</span><span class="token plain"> image deployment/Deploymentåç§° å®¹å™¨å</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">é•œåƒ:ç‰ˆæœ¬</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1044-service"></a>10.4.4 Service<a class="hash-link" href="#1044-service" title="Direct link to heading">#</a></h5><p>å¯ä»¥å°†å¤šä¸ªPodå¯¹å¤–æš´éœ²ä¸€ä¸ªServiceï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡Serviceè®¿é—®åˆ°è¿™ä¸€ç»„Podï¼Œå¹¶ä¸”å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡</p><p>ClusterIPæ–¹å¼ï¼š</p><p>ClusterIPæ˜¯é›†ç¾¤å†…éƒ¨Podä¹‹é—´çš„è®¿é—®æ–¹å¼</p><ul><li><p>å‘½ä»¤å®ç°æ•ˆæœ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># é€šè¿‡ç”Ÿæˆserviceæ˜ å°„ä¸€ä¸ªDeploymentä¸‹çš„æ‰€æœ‰podä¸­çš„æŸä¸€ä¸ªç«¯å£çš„å®¹å™¨</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose deployment Deploymentåç§° --port=Serviceç«¯å£å· --target-port=Podå†…å®¹å™¨ç«¯å£</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¹‹åé€šè¿‡<code>kubectl get service</code>æŸ¥çœ‹Serviceæä¾›çš„ipï¼Œå³å¯è®¿é—®</p><table><thead><tr><th align="center">kubectl get service</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220104214659229.png" alt="image-20220104214659229"></td></tr></tbody></table><p>ä¹Ÿå¯ä»¥é€šè¿‡<code>Deploymentåç§°.namespaceåç§°.svc</code>ä½œä¸ºåŸŸåè®¿é—®</p><table><thead><tr><th align="center">åœ¨æœåŠ¡å®¹å™¨å†…æ‰§è¡Œ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220104215030265.png" alt="image-20220104215030265"></td></tr></tbody></table></li></ul><p>NodePortæ–¹å¼</p><p>ClusterIPçš„æ–¹å¼åªèƒ½åœ¨Podå†…éƒ¨å®ç°è®¿é—®ï¼Œä½†æ˜¯ä¸€èˆ¬éœ€è¦å¯¹å¤–æš´éœ²ç½‘å…³ï¼Œæ‰€ä»¥éœ€è¦NodePortçš„æ–¹å¼Podå¤–æš´éœ²è®¿é—®</p><ul><li><p>å‘½ä»¤å®ç°æ–¹å¼</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># é€šè¿‡ç”Ÿæˆserviceæ˜ å°„ä¸€ä¸ªDeploymentä¸‹çš„æ‰€æœ‰podä¸­çš„æŸä¸€ä¸ªç«¯å£çš„å®¹å™¨</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose deployment Deploymentåç§° --port=Serviceç«¯å£å· --target-port=Podå†…å®¹å™¨ç«¯å£ --type=NodePort</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">æŸ¥çœ‹Serviceæ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220104222750733.png" alt="image-20220104222750733"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220104222819455.png" alt="image-20220104222819455"></td></tr></tbody></table></li></ul><p>Serviceä¹Ÿå¯ä»¥é€šè¿‡yamlæ–‡ä»¶å®ç°</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡applyå¯åŠ¨å°±ä¹Ÿå¯ä»¥åˆ›å»ºService</p><p>æµ‹è¯•æ•ˆæœ-Deploymentéƒ¨ç½²ï¼Œé€šè¿‡Serviceæš´éœ²</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯ä»¥æŸ¥çœ‹åˆ°æš´éœ²çš„ä¿¡æ¯</p><table><thead><tr><th align="center">Serviceä¿¡æ¯</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220105205334996.png" alt="image-20220105205334996"></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1045-ingress"></a>10.4.5 Ingress<a class="hash-link" href="#1045-ingress" title="Direct link to heading">#</a></h5><p>Kubernetesæ¨èå°†Ingressä½œä¸ºæ‰€æœ‰Serviceçš„å…¥å£ï¼Œæä¾›ç»Ÿä¸€çš„å…¥å£ï¼Œé¿å…å¤šä¸ªæœåŠ¡ä¹‹é—´éœ€è¦è®°å½•å¤§é‡çš„IPæˆ–è€…åŸŸåï¼Œæ¯•ç«ŸIPå¯èƒ½æ”¹å˜ï¼ŒæœåŠ¡å¤ªå¤šåŸŸåè®°å½•ä¸æ–¹ä¾¿ã€‚</p><p>Ingressåº•å±‚å…¶å®å°±æ˜¯ä¸€ä¸ªNginxï¼Œ å¯ä»¥åœ¨Kuboardä¸Šç›´æ¥ç‚¹å‡»å®‰è£…</p><table><thead><tr><th align="center">Kuboardå®‰è£…</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220105153343642.png" alt="image-20220105153343642"></td></tr><tr><td align="center"><strong><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220105153416367.png" alt="image-20220105153416367"></strong></td></tr></tbody></table><p>å› ä¸ºå‰¯æœ¬æ•°é»˜è®¤ä¸º1ï¼Œä½†æ˜¯k8sæ•´ä½“é›†ç¾¤å°±2ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ˜¾ç¤ºä¸‹é¢å³ä¸ºå®‰è£…æˆåŠŸ</p><table><thead><tr><th align="center">å®‰è£…æˆåŠŸ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220105153502619.png" alt="image-20220105153502619"></td></tr></tbody></table><p>å¯ä»¥å°†Ingressæ¥æ”¶åˆ°çš„è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„Serviceä¸­ã€‚</p><p>æ¨èä½¿ç”¨yamlæ–‡ä»¶æ–¹å¼</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> networking.k8s.io/v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ingress</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ingress</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingressClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ingress</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx.mashibing.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">pathType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Prefix</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8888</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th align="center">å¯åŠ¨æ—¶é—®é¢˜</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220105203819715.png" alt="image-20220105203819715"></td></tr></tbody></table><p>Kuboardå®‰è£…çš„Ingressæœ‰admissionçš„æ ¡éªŒé…ç½®ï¼Œéœ€è¦å…ˆåˆ é™¤é…ç½®å†å¯åŠ¨</p><p>æ‰¾åˆ°æŒ‡å®šçš„ingressçš„æ ¡éªŒä¿¡æ¯ï¼Œåˆ é™¤å³å¯</p><table><thead><tr><th align="center">åˆ é™¤ä¿¡æ¯</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220105204434044.png" alt="image-20220105204434044"></td></tr></tbody></table><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># æŸ¥çœ‹æ ¡éªŒwebhookçš„é…ç½®</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get -A ValidatingWebhookConfiguration</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># åˆ é™¤æŒ‡å®šçš„æ ¡éªŒ</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete ValidatingWebhookConfiguration ingress-nginx-admission-my-ingress-controller</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é…ç½®æœ¬åœ°hostsæ–‡ä»¶</p><table><thead><tr><th align="center">é…ç½®hosts</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220105204921272.png" alt="image-20220105204921272"></td></tr></tbody></table><p>è®°ä¸‹æ¥æ—¢å¯ä»¥è®¿é—®åœ¨Serviceä¸­æš´éœ²çš„Nginxä¿¡æ¯</p><table><thead><tr><th align="center">æœé€šè¿‡Ingressè®¿é—®</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/image-20220105205407393.png" alt="image-20220105205407393"></td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="105-jenkinsé›†æˆkubernetes"></a>10.5 Jenkinsé›†æˆKubernetes<a class="hash-link" href="#105-jenkinsé›†æˆkubernetes" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1051-å‡†å¤‡éƒ¨ç½²çš„ymlæ–‡ä»¶"></a>10.5.1 å‡†å¤‡éƒ¨ç½²çš„ymlæ–‡ä»¶<a class="hash-link" href="#1051-å‡†å¤‡éƒ¨ç½²çš„ymlæ–‡ä»¶" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.11.102</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">80/repo/pipeline</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v4.0.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline  </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> networking.k8s.io/v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ingress</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingressClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ingress</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mashibing.pipeline.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">pathType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Prefix</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8081</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1052-harborç§æœé…ç½®"></a>10.5.2 Harborç§æœé…ç½®<a class="hash-link" href="#1052-harborç§æœé…ç½®" title="Direct link to heading">#</a></h5><p>åœ¨å°è¯•ç”¨kubernetesçš„ymlæ–‡ä»¶å¯åŠ¨pipelineæœåŠ¡æ—¶ï¼Œä¼šå‡ºç°Kubernetesæ— æ³•æ‹‰å–é•œåƒçš„é—®é¢˜ï¼Œè¿™é‡Œéœ€è¦åœ¨kubernetesæ‰€åœ¨çš„Linuxä¸­é…ç½®HarboræœåŠ¡ä¿¡æ¯ï¼Œå¹¶ä¸”ä¿è¯Kuberneteså¯ä»¥æ‹‰å–Harborä¸Šçš„é•œåƒ</p><ul><li><p>è®¾ç½®Masterå’ŒWorkerçš„ç§æœåœ°å€ä¿¡æ¯</p><table><thead><tr><th align="center">è®¾ç½®Harborç§æœåœ°å€</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642498962716.png" alt="1642498962716"></td></tr></tbody></table></li><li><p>åœ¨Kuboardä¸Šè®¾ç½®ç§æœå¯†æ–‡ä¿¡æ¯</p><table><thead><tr><th align="center">è®¾ç½®å¯†æ–‡å¹¶æµ‹è¯•</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642498994935.png" alt="1642498994935"></td></tr></tbody></table><p>æŒ‰ç…§å¤åˆ¶æŒ‡ä»¤çš„ä½ç½®æµ‹è¯•è®¤è¯ï¼Œæ•ˆæœå¦‚ä¸‹</p><table><thead><tr><th align="center">æµ‹è¯•æ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642499172789.png" alt="1642499172789"></td></tr></tbody></table></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1053-æµ‹è¯•ä½¿ç”¨æ•ˆæœ"></a>10.5.3 æµ‹è¯•ä½¿ç”¨æ•ˆæœ<a class="hash-link" href="#1053-æµ‹è¯•ä½¿ç”¨æ•ˆæœ" title="Direct link to heading">#</a></h5><p>æ‰§è¡Œkubectlå‘½ä»¤ï¼ŒåŸºäºymlå¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”åŸºäºéƒ¨ç½²åæœåŠ¡çš„æç¤ºä¿¡æ¯ä»¥åŠIngressçš„è®¾ç½®ï¼Œç›´æ¥è®¿é—®</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642499368121.png" alt="1642499368121"></td></tr><tr><td><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642499788199.png" alt="1642499788199"></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1053-jenkinsè¿œç¨‹è°ƒç”¨"></a>10.5.3 Jenkinsè¿œç¨‹è°ƒç”¨<a class="hash-link" href="#1053-jenkinsè¿œç¨‹è°ƒç”¨" title="Direct link to heading">#</a></h5><ul><li><p>å°†pipeline.ymlé…ç½®åˆ°Gitlabä¸­</p><table><thead><tr><th align="center">é…ç½®ymlæ–‡ä»¶</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642499885324.png" alt="1642499885324"></td></tr></tbody></table></li><li><p>é…ç½®Jenkinsçš„ç›®æ ‡æœåŠ¡å™¨ï¼Œå¯ä»¥å°†ymlæ–‡ä»¶ä¼ è¾“åˆ°K8sçš„Masterä¸Š</p><table><thead><tr><th align="center">è®¾ç½®ç›®æ ‡æœåŠ¡å™¨</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642499992148.png" alt="1642499992148"></td></tr></tbody></table></li><li><p>ä¿®æ”¹Jenkinsfileï¼Œé‡æ–°è®¾ç½®æµæ°´çº¿ä»»åŠ¡è„šæœ¬ï¼Œå¹¶æµ‹è¯•æ•ˆæœ</p><table><thead><tr><th align="center">ä¼ é€’ymlæ–‡ä»¶è„šæœ¬</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642500061153.png" alt="1642500061153"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642500102996.png" alt="1642500102996"></td></tr></tbody></table></li><li><p>è®¾ç½®Jenkinsæ— å¯†ç ç™»å½•k8s-master</p><p>å°†Jenkinsä¸­å…¬é’¥ä¿¡æ¯å¤åˆ¶åˆ°k8s-masterçš„~/.ssh/authorized_keyszä¸­ï¼Œä¿è¯è¿œç¨‹è¿æ¥æ— å¯†ç </p><table><thead><tr><th align="center">è¿œç¨‹æ‰§è¡Œå‘½ä»¤æ— éœ€å¯†ç </th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642500239406.png" alt="1642500239406"></td></tr></tbody></table></li><li><p>è®¾ç½®æ‰§è¡Œkubectlçš„è„šæœ¬åˆ°Jenkinsfile</p><table><thead><tr><th align="center">è®¾ç½®Jenkinsfile</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642500378788.png" alt="1642500378788"></td></tr></tbody></table></li><li><p>æ‰§è¡ŒæŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th align="center">æ‰§è¡Œæµæ°´çº¿</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642500413802.png" alt="1642500413802"></td></tr></tbody></table><p>å¯ä»¥æŸ¥çœ‹åˆ°ymlæ–‡ä»¶æ˜¯ç”±å˜åŒ–çš„ï¼Œ è¿™æ ·k8så°±ä¼šé‡æ–°åŠ è½½</p></li><li><p>æŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th align="center">æ•ˆæœ</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642500474036.png" alt="1642500474036"></td></tr></tbody></table></li></ul><p><a href="https://www.faithcal.com" target="_blank" rel="noopener noreferrer">Psï¼šè¿™ç§æ–¹å¼æ›´é€‚åº”ä¸CDæ“ä½œï¼Œå°†é¡¹ç›®å°†åŸºäºæŸä¸ªç‰ˆæœ¬éƒ¨ç½²åˆ°æŒ‡å®šçš„ç›®æ ‡æœåŠ¡å™¨</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="106-åŸºäºgitlabçš„webhooks"></a>10.6 åŸºäºGitLabçš„WebHooks<a class="hash-link" href="#106-åŸºäºgitlabçš„webhooks" title="Direct link to heading">#</a></h4><p>è¿™é‡Œè¦å®ç°è‡ªåŠ¨åŒ–çš„ä¸€ä¸ªCIæ“ä½œï¼Œä¹Ÿå°±æ˜¯å¼€å‘äººå‘˜Pushä»£ç åˆ°Gitä»“åº“åï¼ŒJenkinsä¼šè‡ªåŠ¨çš„æ„å»ºé¡¹ç›®ï¼Œå°†æœ€æ–°çš„æäº¤ç‚¹ä»£ç æ„å»ºå¹¶è¿›è¡Œæ‰“åŒ…éƒ¨ç½²ï¼Œè¿™é‡ŒåŒºåˆ«å»ä¸Šè¿°çš„CDæ“ä½œï¼ŒCDæ“ä½œéœ€è¦åŸºäºæŸä¸ªç‰ˆæœ¬è¿›è¡Œéƒ¨ç½²ï¼Œè€Œè¿™é‡Œæ¯æ¬¡éƒ½æ˜¯å°†æœ€æ–°çš„æäº¤ç‚¹é›†æˆåˆ°ä¸»å¹²ä¸Šå¹¶æµ‹è¯•ã€‚</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1061-webhooksé€šçŸ¥"></a>10.6.1 WebHooksé€šçŸ¥<a class="hash-link" href="#1061-webhooksé€šçŸ¥" title="Direct link to heading">#</a></h5><p>å¼€å¯Jenkinsçš„è‡ªåŠ¨æ„å»º</p><table><thead><tr><th align="center">æ„å»ºè§¦å‘å™¨</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642500817131.png" alt="1642500817131"></td></tr></tbody></table><p>è®¾ç½®Gitlabçš„Webhooks</p><table><thead><tr><th align="center">è®¾ç½®Gitlabçš„Webhooks</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642500933316.png" alt="1642500933316"></td></tr></tbody></table><p>éœ€è¦å…³é—­Jenkinsçš„Gitlabè®¤è¯</p><table><thead><tr><th align="center">å…³é—­Jenkinsçš„Gitlabè®¤è¯</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642501016474.png" alt="1642501016474"></td></tr></tbody></table><p>å†æ¬¡æµ‹è¯•Gitlab</p><table><thead><tr><th align="center">å†æ¬¡æµ‹è¯•</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642501065243.png" alt="1642501065243"></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1062-ä¿®æ”¹é…ç½®"></a>10.6.2 ä¿®æ”¹é…ç½®<a class="hash-link" href="#1062-ä¿®æ”¹é…ç½®" title="Direct link to heading">#</a></h5><p>ä¿®æ”¹Jenkinsfileå®ç°åŸºäºæœ€æ–°æäº¤ç‚¹å®ç°æŒç»­é›†æˆæ•ˆæœï¼Œå°†ä¹‹å‰å¼•ç”¨${tag}çš„å…¨éƒ¨å»æ‰</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// æ‰€æœ‰çš„è„šæœ¬å‘½ä»¤éƒ½æ”¾åœ¨pipelineä¸­</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æŒ‡å®šä»»åŠ¡å†å“ªä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸­æ‰§è¡Œ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å£°æ˜å…¨å±€å˜é‡ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborUser = &#x27;admin&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborPasswd = &#x27;Harbor12345&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborAddress = &#x27;</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.</span><span class="token number" style="color:#36acaa">11.102</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">80</span><span class="token plain">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        harborRepo = &#x27;repo&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;æ‹‰å–gitä»“åº“ä»£ç &#x27;) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">$class</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &#x27;GitSCM&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> branches</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &#x27;*/master&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> extensions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userRemoteConfigs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &#x27;http</span><span class="token operator" style="color:#393A34">:</span><span class="token comment" style="color:#999988;font-style:italic">//192.168.11.101:8929/root/mytest.git&#x27;]]])</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;é€šè¿‡mavenæ„å»ºé¡¹ç›®&#x27;) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;é€šè¿‡SonarQubeåšä»£ç è´¨é‡æ£€æµ‹&#x27;) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.source=./ -Dsonar.projectname=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">JOB_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> -Dsonar.projectKey=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">JOB_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> -Dsonar.java.binaries=./target/ -Dsonar.login=40306ae8ea69a4792df2ceb4d9d25fe8a6ab1701&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;é€šè¿‡Dockeråˆ¶ä½œè‡ªå®šä¹‰é•œåƒ&#x27;) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;mv ./target</span><span class="token comment" style="color:#999988;font-style:italic">/*.jar ./docker/</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                docker build -t ${JOB_NAME}:latest ./docker/&#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        stage(&#x27;å°†è‡ªå®šä¹‰é•œåƒæ¨é€åˆ°Harbor&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                sh &#x27;&#x27;&#x27;docker login -u ${harborUser} -p ${harborPasswd} ${harborAddress}</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                docker tag ${JOB_NAME}:latest  ${harborAddress}/${harborRepo}/${JOB_NAME}:latest</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                docker push ${harborAddress}/${harborRepo}/${JOB_NAME}:latest &#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        stage(&#x27;å°†ymlæ–‡ä»¶ä¼ åˆ°k8s-masterä¸Š&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                sshPublisher(publishers: [sshPublisherDesc(configName: &#x27;k8s&#x27;, transfers: [sshTransfer(cleanRemote: false, excludes: &#x27;&#x27;, execCommand: &#x27;&#x27;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#x27;[, ]+&#x27;, remoteDirectory: &#x27;&#x27;, remoteDirectorySDF: false, removePrefix: &#x27;&#x27;, sourceFiles: &#x27;pipeline.yml&#x27;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        stage(&#x27;è¿œç¨‹æ‰§è¡Œk8s-masterçš„kubectlå‘½ä»¤&#x27;) {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            steps {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">               sh &#x27;&#x27;&#x27;ssh root@192.168.11.201 kubectl apply -f /usr/local/k8s/pipeline.yml</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                ssh root@192.168.11.201 kubectl rollout restart deployment pipeline -n test&#x27;&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic">
</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    post {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        success {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            dingtalk(</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                robot: &#x27;Jenkins-DingDing&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                type: &#x27;MARKDOWN&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                title: &quot;success: ${JOB_NAME}&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                text: [&quot;- æˆåŠŸæ„å»ºï¼š${JOB_NAME}! \n- ç‰ˆæœ¬ï¼šlatest \n- æŒç»­æ—¶é—´ï¼š${currentBuild.durationString}&quot; ]</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            )</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        failure {</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            dingtalk(</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                robot: &#x27;Jenkins-DingDing&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                type: &#x27;MARKDOWN&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                title: &quot;success: ${JOB_NAME}&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                text: [&quot;- æ„å»ºå¤±è´¥ï¼š${JOB_NAME}! \n- ç‰ˆæœ¬ï¼šlatest \n- æŒç»­æ—¶é—´ï¼š${currentBuild.durationString}&quot; ]</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            )</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    }</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">}</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¿®æ”¹pipeline.ymlï¼Œæ›´æ”¹é•œåƒç‰ˆæœ¬</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.11.102</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">80/repo/pipeline</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest   </span><span class="token comment" style="color:#999988;font-style:italic"># è¿™é‡Œ</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># çœç•¥å…¶ä»–å†…å®¹â€¦â€¦â€¦â€¦</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1063-æ»šåŠ¨æ›´æ–°"></a>10.6.3 æ»šåŠ¨æ›´æ–°<a class="hash-link" href="#1063-æ»šåŠ¨æ›´æ–°" title="Direct link to heading">#</a></h5><p>å› ä¸ºpipelineæ²¡æœ‰æ”¹å˜æ—¶ï¼Œæ¯æ¬¡ä¸ä¼šé‡æ–°åŠ è½½ï¼Œè¿™æ ·ä¼šå¯¼è‡´Podä¸­çš„å®¹å™¨ä¸ä¼šåŠ¨æ€æ›´æ–°ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨kubectlçš„rollout restartå‘½ä»¤æ»šåŠ¨æ›´æ–°</p><table><thead><tr><th align="center">è®¾ç½®Jenkinsfle</th></tr></thead><tbody><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642501521065.png" alt="1642501521065"></td></tr><tr><td align="center"><img src="https://chalee-typora.oss-cn-beijing.aliyuncs.com/Pictures/1642501549176.png" alt="1642501549176"></td></tr></tbody></table></div><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ä¸€devopsä»‹ç»" class="table-of-contents__link">ä¸€ã€DevOpsä»‹ç»</a></li><li><a href="#äºŒcodeé˜¶æ®µå·¥å…·" class="table-of-contents__link">äºŒã€Codeé˜¶æ®µå·¥å…·</a></li><li><a href="#ä¸‰buildé˜¶æ®µå·¥å…·" class="table-of-contents__link">ä¸‰ã€Buildé˜¶æ®µå·¥å…·</a></li><li><a href="#å››operateé˜¶æ®µå·¥å…·" class="table-of-contents__link">å››ã€Operateé˜¶æ®µå·¥å…·</a></li><li><a href="#äº”integrateå·¥å…·" class="table-of-contents__link">äº”ã€Integrateå·¥å…·</a></li><li><a href="#å…­cicdå…¥é—¨æ“ä½œ" class="table-of-contents__link">å…­ã€CIã€CDå…¥é—¨æ“ä½œ</a></li><li><a href="#ä¸ƒé›†æˆsonar-qube" class="table-of-contents__link">ä¸ƒã€é›†æˆSonar Qube</a></li><li><a href="#å…«é›†æˆharbor" class="table-of-contents__link">å…«ã€é›†æˆHarbor</a></li><li><a href="#ä¹jenkinsæµæ°´çº¿" class="table-of-contents__link">ä¹ã€Jenkinsæµæ°´çº¿</a></li><li><a href="#åkubernetesç¼–æ’å·¥å…·" class="table-of-contents__link">åã€Kubernetesç¼–æ’å·¥å…·</a></li></ul></div></div></div></main></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 From chalee.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fcd159b8.js"></script>
<script src="/assets/js/main.d15b887f.js"></script>
</body>
</html>