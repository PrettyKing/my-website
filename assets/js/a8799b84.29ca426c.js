"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7821],{5680:(e,n,a)=>{a.d(n,{xA:()=>c,yg:()=>u});var r=a(6540);function t(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function l(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?l(Object(a),!0).forEach((function(n){t(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function i(e,n){if(null==e)return{};var a,r,t=function(e,n){if(null==e)return{};var a,r,t={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var s=r.createContext({}),p=function(e){var n=r.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},c=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},g="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var a=e.components,t=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),g=p(a),m=t,u=g["".concat(s,".").concat(m)]||g[m]||d[m]||l;return a?r.createElement(u,o(o({ref:n},c),{},{components:a})):r.createElement(u,o({ref:n},c))}));function u(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var l=a.length,o=new Array(l);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[g]="string"==typeof e?e:t,o[1]=i;for(var p=2;p<l;p++)o[p]=a[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8979:(e,n,a)=>{a.r(n),a.d(n,{contentTitle:()=>o,default:()=>g,frontMatter:()=>l,metadata:()=>i,toc:()=>s});var r=a(8168),t=(a(6540),a(5680));const l={},o=void 0,i={unversionedId:"docker/docker\u4e2d\u8fdb\u7a0b\u7684\u4fe1\u53f7",id:"docker/docker\u4e2d\u8fdb\u7a0b\u7684\u4fe1\u53f7",isDocsHomePage:!1,title:"docker\u4e2d\u8fdb\u7a0b\u7684\u4fe1\u53f7",description:"\u4e00\u3001\u8fdb\u7a0b\u7684\u9000\u51fa - Linux",source:"@site/docs/docker/docker\u4e2d\u8fdb\u7a0b\u7684\u4fe1\u53f7.md",sourceDirName:"docker",slug:"/docker/docker\u4e2d\u8fdb\u7a0b\u7684\u4fe1\u53f7",permalink:"/my-website/docs/docker/docker\u4e2d\u8fdb\u7a0b\u7684\u4fe1\u53f7",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/docker/docker\u4e2d\u8fdb\u7a0b\u7684\u4fe1\u53f7.md",version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Yaml\u8bed\u6cd5",permalink:"/my-website/docs/docker/Yaml\u8bed\u6cd5"},next:{title:"\u5b89\u88c5Docker\u8f6f\u4ef6",permalink:"/my-website/docs/docker/\u5b89\u88c5Docker\u8f6f\u4ef6"}},s=[],p={toc:s},c="wrapper";function g(e){let{components:n,...a}=e;return(0,t.yg)(c,(0,r.A)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,t.yg)("h4",{id:"\u4e00\u8fdb\u7a0b\u7684\u9000\u51fa---linux"},"\u4e00\u3001\u8fdb\u7a0b\u7684\u9000\u51fa - Linux"),(0,t.yg)("h5",{id:"1kill-\u53c2\u6570"},"1\u3001kill \u53c2\u6570"),(0,t.yg)("table",null,(0,t.yg)("thead",{parentName:"table"},(0,t.yg)("tr",{parentName:"thead"},(0,t.yg)("th",{parentName:"tr",align:null},"1"),(0,t.yg)("th",{parentName:"tr",align:null},"SIGHUP"),(0,t.yg)("th",{parentName:"tr",align:null},"\u542f\u52a8\u88ab\u7ec8\u6b62\u7684\u7a0b\u5e8f\uff0c\u53ef\u8ba9\u8be5\u8fdb\u7a0b\u91cd\u65b0\u8bfb\u53d6\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u7c7b\u4f3c\u91cd\u65b0\u542f\u52a8\u3002"))),(0,t.yg)("tbody",{parentName:"table"},(0,t.yg)("tr",{parentName:"tbody"},(0,t.yg)("td",{parentName:"tr",align:null},"2"),(0,t.yg)("td",{parentName:"tr",align:null},"SIGINT"),(0,t.yg)("td",{parentName:"tr",align:null},"\u76f8\u5f53\u4e8e\u7528\u952e\u76d8\u8f93\u5165 ","[ctrl]","-c \u6765\u4e2d\u65ad\u4e00\u4e2a\u7a0b\u5e8f\u7684\u8fdb\u884c\u3002")),(0,t.yg)("tr",{parentName:"tbody"},(0,t.yg)("td",{parentName:"tr",align:null},"9"),(0,t.yg)("td",{parentName:"tr",align:null},"SIGKILL"),(0,t.yg)("td",{parentName:"tr",align:null},"\u4ee3\u8868\u5f3a\u5236\u4e2d\u65ad\u4e00\u4e2a\u7a0b\u5e8f\u7684\u8fdb\u884c\uff0c\u5982\u679c\u8be5\u7a0b\u5e8f\u8fdb\u884c\u5230\u4e00\u534a\uff0c\u90a3\u4e48\u5c1a\u672a\u5b8c\u6210\u7684\u90e8\u5206\u53ef\u80fd\u4f1a\u6709\u201c\u534a\u4ea7\u54c1\u201d\u4ea7\u751f\uff0c\u7c7b\u4f3c vim\u4f1a\u6709 .filename.swp \u4fdd\u7559\u4e0b\u6765\u3002")),(0,t.yg)("tr",{parentName:"tbody"},(0,t.yg)("td",{parentName:"tr",align:null},"15"),(0,t.yg)("td",{parentName:"tr",align:null},"SIGTERM"),(0,t.yg)("td",{parentName:"tr",align:null},"\u4ee5\u6b63\u5e38\u7684\u65b9\u5f0f\u6765\u7ec8\u6b62\u8be5\u7a0b\u5e8f\u3002\u7531\u4e8e\u662f\u6b63\u5e38\u7684\u7ec8\u6b62\uff0c\u6240\u4ee5\u540e\u7eed\u7684\u52a8\u4f5c\u4f1a\u5c06\u4ed6\u5b8c\u6210\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u8be5\u7a0b\u5e8f\u5df2\u7ecf\u53d1\u751f\u95ee\u9898\uff0c\u5c31\u662f\u65e0\u6cd5\u4f7f\u7528\u6b63\u5e38\u7684\u65b9\u6cd5\u7ec8\u6b62\u65f6\uff0c\u8f93\u5165\u8fd9\u4e2a signal \u4e5f\u662f\u6ca1\u6709\u7528\u7684\u3002")),(0,t.yg)("tr",{parentName:"tbody"},(0,t.yg)("td",{parentName:"tr",align:null},"19"),(0,t.yg)("td",{parentName:"tr",align:null},"SIGSTOP"),(0,t.yg)("td",{parentName:"tr",align:null},"\u76f8\u5f53\u4e8e\u7528\u952e\u76d8\u8f93\u5165 ","[ctrl]","-z \u6765\u6682\u505c\u4e00\u4e2a\u7a0b\u5e8f\u7684\u8fdb\u884c\u3002")))),(0,t.yg)("h5",{id:"2\u4fe1\u53f7"},"2\u3001\u4fe1\u53f7"),(0,t.yg)("p",null,"\u4fe1\u53f7\u662f\u4e00\u79cd\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u5f62\u5f0f\u3002\u4e00\u4e2a\u4fe1\u53f7\u5c31\u662f\u5185\u6838\u53d1\u9001\u7ed9\u8fdb\u7a0b\u7684\u4e00\u4e2a\u6d88\u606f\uff0c\u544a\u8bc9\u8fdb\u7a0b\u53d1\u751f\u4e86\u67d0\u79cd\u4e8b\u4ef6\u3002\u5f53\u4e00\u4e2a\u4fe1\u53f7\u88ab\u53d1\u9001\u7ed9\u4e00\u4e2a\u8fdb\u7a0b\u540e\uff0c\u8fdb\u7a0b\u4f1a\u7acb\u5373\u4e2d\u65ad\u5f53\u524d\u7684\u6267\u884c\u6d41\u5e76\u5f00\u59cb\u6267\u884c\u4fe1\u53f7\u7684\u5904\u7406\u7a0b\u5e8f\u3002\u5982\u679c\u6ca1\u6709\u4e3a\u8fd9\u4e2a\u4fe1\u53f7\u6307\u5b9a\u5904\u7406\u7a0b\u5e8f\uff0c\u5c31\u6267\u884c\u9ed8\u8ba4\u7684\u5904\u7406\u7a0b\u5e8f\u3002\n\u8fdb\u7a0b\u9700\u8981\u4e3a\u81ea\u5df1\u611f\u5174\u8da3\u7684\u4fe1\u53f7\u6ce8\u518c\u5904\u7406\u7a0b\u5e8f\uff0c\u6bd4\u5982\u4e3a\u4e86\u80fd\u8ba9\u7a0b\u5e8f\u4f18\u96c5\u7684\u9000\u51fa(\u63a5\u5230\u9000\u51fa\u7684\u8bf7\u6c42\u540e\u80fd\u591f\u5bf9\u8d44\u6e90\u8fdb\u884c\u6e05\u7406)\u4e00\u822c\u7a0b\u5e8f\u90fd\u4f1a\u5904\u7406 SIGTERM \u4fe1\u53f7\u3002\u4e0e SIGTERM \u4fe1\u53f7\u4e0d\u540c\uff0cSIGKILL \u4fe1\u53f7\u4f1a\u7c97\u66b4\u7684\u7ed3\u675f\u4e00\u4e2a\u8fdb\u7a0b\u3002\u56e0\u6b64\u6211\u4eec\u7684\u5e94\u7528\u5e94\u8be5\u5b9e\u73b0\u8fd9\u6837\u7684\u76ee\u5f55\uff1a\u6355\u83b7\u5e76\u5904\u7406 SIGTERM \u4fe1\u53f7\uff0c\u4ece\u800c\u4f18\u96c5\u7684\u9000\u51fa\u7a0b\u5e8f\u3002\u5982\u679c\u6211\u4eec\u5931\u8d25\u4e86\uff0c\u7528\u6237\u5c31\u53ea\u80fd\u901a\u8fc7 SIGKILL \u4fe1\u53f7\u8fd9\u4e00\u7ec8\u6781\u624b\u6bb5\u4e86\u3002\u9664\u4e86 SIGTERM \u548c SIGKILL \uff0c\u8fd8\u6709\u50cf SIGUSR1 \u8fd9\u6837\u7684\u4e13\u95e8\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u884c\u4e3a\u7684\u4fe1\u53f7"),(0,t.yg)("h4",{id:"\u4e8c\u5bb9\u5668\u4e2d\u7684\u4fe1\u53f7"},"\u4e8c\u3001\u5bb9\u5668\u4e2d\u7684\u4fe1\u53f7"),(0,t.yg)("h5",{id:"1\u5bb9\u5668\u4e2d\u7684\u8fdb\u7a0b\u5c5e\u4e8e\u5bb9\u5668\u7684-1-\u53f7\u8fdb\u7a0b"},"1\u3001\u5bb9\u5668\u4e2d\u7684\u8fdb\u7a0b\u5c5e\u4e8e\u5bb9\u5668\u7684 1 \u53f7\u8fdb\u7a0b"),(0,t.yg)("p",null,"Docker \u7684 stop \u548c kill \u547d\u4ee4\u90fd\u662f\u7528\u6765\u5411\u5bb9\u5668\u53d1\u9001\u4fe1\u53f7\u7684\u3002\u6ce8\u610f\uff0c\u53ea\u6709\u5bb9\u5668\u4e2d\u7684 1 \u53f7\u8fdb\u7a0b\u80fd\u591f\u6536\u5230\u4fe1\u53f7\uff0c\u8fd9\u4e00\u70b9\u975e\u5e38\u5173\u952e\uff01stop \u547d\u4ee4\u4f1a\u9996\u5148\u53d1\u9001 SIGTERM \u4fe1\u53f7\uff0c\u5e76\u7b49\u5f85\u5e94\u7528\u4f18\u96c5\u7684\u7ed3\u675f\u3002\u5982\u679c\u53d1\u73b0\u5e94\u7528\u6ca1\u6709\u7ed3\u675f(\u7528\u6237\u53ef\u4ee5\u6307\u5b9a\u7b49\u5f85\u7684\u65f6\u95f4)\uff0c\u5c31\u518d\u53d1\u9001\u4e00\u4e2a SIGKILL \u4fe1\u53f7\u5f3a\u884c\u7ed3\u675f\u7a0b\u5e8f\u3002kill \u547d\u4ee4\u9ed8\u8ba4\u53d1\u9001\u7684\u662f SIGKILL \u4fe1\u53f7\uff0c\u5f53\u7136\u4f60\u53ef\u4ee5\u901a\u8fc7 -s \u9009\u9879\u6307\u5b9a\u4efb\u4f55\u4fe1\u53f7"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-js"},"'use strict';\n\nvar http = require('http');\n\nvar server = http.createServer(function (req, res) {\n  res.writeHead(200, {'Content-Type': 'text/plain'});\n  res.end('Hello World\\n');\n}).listen(3000, '0.0.0.0');\n\nconsole.log('server started');\n\nvar signals = {\n  'SIGINT': 2,\n  'SIGTERM': 15\n};\n\nfunction shutdown(signal, value) {\n  server.close(function () {\n    console.log('server stopped by ' + signal);\n    process.exit(128 + value);\n  });\n}\n\nObject.keys(signals).forEach(function (signal) {\n  process.on(signal, function () {\n    shutdown(signal, signals[signal]);\n  });\n});\n")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "normalize.css",\n  "version": "3.0.3",\n  "description": "Normalize.css as a node packaged module",\n  "style": "normalize.css",\n  "files": [\n    "LICENSE.md",\n    "normalize.css"\n  ],\n  "homepage": "http://necolas.github.io/normalize.css",\n  "repository": {\n    "type": "git",\n    "url": "git://github.com/necolas/normalize.css.git"\n  },\n  "main": "normalize.css",\n  "author": {\n    "name": "Nicolas Gallagher"\n  },\n  "license": "MIT",\n  "gitHead": "2bdda84272650aedfb45d8abe11a6d177933a803",\n  "bugs": {\n    "url": "https://github.com/necolas/normalize.css/issues"\n  },\n  "_id": "normalize.css@3.0.3",\n  "scripts": {},\n  "_shasum": "acc00262e235a2caa91363a2e5e3bfa4f8ad05c6",\n  "_from": "normalize.css@3.0.3",\n  "_npmVersion": "2.7.0",\n  "_nodeVersion": "0.10.35",\n  "_npmUser": {\n    "name": "necolas",\n    "email": "nicolasgallagher@gmail.com"\n  },\n  "maintainers": [\n    {\n      "name": "tjholowaychuk",\n      "email": "tj@vision-media.ca"\n    },\n    {\n      "name": "necolas",\n      "email": "nicolasgallagher@gmail.com"\n    }\n  ],\n  "dist": {\n    "shasum": "acc00262e235a2caa91363a2e5e3bfa4f8ad05c6",\n    "tarball": "https://registry.npmjs.org/normalize.css/-/normalize.css-3.0.3.tgz"\n  },\n  "directories": {},\n  "_resolved": "https://registry.npmjs.org/normalize.css/-/normalize.css-3.0.3.tgz",\n  "readme": "ERROR: No README data found!"\n}\n')),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-Dockerfile"},'FROM iojs:onbuild\nCOPY ./app.js ./app.js\nCOPY ./package.json ./package.json\nEXPOSE 3000\nENTRYPOINT ["node", "app"]\n')),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-shell"},'$ docker build --no-cache -t signal-app -f Dockerfile .\n\n$ docker run -it --rm -p 3000:3000 --name="my-app" signal-app\n\n$ docker container kill --signal="SIGTERM" my-app\n')),(0,t.yg)("h5",{id:"2\u5bb9\u5668\u4e2d\u7684\u8fdb\u7a0b\u4e0d\u5c5e\u4e8e\u5bb9\u5668\u7684-1-\u53f7\u8fdb\u7a0b"},"2\u3001\u5bb9\u5668\u4e2d\u7684\u8fdb\u7a0b\u4e0d\u5c5e\u4e8e\u5bb9\u5668\u7684 1 \u53f7\u8fdb\u7a0b"),(0,t.yg)("p",null,"\u521b\u5efa app1.sh \u6587\u4ef6"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-shell"},"#!/bin/bash\nnode app \n")),(0,t.yg)("p",null,"\u521b\u5efa Dockerfile1 \u6587\u4ef6"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-shell"},'FROM iojs:onbuild\nCOPY ./app.js ./app.js\nCOPY ./app1.sh ./app1.sh\nCOPY ./package.json ./package.json\nRUN chmod +x ./app1.sh\nEXPOSE 3000\nENTRYPOINT ["./app1.sh"]\n')),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-shell"},'$ docker build --no-cache -t signal-app1 -f Dockerfile1 .\n$ docker run -it --rm -p 3000:3000 --name="my-app1" signal-app1\n')),(0,t.yg)("h5",{id:"3\u5728\u811a\u672c\u4e2d\u6355\u83b7\u4fe1\u53f7"},"3\u3001\u5728\u811a\u672c\u4e2d\u6355\u83b7\u4fe1\u53f7"),(0,t.yg)("p",null,"\u521b\u5efa app2.sh \u6587\u4ef6"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-shell"},'#!/bin/bash\n# \u6253\u5f00\u8c03\u8bd5\u7ea7\u522b\nset -x\n\n# \u6307\u5b9a\u5f53\u524d pid \u53f7\npid=0\n\n# SIGUSR1-handler\nmy_handler() {\n  echo "my_handler"\n}\n\n\n# SIGTERM-handler\nterm_handler() {\n  if [ $pid -ne 0 ]; then\n    kill -SIGTERM "$pid"\n    # wait\u662f\u7528\u6765\u963b\u585e\u5f53\u524d\u8fdb\u7a0b\u7684\u6267\u884c\uff0c\u76f4\u81f3\u6307\u5b9a\u7684\u5b50\u8fdb\u7a0b\u6267\u884c\u7ed3\u675f\u540e\uff0c\u624d\u7ee7\u7eed\u6267\u884c\n    wait "$pid"\n  fi\n  exit 143; # 128 + 15 -- SIGTERM\n}\n# setup handlers\n# on callback, kill the last background process, which is `tail -f /dev/null` and execute the specified handler\n\n# \u3000trap \'commands\' signal-list \u5f53\u811a\u672c\u6536\u5230 signal-list \u6e05\u5355\u5185\u5217\u51fa\u7684\u4fe1\u53f7\u65f6, trap \u547d\u4ee4\u6267\u884c\u53cc\u5f15\u53f7\u4e2d\u7684\u547d\u4ee4\ntrap \'kill ${!}; my_handler\' SIGUSR1\ntrap \'kill ${!}; term_handler\' SIGTERM\n\n# run application\nnode app &\npid="$!"\n\n# wait forever\nwhile true\ndo\n  tail -f /dev/null & wait ${!}\ndone\n')),(0,t.yg)("p",null,"\u521b\u5efa Dockerfile2 \u6587\u4ef6"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-dockerfile"},'FROM iojs:onbuild\nCOPY ./app.js ./app.js\nCOPY ./app2.sh ./app2.sh\nCOPY ./package.json ./package.json\nRUN chmod +x ./app2.sh\nEXPOSE 3000\nENTRYPOINT ["./app2.sh"]\n')),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-shell"},'$ docker build --no-cache -t signal-app2 -f Dockerfile2 .\n$ docker run -it --rm -p 3000:3000 --name="my-app2" signal-app2\n')))}g.isMDXComponent=!0}}]);